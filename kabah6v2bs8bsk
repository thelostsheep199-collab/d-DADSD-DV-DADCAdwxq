-- GUI Library - EKUVÃ‰ STYLE (FIXED SCROLLING)
local GuiLibrary = {}
GuiLibrary.__index = GuiLibrary

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TextService = game:GetService("TextService")
local MarketplaceService = game:GetService("MarketplaceService")

-- Player
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Get game name
local gameName = "ROBLOX"
local success, gameInfo = pcall(function()
    return MarketplaceService:GetProductInfo(game.PlaceId)
end)
if success and gameInfo then
    gameName = gameInfo.Name
    if #gameName > 18 then
        gameName = gameName:sub(1, 18) .. "..."
    end
end

-- Premium Status
local IsPremium = false
local PremiumThemeColor = Color3.fromRGB(0, 255, 255) -- Cyan for premium

-- Color Theme (EkuvÃ© Inspired - Sleek Dark Theme)
local Theme = {
    Background = Color3.fromRGB(18, 18, 18),
    Secondary = Color3.fromRGB(28, 28, 28),
    Accent = Color3.fromRGB(0, 170, 255), -- Professional blue
    AccentHover = Color3.fromRGB(0, 190, 255),
    Text = Color3.fromRGB(245, 245, 245),
    TextSecondary = Color3.fromRGB(180, 180, 180),
    Success = Color3.fromRGB(0, 200, 83),
    Danger = Color3.fromRGB(255, 59, 48),
    Premium = PremiumThemeColor,
    Warning = Color3.fromRGB(255, 149, 0),
    Disabled = Color3.fromRGB(100, 100, 100),
    Border = Color3.fromRGB(40, 40, 40)
}


-- ============================================
-- GLOBAL ELEMENT REGISTRY
-- ============================================

-- Global registry functions
local function registerElement(name, element)
    if not _G._GUI_REGISTRY then
        _G._GUI_REGISTRY = {}
    end
    _G._GUI_REGISTRY[name] = element
    return true
end

local function getElement(name)
    if _G._GUI_REGISTRY then
        return _G._GUI_REGISTRY[name]
    end
    return nil
end

-- Create the global Set/Get functions immediately
_G.Set = function(name, value)
    local element = getElement(name)
    if not element then
        -- Try case-insensitive
        if _G._GUI_REGISTRY then
            for elementName, elementObj in pairs(_G._GUI_REGISTRY) do
                if elementName:lower() == name:lower() then
                    element = elementObj
                    break
                end
            end
        end
    end
    
    if element then
        if element.SetValue then
            element:SetValue(value)
        elseif element.SetState then
            element:SetState(value)
        elseif element.SetSelection then
            element:SetSelection(value)
        end
        return true
    end
    return false
end

_G.Get = function(name)
    local element = getElement(name)
    if not element and _G._GUI_REGISTRY then
        for elementName, elementObj in pairs(_G._GUI_REGISTRY) do
            if elementName:lower() == name:lower() then
                element = elementObj
                break
            end
        end
    end
    
    if element then
        if element.GetValue then
            return element:GetValue()
        elseif element.GetState then
            return element:GetState()
        elseif element.GetSelection then
            return element:GetSelection()
        end
    end
    return nil
end


-- ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "EkuveGUI"
screenGui.ResetOnSpawn = false
--screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global
screenGui.DisplayOrder = 9999
screenGui.Parent = playerGui

-- Check if mobile
local isMobile = UserInputService.TouchEnabled

-- Size and font adjustments (Compact and Professional)
local MOBILE_SETTINGS = {
    MainFrameSize = UDim2.new(0, 380, 0, 380),
    MainFramePosition = UDim2.new(0.5, 0, 0.5, 0),
    IconSize = UDim2.new(0, 40, 0, 40),
    FontSize = 8,
    TitleFontSize = 12,
    TabWidth = 90
}

local DESKTOP_SETTINGS = {
    MainFrameSize = UDim2.new(0, 460, 0, 560),
    MainFramePosition = UDim2.new(1, -470, 0, 20), -- Right side
    IconSize = UDim2.new(0, 45, 0, 45),
    FontSize = 13,
    TitleFontSize = 18,
    TabWidth = 100
}

local settings = isMobile and MOBILE_SETTINGS or DESKTOP_SETTINGS

-- Main Container (Sleek Dark Theme)
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = settings.MainFrameSize
mainFrame.Position = settings.MainFramePosition
mainFrame.BackgroundColor3 = Theme.Background
mainFrame.BackgroundTransparency = 0.2
mainFrame.BorderSizePixel = 0
mainFrame.ClipsDescendants = true
mainFrame.Parent = screenGui

if isMobile then
    mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
end

-- Sharp Corner
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 4)
corner.Parent = mainFrame

-- Thin Border
local border = Instance.new("UIStroke")
border.Name = "Border"
border.Color = Theme.Border
border.Thickness = 1
border.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
border.Parent = mainFrame

-- Title Bar (Minimalist Professional)
local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 38)
titleBar.BackgroundColor3 = Theme.Secondary
titleBar.BackgroundTransparency = 0
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

-- Title bar top corners only
local titleTopCorner = Instance.new("UICorner")
titleTopCorner.CornerRadius = UDim.new(0, 4)
titleTopCorner.Parent = titleBar

-- Title bar mask for bottom straight edge
local titleMask = Instance.new("Frame")
titleMask.Name = "TitleMask"
titleMask.Size = UDim2.new(1, 0, 1, 5)
titleMask.Position = UDim2.new(0, 0, 0, 0)
titleMask.BackgroundColor3 = Theme.Secondary
titleMask.BackgroundTransparency = 0
titleMask.BorderSizePixel = 0
titleMask.Parent = titleBar

-- Title with subtle gradient effect
local titleContainer = Instance.new("Frame")
titleContainer.Name = "TitleContainer"
titleContainer.Size = UDim2.new(0.7, 0, 1, 0)
titleContainer.Position = UDim2.new(0, 0, 0, 0)
titleContainer.BackgroundTransparency = 1
titleContainer.Parent = titleBar

local title = Instance.new("TextLabel")
title.Name = "Title"
title.Size = UDim2.new(1, -15, 1, 0)
title.Position = UDim2.new(0, 15, 0, 0)
title.BackgroundTransparency = 1
title.Text = "SFY Hub Library"
title.TextColor3 = Theme.Accent
title.TextSize = settings.TitleFontSize
title.TextXAlignment = Enum.TextXAlignment.Left
title.Font = Enum.Font.GothamSemibold
title.Parent = titleContainer

local subtitle = Instance.new("TextLabel")
subtitle.Name = "Subtitle"
subtitle.Size = UDim2.new(1, -15, 0, 12)
subtitle.Position = UDim2.new(0, 15, 1, -14)
subtitle.BackgroundTransparency = 1
subtitle.Text = "by Maya4pa2"
subtitle.TextColor3 = Theme.TextSecondary
subtitle.TextSize = 10
subtitle.TextXAlignment = Enum.TextXAlignment.Left
subtitle.Font = Enum.Font.Gotham
subtitle.Parent = titleContainer

-- Game Name Display (Minimal)
local gameNameLabel = Instance.new("TextLabel")
gameNameLabel.Name = "GameName"
gameNameLabel.Size = UDim2.new(0.25, -5, 0, 20)
gameNameLabel.Position = UDim2.new(0.5, 20, 0.5, -10)
gameNameLabel.BackgroundTransparency = 1
gameNameLabel.Text = gameName
gameNameLabel.TextColor3 = Theme.Accent
gameNameLabel.TextSize = 15
gameNameLabel.Font = Enum.Font.Gotham
gameNameLabel.TextXAlignment = Enum.TextXAlignment.Right
gameNameLabel.Parent = titleBar

-- Premium Badge (Minimal)
local premiumBadge = Instance.new("Frame")
premiumBadge.Name = "PremiumBadge"
premiumBadge.Size = UDim2.new(0, 70, 0, 16)
premiumBadge.Position = UDim2.new(1, -80, 0.5, -8)
premiumBadge.BackgroundColor3 = Theme.Premium
premiumBadge.BackgroundTransparency = 0.2
premiumBadge.BorderSizePixel = 0
premiumBadge.Visible = false
premiumBadge.Parent = titleBar

local premiumCorner = Instance.new("UICorner")
premiumCorner.CornerRadius = UDim.new(0, 3)
premiumCorner.Parent = premiumBadge

local premiumText = Instance.new("TextLabel")
premiumText.Name = "PremiumText"
premiumText.Size = UDim2.new(1, 0, 1, 0)
premiumText.BackgroundTransparency = 1
premiumText.Text = "PREMIUM"
premiumText.TextColor3 = Color3.fromRGB(255, 255, 255)
premiumText.TextSize = 9
premiumText.Font = Enum.Font.GothamBold
premiumText.Parent = premiumBadge

-- Control Buttons Container
local controlButtons = Instance.new("Frame")
controlButtons.Name = "ControlButtons"
controlButtons.Size = UDim2.new(0, 50, 1, 0)
controlButtons.Position = UDim2.new(1, -55, 0, 0)
controlButtons.BackgroundTransparency = 1
controlButtons.Parent = titleBar

-- Minimize Button (Clean)
local minimizeButton = Instance.new("TextButton")
minimizeButton.Name = "MinimizeButton"
minimizeButton.Size = UDim2.new(0, 22, 0, 22)
minimizeButton.Position = UDim2.new(0, -5, 0.5, -11)
minimizeButton.BackgroundColor3 = Theme.Secondary
minimizeButton.BackgroundTransparency = 0
minimizeButton.BorderSizePixel = 0
minimizeButton.Text = "_"
minimizeButton.TextColor3 = Theme.TextSecondary
minimizeButton.TextSize = 18
minimizeButton.Font = Enum.Font.GothamSemibold
minimizeButton.Parent = controlButtons
 
local minimizeCorner = Instance.new("UICorner")
minimizeCorner.CornerRadius = UDim.new(0, 3)
minimizeCorner.Parent = minimizeButton

local minimizeBorder = Instance.new("UIStroke")
minimizeBorder.Color = Theme.Border
minimizeBorder.Thickness = 1
minimizeBorder.Parent = minimizeButton

-- Close Button (Clean)
local closeButton = Instance.new("TextButton")
closeButton.Name = "CloseButton"
closeButton.Size = UDim2.new(0, 22, 0, 22)
closeButton.Position = UDim2.new(1, -26, 0.5, -11)
closeButton.BackgroundColor3 = Theme.Secondary
closeButton.BackgroundTransparency = 0
closeButton.BorderSizePixel = 0
closeButton.Text = "Ã—"
closeButton.TextColor3 = Theme.TextSecondary
closeButton.TextSize = 18
closeButton.Font = Enum.Font.GothamSemibold
closeButton.Parent = controlButtons

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 3)
closeCorner.Parent = closeButton

local closeBorder = Instance.new("UIStroke")
closeBorder.Color = Theme.Border
closeBorder.Thickness = 1
closeBorder.Parent = closeButton
 
-- Content Area
local contentArea = Instance.new("Frame")
contentArea.Name = "ContentArea"
contentArea.Size = UDim2.new(1, 0, 1, -38)
contentArea.Position = UDim2.new(0, 0, 0, 38)
contentArea.BackgroundTransparency = 1
contentArea.Parent = mainFrame
 
-- Tab Container (Left Side - Minimalist)
local tabContainer = Instance.new("ScrollingFrame")
tabContainer.Name = "TabContainer"
tabContainer.Size = UDim2.new(0, settings.TabWidth, 1, 0)
tabContainer.Position = UDim2.new(0, 0, 0, 0)
tabContainer.BackgroundColor3 = Theme.Background
tabContainer.BackgroundTransparency = 0
tabContainer.BorderSizePixel = 0
tabContainer.ScrollBarThickness = 2
tabContainer.ScrollBarImageColor3 = Theme.Accent
tabContainer.ScrollBarImageTransparency = 0.7
tabContainer.Parent = contentArea
 
local tabLayout = Instance.new("UIListLayout")
tabLayout.Padding = UDim.new(0, 3)
tabLayout.SortOrder = Enum.SortOrder.LayoutOrder
tabLayout.Parent = tabContainer
 
local tabPadding = Instance.new("UIPadding")
tabPadding.PaddingTop = UDim.new(0, 8)
tabPadding.PaddingBottom = UDim.new(0, 8)
tabPadding.PaddingLeft = UDim.new(0, 5)
tabPadding.PaddingRight = UDim.new(0, 5)
tabPadding.Parent = tabContainer

-- Vertical Separator
local separator = Instance.new("Frame")
separator.Name = "Separator"
separator.Size = UDim2.new(0, 1, 1, 0)
separator.Position = UDim2.new(0, settings.TabWidth, 0, 0)
separator.BackgroundColor3 = Theme.Border
separator.BackgroundTransparency = 0
separator.BorderSizePixel = 0
separator.Parent = contentArea

-- Tab Content Area - FIXED SCROLLING
local tabContent = Instance.new("ScrollingFrame")
tabContent.Name = "TabContent"
tabContent.Size = UDim2.new(1, -settings.TabWidth - 6, 1, 0)
tabContent.Position = UDim2.new(0, settings.TabWidth + 5, 0, 0)
tabContent.BackgroundTransparency = 1
tabContent.ScrollBarThickness = 4
tabContent.ScrollBarImageColor3 = Theme.Accent
tabContent.ScrollBarImageTransparency = 0.7
tabContent.VerticalScrollBarInset = Enum.ScrollBarInset.Always
tabContent.ScrollingDirection = Enum.ScrollingDirection.Y
tabContent.AutomaticCanvasSize = Enum.AutomaticSize.Y
tabContent.CanvasSize = UDim2.new(0, 0, 0, 0)
tabContent.Parent = contentArea

-- Minimized Icon (Clean and Professional)
local minimizedIcon = Instance.new("TextButton")
minimizedIcon.Name = "MinimizedIcon"
minimizedIcon.Size = settings.IconSize
minimizedIcon.AnchorPoint = Vector2.new(1, 0) -- Align the right edge
minimizedIcon.Position = UDim2.new(1, -20, 0, 20) -- Right side, 20px offset
minimizedIcon.BackgroundColor3 = Theme.Background
minimizedIcon.BackgroundTransparency = 0
minimizedIcon.BorderSizePixel = 0
minimizedIcon.Text = ""
minimizedIcon.TextColor3 = Theme.Accent
minimizedIcon.TextSize = 12
minimizedIcon.TextScaled = false
minimizedIcon.Visible = false
minimizedIcon.Parent = screenGui


local iconCorner = Instance.new("UICorner")
iconCorner.CornerRadius = UDim.new(0, 4)
iconCorner.Parent = minimizedIcon

local iconBorder = Instance.new("UIStroke")
iconBorder.Color = Theme.Border
iconBorder.Thickness = 1
iconBorder.Parent = minimizedIcon

-- Create a container for the icon text
local iconTextContainer = Instance.new("Frame")
iconTextContainer.Name = "IconTextContainer"
iconTextContainer.Size = UDim2.new(1, 0, 1, 0)
iconTextContainer.BackgroundTransparency = 1
iconTextContainer.Parent = minimizedIcon

-- Main SFY text (larger and centered)
local iconMainText = Instance.new("TextLabel")
iconMainText.Name = "IconMainText"
iconMainText.Size = UDim2.new(1, 0, 0.7, 0)
iconMainText.Position = UDim2.new(0, 0, 0, 0)
iconMainText.BackgroundTransparency = 1
iconMainText.Text = "SFY"
iconMainText.TextColor3 = Theme.Accent
iconMainText.TextSize = isMobile and 16 or 18
iconMainText.Font = Enum.Font.GothamSemibold
iconMainText.TextScaled = false
iconMainText.Parent = iconTextContainer

-- MENU subtitle (smaller, below SFY)
local iconSubtitle = Instance.new("TextLabel")
iconSubtitle.Name = "IconSubtitle"
iconSubtitle.Size = UDim2.new(1, 0, 0.3, 0)
iconSubtitle.Position = UDim2.new(0, 0, 0.7, 0)
iconSubtitle.BackgroundTransparency = 1
iconSubtitle.Text = "MENU"
iconSubtitle.TextColor3 = Theme.TextSecondary
iconSubtitle.TextSize = isMobile and 8 or 9
iconSubtitle.Font = Enum.Font.Gotham
iconSubtitle.TextScaled = false
iconSubtitle.Parent = iconTextContainer

-- Optional: Add a subtle glow effect to the icon
local iconGlow = Instance.new("ImageLabel")
iconGlow.Name = "IconGlow"
iconGlow.Size = UDim2.new(1, 10, 1, 10)
iconGlow.Position = UDim2.new(0, -5, 0, -5)
iconGlow.BackgroundTransparency = 1
iconGlow.Image = "rbxassetid://8992230671" -- Default glow image
iconGlow.ImageColor3 = Theme.Accent
iconGlow.ImageTransparency = 0.8
iconGlow.ScaleType = Enum.ScaleType.Slice
iconGlow.SliceScale = 0.02
iconGlow.Visible = false
iconGlow.Parent = minimizedIcon

-- Variables
local isMinimized = false
local currentTab = nil
local tabs = {}
local buttons = {}
local isDestroyed = false
local premiumLockedElements = {}
local lastContentHeight = 0

-- ADD THESE TWO LINES RIGHT AFTER lastContentHeight = 0:
local elementRegistry = {} -- Stores GUI elements by name
local GuiElements = {} -- Alternative access

-- ADD THESE TWO LINES RIGHT AFTER:
local elementRegistry = {} -- Main registry for ALL GUI elements
local guiElements = {}     -- Alternative access (optional)
_G._GUI_ELEMENTS = elementRegistry  -- Expose it globally
-- Make frames draggable
local dragging = false
local dragInput
local dragStart
local startPos

local function updateInput(input)
    if isDestroyed then return end
    local delta = input.Position - dragStart
    mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

local function updateIconInput(input)
    if isDestroyed then return end
    local delta = input.Position - dragStart
    minimizedIcon.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

-- Main frame dragging
titleBar.InputBegan:Connect(function(input)
    if isDestroyed then return end
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

titleBar.InputChanged:Connect(function(input)
    if isDestroyed then return end
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

-- Icon dragging
minimizedIcon.InputBegan:Connect(function(input)
    if isDestroyed then return end
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = minimizedIcon.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

minimizedIcon.InputChanged:Connect(function(input)
    if isDestroyed then return end
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if isDestroyed then return end
    if input == dragInput and dragging then
        if isMinimized then
            updateIconInput(input)
        else
            updateInput(input)
        end
    end
end)

-- Toggle minimize
local function toggleMinimize()
    if isDestroyed then return end
    if isMinimized then
        -- Expand
        mainFrame.Visible = true
        minimizedIcon.Visible = false
        isMinimized = false
    else
        -- Minimize
        mainFrame.Visible = false
        minimizedIcon.Visible = true
        isMinimized = true
    end
end

minimizeButton.MouseButton1Click:Connect(toggleMinimize)
minimizedIcon.MouseButton1Click:Connect(toggleMinimize)

-- Close function
local function closeGUI()
    if isDestroyed then return end
    isDestroyed = true
    
    -- Destroy all GUI elements
    screenGui:Destroy()
    
    -- Disconnect any running connections
    for _, button in pairs(buttons) do
        if button.Connection then
            button.Connection:Disconnect()
        end
    end
end

closeButton.MouseButton1Click:Connect(closeGUI)

-- Update scrolling frames
tabLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    if isDestroyed then return end
    tabContainer.CanvasSize = UDim2.new(0, 0, 0, tabLayout.AbsoluteContentSize.Y + 16)
end)

-- Auto-update tab content scroll size
tabContent:GetPropertyChangedSignal("AbsoluteCanvasSize"):Connect(function()
    if isDestroyed then return end
    -- Ensure scroll bar is visible when needed
    local canvasHeight = tabContent.CanvasSize.Y.Offset
    local windowHeight = tabContent.AbsoluteWindowSize.Y
    
    if canvasHeight > windowHeight then
        tabContent.ScrollBarThickness = 4
    else
        tabContent.ScrollBarThickness = 0
    end
end)

-- Button hover effects
local function setupCleanButton(button)
    button.MouseEnter:Connect(function()
        if not isMobile then
            TweenService:Create(button, TweenInfo.new(0.1), {
                BackgroundColor3 = Theme.Accent,
                TextColor3 = Color3.fromRGB(255, 255, 255)
            }):Play()
        end
    end)
    
    button.MouseLeave:Connect(function()
        if not isMobile then
            TweenService:Create(button, TweenInfo.new(0.1), {
                BackgroundColor3 = Theme.Secondary,
                TextColor3 = Theme.TextSecondary
            }):Play()
        end
    end)
end

-- Setup control buttons
setupCleanButton(minimizeButton)
setupCleanButton(closeButton)

-- Library Functions
function GuiLibrary.new(title)
    local self = setmetatable({}, GuiLibrary)
    
    self.title = title or "SFY Library"
    self.tabs = {}
    self.currentTab = nil
    
    -- Don't update the minimized icon with the library title
    -- Keep it as "SFY"
    
    return self
end

-- Set Premium Status
function GuiLibrary:SetPremiumStatus(isPremium)
    IsPremium = isPremium
    
    if IsPremium then
        -- Change theme to premium colors
        Theme.Accent = Theme.Premium
        Theme.AccentHover = Color3.fromRGB(0, 255, 255)
        
        -- Show premium badge
        premiumBadge.Visible = true
        
        -- Update UI elements
        title.TextColor3 = Theme.Premium
        minimizedIcon.TextColor3 = Theme.Premium
        
        -- Update scroll bars
        tabContainer.ScrollBarImageColor3 = Theme.Premium
        tabContent.ScrollBarImageColor3 = Theme.Premium
        
        print("PREMIUM FEATURES UNLOCKED")
    else
        -- Reset to free theme
        Theme.Accent = Color3.fromRGB(0, 170, 255)
        Theme.AccentHover = Color3.fromRGB(0, 190, 255)
        
        -- Hide premium badge
        premiumBadge.Visible = false
        
        -- Reset UI elements
        title.TextColor3 = Theme.Accent
        minimizedIcon.TextColor3 = Theme.Accent
        
        -- Update scroll bars
        tabContainer.ScrollBarImageColor3 = Theme.Accent
        tabContent.ScrollBarImageColor3 = Theme.Accent
        
        print("FREE VERSION")
    end
end

-- Create Tab (Clean Style) - UPDATED FOR PROPER SCROLLING
function GuiLibrary:CreateTab(tabName)
    local tabButton = Instance.new("TextButton")
    tabButton.Name = tabName
    tabButton.Size = UDim2.new(1, 0, 0, 34)
    tabButton.BackgroundColor3 = Theme.Secondary
    tabButton.BackgroundTransparency = 0
    tabButton.BorderSizePixel = 0
    tabButton.Text = tabName
    tabButton.TextColor3 = Theme.TextSecondary
    tabButton.TextSize = 12
    tabButton.Font = Enum.Font.Gotham
    tabButton.LayoutOrder = #tabs
    tabButton.Parent = tabContainer
    
    local tabCorner = Instance.new("UICorner")
    tabCorner.CornerRadius = UDim.new(0, 3)
    tabCorner.Parent = tabButton
    
    local tabBorder = Instance.new("UIStroke")
    tabBorder.Name = "TabBorder"
    tabBorder.Color = Theme.Border
    tabBorder.Thickness = 1
    tabBorder.Parent = tabButton
    
    -- Create content container for this tab
    local tabContentContainer = Instance.new("Frame")
    tabContentContainer.Name = tabName .. "_Content"
    tabContentContainer.Size = UDim2.new(1, 0, 1, 0)
    tabContentContainer.BackgroundTransparency = 1
    tabContentContainer.AutomaticSize = Enum.AutomaticSize.Y
    tabContentContainer.Visible = false
    tabContentContainer.Parent = tabContent
    
    -- Layout for tab content
    local contentLayout = Instance.new("UIListLayout")
    contentLayout.Name = "ContentLayout"
    contentLayout.Padding = UDim.new(0, 8)
    contentLayout.SortOrder = Enum.SortOrder.LayoutOrder
    contentLayout.Parent = tabContentContainer
    
    local contentPadding = Instance.new("UIPadding")
    contentPadding.Name = "ContentPadding"
    contentPadding.PaddingTop = UDim.new(0, 10)
    contentPadding.PaddingLeft = UDim.new(0, 10)
    contentPadding.PaddingRight = UDim.new(0, 10)
    contentPadding.PaddingBottom = UDim.new(0, 10)
    contentPadding.Parent = tabContentContainer
    
    -- Auto-size the content container
    contentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        tabContentContainer.Size = UDim2.new(1, 0, 0, contentLayout.AbsoluteContentSize.Y + 20)
    end)
    
    local tabData = {
        Button = tabButton,
        Container = tabContentContainer,
        Name = tabName
    }
    
    table.insert(tabs, tabData)
    
    -- Set as current tab if first tab
    if #tabs == 1 then
        currentTab = tabData
        tabButton.BackgroundColor3 = Theme.Accent
        tabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        tabBorder.Color = Theme.Accent
        tabContentContainer.Visible = true
    end
    
    -- Tab button click event
    tabButton.MouseButton1Click:Connect(function()
        if currentTab then
            currentTab.Button.BackgroundColor3 = Theme.Secondary
            currentTab.Button.TextColor3 = Theme.TextSecondary
            currentTab.Button.TabBorder.Color = Theme.Border
            currentTab.Container.Visible = false
        end
        
        currentTab = tabData
        tabButton.BackgroundColor3 = Theme.Accent
        tabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        tabBorder.Color = Theme.Accent
        tabContentContainer.Visible = true
        
        -- Update tab content scroll position
        tabContent.CanvasSize = UDim2.new(0, 0, 0, tabContentContainer.AbsoluteSize.Y)
    end)
    
    -- Button hover effects
    setupCleanButton(tabButton)
    
    -- Return tab data with Frame property for compatibility
    tabData.Frame = tabContentContainer
    
    return tabData
end



-- Set Premium Status
function GuiLibrary:SetPremiumStatus(isPremium)
    IsPremium = isPremium
    
    -- Update UI based on premium status
    if IsPremium then
        -- Change theme to premium colors
        Theme.Accent = Theme.Premium
        Theme.AccentHover = Color3.fromRGB(255, 225, 100)
        
        -- Show premium badge
        premiumBadge.Visible = true
        
        -- Update existing UI elements
        minimizeButton.BackgroundColor3 = Theme.Premium
        title.TextColor3 = Theme.Premium
        
        -- Unlock all premium locked elements
        for elementId, elementData in pairs(premiumLockedElements) do
            if elementData.Overlay then
                elementData.Overlay:Destroy()
            end
            if elementData.Badge then
                elementData.Badge:Destroy()
            end
            -- Re-enable the element
            if elementData.Element:IsA("TextButton") or elementData.Element:IsA("TextBox") then
                elementData.Element.Active = true
                elementData.Element.TextColor3 = Theme.Text
                elementData.Element.BackgroundColor3 = Theme.Secondary
            end
        end
        
        -- Clear premium locked elements
        premiumLockedElements = {}
        
        print("ðŸŽ‰ Premium features unlocked!")
    else
        -- Reset to free theme
        Theme.Accent = Color3.fromRGB(0, 150, 255)
        Theme.AccentHover = Color3.fromRGB(0, 170, 255)
        
        -- Hide premium badge
        premiumBadge.Visible = false
        
        -- Reset UI elements
        minimizeButton.BackgroundColor3 = Theme.Accent
        title.TextColor3 = Theme.Text
        
        print("ðŸ”“ Free version - Some features are locked")
    end
end
-- Mark Element as Premium (FIXED VERSION)
function GuiLibrary:MarkAsPremium(guiElement, customMessage)
    if IsPremium then return end -- Don't mark if already premium
    
    local elementId = tostring(guiElement) .. "_" .. tick()
    local message = customMessage or "PREMIUM"
    
    -- Create overlay
    local overlay = Instance.new("Frame")
    overlay.Name = "PremiumOverlay"
    overlay.Size = UDim2.new(1, 0, 1, 0)
    overlay.BackgroundColor3 = Theme.Disabled
    overlay.BackgroundTransparency = 0.7
    overlay.BorderSizePixel = 0
    overlay.ZIndex = 10
    overlay.Parent = guiElement
    
    local overlayCorner = Instance.new("UICorner")
    if guiElement:FindFirstChildOfClass("UICorner") then
        overlayCorner.CornerRadius = guiElement:FindFirstChildOfClass("UICorner").CornerRadius
    else
        overlayCorner.CornerRadius = UDim.new(0, 4)
    end
    overlayCorner.Parent = overlay
    
    -- Create premium badge
    local badge = Instance.new("Frame")
    badge.Name = "PremiumLockBadge"
    badge.Size = UDim2.new(0, 60, 0, 16)
    badge.Position = UDim2.new(0.5, -30, 0.5, -8)
    badge.BackgroundColor3 = Theme.Premium
    badge.BackgroundTransparency = 0.2
    badge.BorderSizePixel = 0
    badge.ZIndex = 11
    badge.Parent = overlay
    
    local badgeCorner = Instance.new("UICorner")
    badgeCorner.CornerRadius = UDim.new(0, 8)
    badgeCorner.Parent = badge
    
    local badgeText = Instance.new("TextLabel")
    badgeText.Name = "BadgeText"
    badgeText.Size = UDim2.new(1, 0, 1, 0)
    badgeText.BackgroundTransparency = 1
    badgeText.Text = message
    badgeText.TextColor3 = Color3.fromRGB(255, 255, 255)
    badgeText.TextSize = 9
    badgeText.Font = Enum.Font.GothamBold
    badgeText.ZIndex = 12
    badgeText.Parent = badge
    
    -- Disable the element (only for interactive elements)
    if guiElement:IsA("TextButton") or guiElement:IsA("TextBox") then
        guiElement.Active = false
        guiElement.TextColor3 = Theme.Disabled
        guiElement.BackgroundColor3 = Theme.Disabled
    elseif guiElement:IsA("Frame") then
        -- For frames, we only disable interaction by setting Active = false on child interactive elements
        -- We don't change TextColor3 since Frames don't have that property
        guiElement.Active = false
    end
    
    -- Store element data
    premiumLockedElements[elementId] = {
        Element = guiElement,
        Overlay = overlay,
        Badge = badge,
        OriginalProperties = {
            Active = guiElement.Active,
            BackgroundColor3 = guiElement.BackgroundColor3
        }
    }
    
    -- Only store TextColor3 for elements that have it
    if guiElement:IsA("TextButton") or guiElement:IsA("TextBox") then
        premiumLockedElements[elementId].OriginalProperties.TextColor3 = guiElement.TextColor3
    end
    
    -- Create unlock button functionality
    local unlockButton = Instance.new("TextButton")
    unlockButton.Name = "UnlockPremiumButton"
    unlockButton.Size = UDim2.new(1, 0, 1, 0)
    unlockButton.BackgroundTransparency = 1
    unlockButton.Text = ""
    unlockButton.ZIndex = 13
    unlockButton.Parent = overlay
    
    unlockButton.MouseButton1Click:Connect(function()
        self:ShowPremiumPrompt()
    end)
    
    return {
        Unlock = function()
            if overlay then overlay:Destroy() end
            if badge then badge:Destroy() end
            if unlockButton then unlockButton:Destroy() end
            
            -- Restore original properties
            local original = premiumLockedElements[elementId].OriginalProperties
            guiElement.Active = original.Active
            guiElement.BackgroundColor3 = original.BackgroundColor3
            
            -- Only restore TextColor3 for elements that have it
            if (guiElement:IsA("TextButton") or guiElement:IsA("TextBox")) and original.TextColor3 then
                guiElement.TextColor3 = original.TextColor3
            end
            
            premiumLockedElements[elementId] = nil
        end,
        
        UpdateMessage = function(newMessage)
            if badgeText then
                badgeText.Text = newMessage or message
            end
        end
    }
end

-- Show Premium Prompt
function GuiLibrary:ShowPremiumPrompt()
    local promptGui = Instance.new("ScreenGui")
    promptGui.Name = "PremiumPrompt"
    promptGui.ResetOnSpawn = false
    promptGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    promptGui.Parent = playerGui
    
    local background = Instance.new("Frame")
    background.Size = UDim2.new(1, 0, 1, 0)
    background.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    background.BackgroundTransparency = 0.5
    background.BorderSizePixel = 0
    background.ZIndex = 100
    background.Parent = promptGui
    
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, 350, 0, 200)
    mainFrame.Position = UDim2.new(0.5, -175, 0.5, -100)
    mainFrame.BackgroundColor3 = Theme.Background
    mainFrame.BackgroundTransparency = 0.1
    mainFrame.BorderSizePixel = 0
    mainFrame.ZIndex = 101
    mainFrame.Parent = promptGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = mainFrame
    
    local shadow = Instance.new("ImageLabel")
    shadow.Size = UDim2.new(1, 15, 1, 15)
    shadow.Position = UDim2.new(0, -7.5, 0, -7.5)
    shadow.BackgroundTransparency = 1
    shadow.Image = "rbxassetid://1316045217"
    shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
    shadow.ImageTransparency = 0.9
    shadow.ScaleType = Enum.ScaleType.Slice
    shadow.SliceCenter = Rect.new(10, 10, 118, 118)
    shadow.ZIndex = 100
    shadow.Parent = mainFrame
    
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, -20, 0, 40)
    title.Position = UDim2.new(0, 10, 0, 10)
    title.BackgroundTransparency = 1
    title.Text = "ðŸŒŸ PREMIUM FEATURE"
    title.TextColor3 = Theme.Premium
    title.TextSize = 18
    title.Font = Enum.Font.GothamBold
    title.ZIndex = 102
    title.Parent = mainFrame
    
    local message = Instance.new("TextLabel")
    message.Size = UDim2.new(1, -40, 0, 60)
    message.Position = UDim2.new(0, 20, 0, 50)
    message.BackgroundTransparency = 1
    message.Text = "This feature is only available in the Premium version.\n\nUpgrade to unlock all features and support development!"
    message.TextColor3 = Theme.Text
    message.TextSize = 12
    message.Font = Enum.Font.Gotham
    message.TextWrapped = true
    message.ZIndex = 102
    message.Parent = mainFrame
    
    local buttonContainer = Instance.new("Frame")
    buttonContainer.Size = UDim2.new(1, -40, 0, 40)
    buttonContainer.Position = UDim2.new(0, 20, 1, -60)
    buttonContainer.BackgroundTransparency = 1
    buttonContainer.ZIndex = 102
    buttonContainer.Parent = mainFrame
    
    local closeButton = Instance.new("TextButton")
    closeButton.Size = UDim2.new(0.4, 0, 1, 0)
    closeButton.Position = UDim2.new(0.6, 10, 0, 0)
    closeButton.BackgroundColor3 = Theme.Secondary
    closeButton.BackgroundTransparency = 0.3
    closeButton.BorderSizePixel = 0
    closeButton.Text = "CLOSE"
    closeButton.TextColor3 = Theme.Text
    closeButton.TextSize = 12
    closeButton.Font = Enum.Font.GothamBold
    closeButton.ZIndex = 103
    closeButton.Parent = buttonContainer
    
    local getPremiumButton = Instance.new("TextButton")
    getPremiumButton.Size = UDim2.new(0.4, 0, 1, 0)
    getPremiumButton.Position = UDim2.new(0, 0, 0, 0)
    getPremiumButton.BackgroundColor3 = Theme.Premium
    getPremiumButton.BackgroundTransparency = 0.2
    getPremiumButton.BorderSizePixel = 0
    getPremiumButton.Text = "GET PREMIUM"
    getPremiumButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    getPremiumButton.TextSize = 12
    getPremiumButton.Font = Enum.Font.GothamBold
    getPremiumButton.ZIndex = 103
    getPremiumButton.Parent = buttonContainer
    
    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 6)
    closeCorner.Parent = closeButton
    
    local premiumCorner = Instance.new("UICorner")
    premiumCorner.CornerRadius = UDim.new(0, 6)
    premiumCorner.Parent = getPremiumButton
    
    -- Button functions
    closeButton.MouseButton1Click:Connect(function()
        promptGui:Destroy()
    end)
    
    getPremiumButton.MouseButton1Click:Connect(function()
        -- Here you can add your premium purchase logic
        -- For example: open a website, show Discord link, etc.
        self:CopyToClipboard("https://discord.gg/your-premium-link")
        self:ShowNotification("Premium link copied to clipboard!", 3)
        promptGui:Destroy()
    end)
    
    -- Auto close after 10 seconds
    delay(10, function()
        if promptGui and promptGui.Parent then
            promptGui:Destroy()
        end
    end)
end

-- Copy to clipboard function
function GuiLibrary:CopyToClipboard(text)
    local clipBoard = setclipboard or toclipboard or set_clipboard or (Clipboard and Clipboard.set)
    if clipBoard then
        clipBoard(text)
        return true
    else
        warn("Clipboard function not available")
        return false
    end
end
-- Notification function with types and sounds
function GuiLibrary:ShowNotification(message, duration, notifType)
    duration = duration or 3
    notifType = notifType or "Info" -- Default type
    
    -- Sound IDs for different notification types
    local soundIds = {
        Info = 544031439, -- Gentle ding
        Success = 467724240, -- Success chime
        Warning = 7041348540, -- Warning alert
        Error = 7041352976, -- Error sound
        Alert = 2591059779 -- Attention alert
    }
    
    local soundNames = {
        Info = "Info",
        Success = "Success",
        Warning = "Warning",
        Error = "Error",
        Alert = "Alert"
    }

    local notification = Instance.new("ScreenGui")
    notification.Name = "Notification"
    notification.ResetOnSpawn = false
    notification.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    notification.Parent = playerGui

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 350, 0, 70) -- Increased height for type indicator
    frame.Position = UDim2.new(0.5, -175, 0.1, 0)
    
    -- Color scheme based on notification type
    local typeColors = {
        Info = Theme.Background,
        Success = Color3.fromRGB(46, 204, 113), -- Green
        Warning = Color3.fromRGB(241, 196, 15), -- Yellow
        Error = Color3.fromRGB(231, 76, 60), -- Red
        Alert = Color3.fromRGB(52, 152, 219) -- Blue
    }
    
    frame.BackgroundColor3 = typeColors[notifType] or Theme.Background
    frame.BackgroundTransparency = 0.1
    frame.BorderSizePixel = 0
    frame.Parent = notification

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = frame

    local shadow = Instance.new("ImageLabel")
    shadow.Size = UDim2.new(1, 10, 1, 10)
    shadow.Position = UDim2.new(0, -5, 0, -5)
    shadow.BackgroundTransparency = 1
    shadow.Image = "rbxassetid://1316045217"
    shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
    shadow.ImageTransparency = 0.85
    shadow.ScaleType = Enum.ScaleType.Slice
    shadow.SliceCenter = Rect.new(10, 10, 118, 118)
    shadow.Parent = frame

    -- Type indicator
    local typeFrame = Instance.new("Frame")
    typeFrame.Size = UDim2.new(0, 5, 1, 0)
    typeFrame.Position = UDim2.new(0, 0, 0, 0)
    typeFrame.BackgroundColor3 = typeColors[notifType] or Theme.Text
    typeFrame.BorderSizePixel = 0
    typeFrame.BackgroundTransparency = 0.3
    typeFrame.Parent = frame
    
    local typeCorner = Instance.new("UICorner")
    typeCorner.CornerRadius = UDim.new(0, 8)
    typeCorner.Parent = typeFrame

    -- Type label
    local typeLabel = Instance.new("TextLabel")
    typeLabel.Size = UDim2.new(0, 80, 0, 20)
    typeLabel.Position = UDim2.new(0, 15, 0, 8)
    typeLabel.BackgroundTransparency = 1
    typeLabel.Text = soundNames[notifType] or notifType
    typeLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    typeLabel.TextSize = 12
    typeLabel.Font = Enum.Font.GothamBold
    typeLabel.TextXAlignment = Enum.TextXAlignment.Left
    typeLabel.Parent = frame

    -- Message label
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -20, 1, -35)
    label.Position = UDim2.new(0, 15, 0, 25)
    label.BackgroundTransparency = 1
    label.Text = message
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextSize = 14
    label.Font = Enum.Font.Gotham
    label.TextWrapped = true
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame

    -- Icon (optional)
    local icon = Instance.new("ImageLabel")
    icon.Size = UDim2.new(0, 24, 0, 24)
    icon.Position = UDim2.new(1, -30, 0, 8)
    icon.BackgroundTransparency = 1
    icon.Image = "rbxassetid://" .. tostring(soundIds[notifType] or soundIds.Info)
    icon.ImageTransparency = 0.3
    icon.Parent = frame

    -- Play sound
    if soundIds[notifType] then
        local sound = Instance.new("Sound")
        sound.SoundId = "rbxassetid://" .. tostring(soundIds[notifType])
        sound.Volume = 0.3
        sound.Parent = frame
        sound:Play()
        
        -- Clean up sound after it plays
        game:GetService("Debris"):AddItem(sound, 2)
    end

    -- Animate in
    frame.Position = UDim2.new(0.5, -175, 0, -80)
    TweenService:Create(frame, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), 
        {Position = UDim2.new(0.5, -175, 0.1, 0)}):Play()

    -- Auto-remove
    delay(duration, function()
        TweenService:Create(frame, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In), 
            {Position = UDim2.new(0.5, -175, 0, -80)}):Play()
        wait(0.3)
        notification:Destroy()
    end)
    
    -- Alternative: Use Roblox's built-in notification system
    -- Uncomment if you want to use both systems
    
    pcall(function()
        game.StarterGui:SetCore("SendNotification", {
            Title = soundNames[notifType] or notifType,
            Text = message,
            Duration = duration,
            Icon = "rbxassetid://" .. tostring(soundIds[notifType] or soundIds.Info)
        })
    end)
    
end

-- Convenience functions for different notification types
function GuiLibrary:ShowInfoNotification(message, duration)
    self:ShowNotification(message, duration, "Info")
end

function GuiLibrary:ShowSuccessNotification(message, duration)
    self:ShowNotification(message, duration, "Success")
end

function GuiLibrary:ShowWarningNotification(message, duration)
    self:ShowNotification(message, duration, "Warning")
end

function GuiLibrary:ShowErrorNotification(message, duration)
    self:ShowNotification(message, duration, "Error")
end

function GuiLibrary:ShowAlertNotification(message, duration)
    self:ShowNotification(message, duration, "Alert")
end

-- Create Tab (Voidware Style)
function GuiLibrary:CreateTab(tabName, icon)
    local tabButton = Instance.new("TextButton")
    tabButton.Name = tabName
    tabButton.Size = UDim2.new(1, 0, 0, 32)
    tabButton.BackgroundColor3 = Theme.Secondary
    tabButton.BackgroundTransparency = 0.5
    tabButton.BorderSizePixel = 0
    tabButton.Text = tabName
    tabButton.TextColor3 = Theme.TextSecondary
    tabButton.TextSize = 12
    tabButton.Font = Enum.Font.Gotham
    tabButton.LayoutOrder = #tabs
    tabButton.Parent = tabContainer
    
    local tabCorner = Instance.new("UICorner")
    tabCorner.CornerRadius = UDim.new(0, 4)
    tabCorner.Parent = tabButton
    
    local tabFrame = Instance.new("Frame")
    tabFrame.Name = tabName
    tabFrame.Size = UDim2.new(1, 0, 1, 0)
    tabFrame.Position = UDim2.new(0, 0, 0, 0)
    tabFrame.BackgroundTransparency = 1
    tabFrame.Visible = false
    tabFrame.Parent = tabContent
    
    local tabLayout = Instance.new("UIListLayout")
    tabLayout.Padding = UDim.new(0, 6)
    tabLayout.SortOrder = Enum.SortOrder.LayoutOrder
    tabLayout.Parent = tabFrame
    
    local tabPadding = Instance.new("UIPadding")
    tabPadding.PaddingTop = UDim.new(0, 5)
    tabPadding.Parent = tabFrame
    
    local tabData = {
        Button = tabButton,
        Frame = tabFrame,
        Name = tabName
    }
    
    table.insert(tabs, tabData)
    
    -- Set as current tab if first tab
    if #tabs == 1 then
        currentTab = tabData
        tabButton.BackgroundColor3 = Theme.Accent
        tabButton.BackgroundTransparency = 0.3
        tabButton.TextColor3 = Theme.Text
        tabFrame.Visible = true
    end
    
    -- Tab button click event
    tabButton.MouseButton1Click:Connect(function()
        if currentTab then
            currentTab.Button.BackgroundColor3 = Theme.Secondary
            currentTab.Button.BackgroundTransparency = 0.5
            currentTab.Button.TextColor3 = Theme.TextSecondary
            currentTab.Frame.Visible = false
        end
        
        currentTab = tabData
        tabButton.BackgroundColor3 = Theme.Accent
        tabButton.BackgroundTransparency = 0.3
        tabButton.TextColor3 = Theme.Text
        tabFrame.Visible = true
    end)
    
    return tabData
end

-- Create Button (Voidware Style) with Premium Support
function GuiLibrary:CreateButton(tab, buttonName, callback, isPremium)
    local button = Instance.new("TextButton")
    button.Name = buttonName
    button.Size = UDim2.new(1, 0, 0, 32)
    button.BackgroundColor3 = Theme.Secondary
    button.BackgroundTransparency = 0.4
    button.BorderSizePixel = 0
    button.Text = buttonName
    button.TextColor3 = Theme.Text
    button.TextSize = 12
    button.Font = Enum.Font.Gotham
    button.Parent = tab.Frame
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 4)
    buttonCorner.Parent = button
    
    -- Mark as premium if required
    local premiumLock
    if isPremium and not IsPremium then
        premiumLock = self:MarkAsPremium(button, "PREMIUM")
        callback = function() end -- Disable callback for non-premium users
    end
    
    -- Button effects
    button.MouseEnter:Connect(function()
        if not isMobile and (not isPremium or IsPremium) then
            TweenService:Create(button, TweenInfo.new(0.1), {BackgroundTransparency = 0.2}):Play()
        end
    end)
    
    button.MouseLeave:Connect(function()
        if not isMobile and (not isPremium or IsPremium) then
            TweenService:Create(button, TweenInfo.new(0.1), {BackgroundTransparency = 0.4}):Play()
        end
    end)
    
    button.MouseButton1Click:Connect(function()
        if isPremium and not IsPremium then
            return -- Don't execute for premium locked buttons
        end
        
        TweenService:Create(button, TweenInfo.new(0.1), {BackgroundTransparency = 0.1}):Play()
        TweenService:Create(button, TweenInfo.new(0.1), {BackgroundTransparency = 0.4}):Play()
        
        if callback then
            callback()
        end
    end)
    
    table.insert(buttons, button)
    
    local buttonObj = {
        Instance = button,
        PremiumLock = premiumLock
    }
    
    function buttonObj:SetPremium(isPremiumFeature)
        if isPremiumFeature and not IsPremium then
            if not self.PremiumLock then
                self.PremiumLock = GuiLibrary:MarkAsPremium(button, "PREMIUM")
            end
        elseif self.PremiumLock then
            self.PremiumLock.Unlock()
            self.PremiumLock = nil
        end
    end
    if buttonName and buttonObj then
        elementRegistry[buttonName] = buttonObj
        guiElements[buttonName] = buttonObj
    end
    return buttonObj
end

-- Create Toggle (Voidware Style) with Premium Support
function GuiLibrary:CreateToggle(tab, toggleName, defaultState, callback, isPremium)
    local toggle = Instance.new("TextButton")
    toggle.Name = toggleName
    toggle.Size = UDim2.new(1, 0, 0, 32)
    toggle.BackgroundColor3 = Theme.Secondary
    toggle.BackgroundTransparency = 0.4
    toggle.BorderSizePixel = 0
    toggle.Text = ""
    toggle.Parent = tab.Frame
    
    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(0, 4)
    toggleCorner.Parent = toggle
    
    local label = Instance.new("TextLabel")
    label.Name = "Label"
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.Position = UDim2.new(0, 10, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = toggleName
    label.TextColor3 = Theme.Text
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Font = Enum.Font.Gotham
    label.Parent = toggle
    
    local toggleFrame = Instance.new("Frame")
    toggleFrame.Name = "Toggle"
    toggleFrame.Size = UDim2.new(0, 40, 0, 20)
    toggleFrame.Position = UDim2.new(1, -45, 0.5, -10)
    toggleFrame.BackgroundColor3 = Theme.Secondary
    toggleFrame.BackgroundTransparency = 0.3
    toggleFrame.BorderSizePixel = 0
    toggleFrame.Parent = toggle
    
    local toggleCorner2 = Instance.new("UICorner")
    toggleCorner2.CornerRadius = UDim.new(0, 10)
    toggleCorner2.Parent = toggleFrame
    
    local toggleDot = Instance.new("Frame")
    toggleDot.Name = "Dot"
    toggleDot.Size = UDim2.new(0, 16, 0, 16)
    toggleDot.Position = UDim2.new(0, 2, 0, 2)
    toggleDot.BackgroundColor3 = Theme.Text
    toggleDot.BorderSizePixel = 0
    toggleDot.Parent = toggleFrame
    
    local toggleCorner3 = Instance.new("UICorner")
    toggleCorner3.CornerRadius = UDim.new(1, 0)
    toggleCorner3.Parent = toggleDot
    
    local state = defaultState or false
    
    -- Mark as premium if required
    local premiumLock
    if isPremium and not IsPremium then
        premiumLock = self:MarkAsPremium(toggle, "PREMIUM")
        callback = function() end -- Disable callback for non-premium users
    end
    
    local function updateToggle()
        if state then
            TweenService:Create(toggleFrame, TweenInfo.new(0.1), {BackgroundColor3 = Theme.Success}):Play()
            TweenService:Create(toggleDot, TweenInfo.new(0.1), {Position = UDim2.new(0, 22, 0, 2)}):Play()
        else
            TweenService:Create(toggleFrame, TweenInfo.new(0.1), {BackgroundColor3 = Theme.Secondary}):Play()
            TweenService:Create(toggleDot, TweenInfo.new(0.1), {Position = UDim2.new(0, 2, 0, 2)}):Play()
        end
        
        if callback then
            callback(state)
        end
    end
    
    updateToggle()
    
    toggle.MouseButton1Click:Connect(function()
        if isPremium and not IsPremium then
            return -- Don't execute for premium locked toggles
        end
        
        state = not state
        updateToggle()
    end)
    
    local toggleObj = {
        Instance = toggle,
        GetState = function() return state end,
        SetState = function(newState) 
            if isPremium and not IsPremium then return end
            state = newState
            updateToggle()
        end,
        PremiumLock = premiumLock
    }
    
    function toggleObj:SetPremium(isPremiumFeature)
        if isPremiumFeature and not IsPremium then
            if not self.PremiumLock then
                self.PremiumLock = GuiLibrary:MarkAsPremium(toggle, "PREMIUM")
            end
        elseif self.PremiumLock then
            self.PremiumLock.Unlock()
            self.PremiumLock = nil
        end
    end
	if toggleName and toggleObj then
        elementRegistry[toggleName] = toggleObj
        guiElements[toggleName] = toggleObj
    end
    return toggleObj
end
-- Color Picker with Wheel, Transparency, and Config Saving
function GuiLibrary:CreateColorPicker(params, label, defaultColor, callback, isPremium, configKey)
    -- Handle premium status
    if isPremium and self.Premium ~= true then
        -- Create a locked version
        local lockedFrame = Instance.new("Frame")
        lockedFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
        lockedFrame.BorderSizePixel = 0
        lockedFrame.Size = UDim2.new(1, 0, 0, 40)
        lockedFrame.Parent = params.Frame
        
        local UICorner = Instance.new("UICorner")
        UICorner.CornerRadius = UDim.new(0, 6)
        UICorner.Parent = lockedFrame
        
        local titleLabel = Instance.new("TextLabel")
        titleLabel.Text = label .. " ðŸ”’"
        titleLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
        titleLabel.TextSize = 14
        titleLabel.Font = Enum.Font.Gotham
        titleLabel.BackgroundTransparency = 1
        titleLabel.Position = UDim2.new(0, 10, 0, 10)
        titleLabel.Size = UDim2.new(1, -20, 0, 20)
        titleLabel.TextXAlignment = Enum.TextXAlignment.Left
        titleLabel.Parent = lockedFrame
        
        return {
            SetColor = function() end,
            GetColor = function() return Color3.new(1, 1, 1) end,
            GetTransparency = function() return 0 end,
            SetTransparency = function() end,
            SetVisible = function(visible) lockedFrame.Visible = visible end,
            Destroy = function() lockedFrame:Destroy() end
        }
    end
    
    -- Config saving system
    local configService = {}
    local gameId = tostring(game.GameId)
    local placeName = game:GetService("MarketplaceService"):GetProductInfo(game.GameId).Name
    configKey = configKey or label
    
    -- Helper function to get config path
    local function getConfigPath()
        return "SFY_ColorConfig/" .. gameId .. "/" .. placeName .. "/" .. configKey .. ".json"
    end
    
    -- Function to save config
    local function saveConfig(color, transparency)
        local config = {
            Color = {color.R, color.G, color.B},
            Transparency = transparency,
            Timestamp = os.time(),
            GameId = gameId,
            PlaceName = placeName,
            ConfigKey = configKey
        }
        
        local success, json = pcall(function()
            return game:GetService("HttpService"):JSONEncode(config)
        end)
        
        if success then
            writefile(getConfigPath(), json)
        end
    end
    
    -- Function to load config
    local function loadConfig()
        local path = getConfigPath()
        if not isfile(path) then return nil end
        
        local success, content = pcall(function()
            return readfile(path)
        end)
        
        if not success then return nil end
        
        local success2, config = pcall(function()
            return game:GetService("HttpService"):JSONDecode(content)
        end)
        
        if success2 and config.GameId == gameId and config.ConfigKey == configKey then
            return {
                Color = Color3.new(config.Color[1], config.Color[2], config.Color[3]),
                Transparency = config.Transparency or 0
            }
        end
        return nil
    end
    
    -- Try to load saved config
    local savedConfig = loadConfig()
    local currentColor = savedConfig and savedConfig.Color or defaultColor or Color3.fromRGB(255, 255, 255)
    local currentTransparency = savedConfig and savedConfig.Transparency or 0
    
    -- Create main container
    local container = Instance.new("Frame")
    container.Name = "ColorPicker"
    container.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    container.BorderSizePixel = 0
    container.Size = UDim2.new(1, 0, 0, 40)
    container.Parent = params.Frame
    
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 6)
    UICorner.Parent = container
    
    -- Create title label
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Text = label .. (savedConfig and " âœ“" or "")
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    titleLabel.TextSize = 14
    titleLabel.Font = Enum.Font.Gotham
    titleLabel.BackgroundTransparency = 1
    titleLabel.Position = UDim2.new(0, 10, 0, 10)
    titleLabel.Size = UDim2.new(0.5, -10, 0, 20)
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = container
    
    -- Create color button
    local colorButton = Instance.new("TextButton")
    colorButton.Text = "âœŽ Edit"
    colorButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    colorButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    colorButton.Position = UDim2.new(0.5, 5, 0, 10)
    colorButton.Size = UDim2.new(0.5, -15, 0, 20)
    colorButton.Font = Enum.Font.Gotham
    colorButton.TextSize = 12
    colorButton.Parent = container
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 4)
    buttonCorner.Parent = colorButton
    
    -- Create color preview with transparency
    local colorPreview = Instance.new("Frame")
    colorPreview.BackgroundColor3 = currentColor
    colorPreview.BackgroundTransparency = currentTransparency
    colorPreview.Position = UDim2.new(0, 5, 0, 5)
    colorPreview.Size = UDim2.new(0, 10, 1, -10)
    colorPreview.Parent = colorButton
    
    local previewCorner = Instance.new("UICorner")
    previewCorner.CornerRadius = UDim.new(0, 3)
    previewCorner.Parent = colorPreview
    
    -- Create expanded color picker (hidden by default)
    local expandedFrame = Instance.new("Frame")
    expandedFrame.Name = "ExpandedColorPicker"
    expandedFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    expandedFrame.Position = UDim2.new(0, 10, 1, 5)
    expandedFrame.Size = UDim2.new(1, -20, 0, 200)
    expandedFrame.Visible = false
    expandedFrame.Parent = container
    
    local expandedCorner = Instance.new("UICorner")
    expandedCorner.CornerRadius = UDim.new(0, 8)
    expandedCorner.Parent = expandedFrame
    
    -- Color Wheel
    local colorWheelFrame = Instance.new("Frame")
    colorWheelFrame.BackgroundTransparency = 1
    colorWheelFrame.Position = UDim2.new(0, 10, 0, 10)
    colorWheelFrame.Size = UDim2.new(0, 120, 0, 120)
    colorWheelFrame.Parent = expandedFrame
    
    -- Simulate color wheel with gradient
    local colorWheel = Instance.new("ImageLabel")
    colorWheel.Name = "ColorWheel"
    colorWheel.Image = "rbxassetid://14006237830" -- Hue wheel image
    colorWheel.BackgroundTransparency = 1
    colorWheel.Size = UDim2.new(1, 0, 1, 0)
    colorWheel.Parent = colorWheelFrame
    
    local wheelCursor = Instance.new("Frame")
    wheelCursor.Name = "WheelCursor"
    wheelCursor.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    wheelCursor.BorderSizePixel = 2
    wheelCursor.BorderColor3 = Color3.fromRGB(0, 0, 0)
    wheelCursor.Size = UDim2.new(0, 8, 0, 8)
    wheelCursor.Position = UDim2.new(0.5, -4, 0.5, -4)
    wheelCursor.Parent = colorWheel
    
    local wheelCursorCorner = Instance.new("UICorner")
    wheelCursorCorner.CornerRadius = UDim.new(1, 0)
    wheelCursorCorner.Parent = wheelCursor
    
    -- Brightness slider
    local brightnessFrame = Instance.new("Frame")
    brightnessFrame.BackgroundTransparency = 1
    brightnessFrame.Position = UDim2.new(0, 140, 0, 10)
    brightnessFrame.Size = UDim2.new(0, 20, 0, 120)
    brightnessFrame.Parent = expandedFrame
    
    local brightnessSlider = Instance.new("Frame")
    brightnessSlider.Name = "BrightnessSlider"
    brightnessSlider.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    brightnessSlider.Position = UDim2.new(0, 0, 0, 0)
    brightnessSlider.Size = UDim2.new(1, 0, 1, 0)
    brightnessSlider.Parent = brightnessFrame
    
    local brightnessGradient = Instance.new("UIGradient")
    brightnessGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.new(1, 1, 1)),
        ColorSequenceKeypoint.new(1, Color3.new(0, 0, 0))
    }
    brightnessGradient.Rotation = 90
    brightnessGradient.Parent = brightnessSlider
    
    local brightnessCursor = Instance.new("Frame")
    brightnessCursor.Name = "BrightnessCursor"
    brightnessCursor.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    brightnessCursor.BorderSizePixel = 2
    brightnessCursor.BorderColor3 = Color3.fromRGB(0, 0, 0)
    brightnessCursor.Size = UDim2.new(1, 0, 0, 6)
    brightnessCursor.Position = UDim2.new(0, 0, 0.5, -3)
    brightnessCursor.Parent = brightnessFrame
    
    -- Transparency slider
    local transparencyFrame = Instance.new("Frame")
    transparencyFrame.BackgroundTransparency = 1
    transparencyFrame.Position = UDim2.new(0, 170, 0, 10)
    transparencyFrame.Size = UDim2.new(0, 20, 0, 120)
    transparencyFrame.Parent = expandedFrame
    
    local transparencySlider = Instance.new("Frame")
    transparencySlider.Name = "TransparencySlider"
    transparencySlider.BackgroundColor3 = currentColor
    transparencySlider.Position = UDim2.new(0, 0, 0, 0)
    transparencySlider.Size = UDim2.new(1, 0, 1, 0)
    transparencySlider.Parent = transparencyFrame
    
    local transparencyPattern = Instance.new("ImageLabel")
    transparencyPattern.Image = "rbxassetid://8992230673" -- Checker pattern
    transparencyPattern.BackgroundTransparency = 1
    transparencyPattern.Size = UDim2.new(1, 0, 1, 0)
    transparencyPattern.Parent = transparencySlider
    
    local transparencyGradient = Instance.new("UIGradient")
    transparencyGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.new(1, 1, 1)),
        ColorSequenceKeypoint.new(1, Color3.new(1, 1, 1))
    }
    transparencyGradient.Transparency = NumberSequence.new{
        NumberSequenceKeypoint.new(0, 0),
        NumberSequenceKeypoint.new(1, 1)
    }
    transparencyGradient.Rotation = 90
    transparencyGradient.Parent = transparencySlider
    
    local transparencyCursor = Instance.new("Frame")
    transparencyCursor.Name = "TransparencyCursor"
    transparencyCursor.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    transparencyCursor.BorderSizePixel = 2
    transparencyCursor.BorderColor3 = Color3.fromRGB(0, 0, 0)
    transparencyCursor.Size = UDim2.new(1, 0, 0, 6)
    transparencyCursor.Position = UDim2.new(0, 0, currentTransparency, -3)
    transparencyCursor.Parent = transparencyFrame
    
    -- Preview area
    local previewArea = Instance.new("Frame")
    previewArea.BackgroundTransparency = 1
    previewArea.Position = UDim2.new(0, 200, 0, 10)
    previewArea.Size = UDim2.new(0, 60, 0, 60)
    previewArea.Parent = expandedFrame
    
    local previewColor = Instance.new("Frame")
    previewColor.Name = "PreviewColor"
    previewColor.BackgroundColor3 = currentColor
    previewColor.BackgroundTransparency = currentTransparency
    previewColor.Size = UDim2.new(1, 0, 1, 0)
    previewColor.Parent = previewArea
    
    local previewCorner2 = Instance.new("UICorner")
    previewCorner2.CornerRadius = UDim.new(0, 6)
    previewCorner2.Parent = previewColor
    
    -- Hex input
    local hexFrame = Instance.new("Frame")
    hexFrame.BackgroundTransparency = 1
    hexFrame.Position = UDim2.new(0, 10, 0, 140)
    hexFrame.Size = UDim2.new(0, 120, 0, 25)
    hexFrame.Parent = expandedFrame
    
    local hexInput = Instance.new("TextBox")
    hexInput.Name = "HexInput"
    hexInput.PlaceholderText = "#FFFFFF"
    hexInput.Text = rgbToHex(currentColor)
    hexInput.TextColor3 = Color3.fromRGB(255, 255, 255)
    hexInput.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    hexInput.Position = UDim2.new(0, 0, 0, 0)
    hexInput.Size = UDim2.new(1, 0, 1, 0)
    hexInput.Font = Enum.Font.Gotham
    hexInput.TextSize = 12
    hexInput.Parent = hexFrame
    
    local hexCorner = Instance.new("UICorner")
    hexCorner.CornerRadius = UDim.new(0, 4)
    hexCorner.Parent = hexInput
    
    -- Action buttons
    local buttonsFrame = Instance.new("Frame")
    buttonsFrame.BackgroundTransparency = 1
    buttonsFrame.Position = UDim2.new(0, 140, 0, 140)
    buttonsFrame.Size = UDim2.new(0, 120, 0, 25)
    buttonsFrame.Parent = expandedFrame
    
    local applyButton = Instance.new("TextButton")
    applyButton.Name = "ApplyButton"
    applyButton.Text = "âœ“ Apply"
    applyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    applyButton.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
    applyButton.Position = UDim2.new(0, 0, 0, 0)
    applyButton.Size = UDim2.new(0.5, -2, 1, 0)
    applyButton.Font = Enum.Font.Gotham
    applyButton.TextSize = 12
    applyButton.Parent = buttonsFrame
    
    local cancelButton = Instance.new("TextButton")
    cancelButton.Name = "CancelButton"
    cancelButton.Text = "âœ— Cancel"
    cancelButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    cancelButton.BackgroundColor3 = Color3.fromRGB(150, 50, 50)
    cancelButton.Position = UDim2.new(0.5, 2, 0, 0)
    cancelButton.Size = UDim2.new(0.5, -2, 1, 0)
    cancelButton.Font = Enum.Font.Gotham
    cancelButton.TextSize = 12
    cancelButton.Parent = buttonsFrame
    
    local applyCorner = Instance.new("UICorner")
    applyCorner.CornerRadius = UDim.new(0, 4)
    applyCorner.Parent = applyButton
    
    local cancelCorner = Instance.new("UICorner")
    cancelCorner.CornerRadius = UDim.new(0, 4)
    cancelCorner.Parent = cancelButton
    
    -- Helper functions
    local function rgbToHex(color)
        return string.format("#%02X%02X%02X", 
            math.floor(color.R * 255),
            math.floor(color.G * 255),
            math.floor(color.B * 255))
    end
    
    local function hexToRgb(hex)
        hex = hex:gsub("#", "")
        if #hex == 3 then
            hex = hex:gsub("(.)", "%1%1")
        end
        return Color3.fromRGB(
            tonumber(hex:sub(1, 2), 16) or 255,
            tonumber(hex:sub(3, 4), 16) or 255,
            tonumber(hex:sub(5, 6), 16) or 255
        )
    end
    
    local function updatePreview(color, transparency)
        color = color or currentColor
        transparency = transparency or currentTransparency
        
        previewColor.BackgroundColor3 = color
        previewColor.BackgroundTransparency = transparency
        hexInput.Text = rgbToHex(color)
        
        -- Update transparency slider color
        transparencySlider.BackgroundColor3 = color
    end
    
    local function updateFromWheel(x, y)
        local centerX = 60
        local centerY = 60
        local dx = x - centerX
        local dy = y - centerY
        local distance = math.sqrt(dx * dx + dy * dy)
        local radius = 55
        
        if distance <= radius then
            -- Calculate hue
            local angle = math.atan2(dy, dx)
            local hue = (angle + math.pi) / (2 * math.pi)
            
            -- Calculate saturation from distance
            local saturation = distance / radius
            
            -- Calculate value from brightness cursor
            local brightnessY = (brightnessCursor.Position.Y.Offset + 3) / 120
            local value = 1 - math.clamp(brightnessY, 0, 1)
            
            -- Convert HSV to RGB
            local color = Color3.fromHSV(hue, saturation, value)
            
            -- Update cursor position
            wheelCursor.Position = UDim2.new(0, x - 4, 0, y - 4)
            
            -- Update preview
            updatePreview(color, currentTransparency)
        end
    end
    
    local function updateFromBrightness(y)
        local brightness = 1 - math.clamp(y / 120, 0, 1)
        brightnessCursor.Position = UDim2.new(0, 0, 0, y - 3)
        
        -- Get current hue/saturation from wheel cursor
        local wheelX = wheelCursor.Position.X.Offset + 4
        local wheelY = wheelCursor.Position.Y.Offset + 4
        local centerX = 60
        local centerY = 60
        local dx = wheelX - centerX
        local dy = wheelY - centerY
        local distance = math.sqrt(dx * dx + dy * dy)
        local radius = 55
        
        if distance <= radius then
            local angle = math.atan2(dy, dx)
            local hue = (angle + math.pi) / (2 * math.pi)
            local saturation = distance / radius
            
            local color = Color3.fromHSV(hue, saturation, brightness)
            updatePreview(color, currentTransparency)
        end
    end
    
    local function updateFromTransparency(y)
        currentTransparency = math.clamp(y / 120, 0, 1)
        transparencyCursor.Position = UDim2.new(0, 0, 0, y - 3)
        updatePreview(currentColor, currentTransparency)
    end
    
    -- Initialize wheel cursor from current color
    local h, s, v = Color3.toHSV(currentColor)
    local angle = h * 2 * math.pi - math.pi
    local distance = s * 55
    local wheelX = 60 + math.cos(angle) * distance
    local wheelY = 60 + math.sin(angle) * distance
    wheelCursor.Position = UDim2.new(0, wheelX - 4, 0, wheelY - 4)
    
    -- Initialize brightness cursor
    local brightnessY = 120 * (1 - v)
    brightnessCursor.Position = UDim2.new(0, 0, 0, brightnessY - 3)
    
    -- Initialize transparency cursor
    local transparencyY = 120 * currentTransparency
    transparencyCursor.Position = UDim2.new(0, 0, 0, transparencyY - 3)
    
    -- Initialize preview
    updatePreview(currentColor, currentTransparency)
    
    -- Event handlers
    colorButton.MouseButton1Click:Connect(function()
        expandedFrame.Visible = not expandedFrame.Visible
        container.Size = expandedFrame.Visible and UDim2.new(1, 0, 0, 245) or UDim2.new(1, 0, 0, 40)
    end)
    
    -- Color wheel interaction
    local wheelDragging = false
    colorWheel.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            wheelDragging = true
            local mousePos = input.Position
            local wheelPos = colorWheel.AbsolutePosition
            local x = mousePos.X - wheelPos.X
            local y = mousePos.Y - wheelPos.Y
            updateFromWheel(x, y)
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if wheelDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local mousePos = input.Position
            local wheelPos = colorWheel.AbsolutePosition
            local x = mousePos.X - wheelPos.X
            local y = mousePos.Y - wheelPos.Y
            updateFromWheel(x, y)
        end
    end)
    
    game:GetService("UserInputService").InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            wheelDragging = false
        end
    end)
    
    -- Brightness slider interaction
    local brightnessDragging = false
    brightnessFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            brightnessDragging = true
            local mousePos = input.Position
            local sliderPos = brightnessFrame.AbsolutePosition
            local y = mousePos.Y - sliderPos.Y
            updateFromBrightness(y)
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if brightnessDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local mousePos = input.Position
            local sliderPos = brightnessFrame.AbsolutePosition
            local y = mousePos.Y - sliderPos.Y
            updateFromBrightness(y)
        end
    end)
    
    game:GetService("UserInputService").InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            brightnessDragging = false
        end
    end)
    
    -- Transparency slider interaction
    local transparencyDragging = false
    transparencyFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            transparencyDragging = true
            local mousePos = input.Position
            local sliderPos = transparencyFrame.AbsolutePosition
            local y = mousePos.Y - sliderPos.Y
            updateFromTransparency(y)
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if transparencyDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local mousePos = input.Position
            local sliderPos = transparencyFrame.AbsolutePosition
            local y = mousePos.Y - sliderPos.Y
            updateFromTransparency(y)
        end
    end)
    
    game:GetService("UserInputService").InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            transparencyDragging = false
        end
    end)
    
    -- Hex input
    hexInput.FocusLost:Connect(function()
        local text = hexInput.Text:upper()
        if text:match("^#[0-9A-F][0-9A-F][0-9A-F][0-9A-F][0-9A-F][0-9A-F]$") or 
           text:match("^#[0-9A-F][0-9A-F][0-9A-F]$") then
            local color = hexToRgb(text)
            updatePreview(color, currentTransparency)
        else
            hexInput.Text = rgbToHex(currentColor)
        end
    end)
    
    -- Apply button
    applyButton.MouseButton1Click:Connect(function()
        currentColor = previewColor.BackgroundColor3
        currentTransparency = previewColor.BackgroundTransparency
        
        -- Update main preview
        colorPreview.BackgroundColor3 = currentColor
        colorPreview.BackgroundTransparency = currentTransparency
        
        -- Save config
        saveConfig(currentColor, currentTransparency)
        
        -- Update title to show saved
        titleLabel.Text = label .. " âœ“"
        
        -- Call callback
        if callback then
            callback(currentColor, currentTransparency)
        end
        
        -- Close picker
        expandedFrame.Visible = false
        container.Size = UDim2.new(1, 0, 0, 40)
    end)
    
    -- Cancel button
    cancelButton.MouseButton1Click:Connect(function()
        -- Reset to original values
        updatePreview(currentColor, currentTransparency)
        expandedFrame.Visible = false
        container.Size = UDim2.new(1, 0, 0, 40)
    end)
    
    -- Return the color picker object
    local colorPickerObj = {}
    
    function colorPickerObj:SetColor(color)
        currentColor = color
        colorPreview.BackgroundColor3 = color
        previewColor.BackgroundColor3 = color
        hexInput.Text = rgbToHex(color)
        
        -- Update wheel cursor
        local h, s, v = Color3.toHSV(color)
        local angle = h * 2 * math.pi - math.pi
        local distance = s * 55
        local wheelX = 60 + math.cos(angle) * distance
        local wheelY = 60 + math.sin(angle) * distance
        wheelCursor.Position = UDim2.new(0, wheelX - 4, 0, wheelY - 4)
        
        -- Update brightness cursor
        local brightnessY = 120 * (1 - v)
        brightnessCursor.Position = UDim2.new(0, 0, 0, brightnessY - 3)
    end
    
    function colorPickerObj:SetTransparency(transparency)
        currentTransparency = transparency
        colorPreview.BackgroundTransparency = transparency
        previewColor.BackgroundTransparency = transparency
        
        -- Update transparency cursor
        local transparencyY = 120 * transparency
        transparencyCursor.Position = UDim2.new(0, 0, 0, transparencyY - 3)
    end
    
    function colorPickerObj:GetColor()
        return currentColor
    end
    
    function colorPickerObj:GetTransparency()
        return currentTransparency
    end
    
    function colorPickerObj:SetVisible(visible)
        container.Visible = visible
    end
    
    function colorPickerObj:IsVisible()
        return container.Visible
    end
    
    function colorPickerObj:Destroy()
        container:Destroy()
    end
    
    function colorPickerObj:SetLabel(newLabel)
        titleLabel.Text = newLabel .. (savedConfig and " âœ“" or "")
    end
    
    function colorPickerObj:SaveConfig()
        saveConfig(currentColor, currentTransparency)
        titleLabel.Text = titleLabel.Text:gsub(" âœ“", "") .. " âœ“"
    end
    
    function colorPickerObj:LoadConfig()
        local config = loadConfig()
        if config then
            self:SetColor(config.Color)
            self:SetTransparency(config.Transparency)
            titleLabel.Text = titleLabel.Text:gsub(" âœ“", "") .. " âœ“"
        end
    end
    
    return colorPickerObj
end


-- Create Label (Voidware Style)
function GuiLibrary:CreateLabel(tab, labelText)
    local label = Instance.new("TextLabel")
    label.Name = "Label"
    label.Size = UDim2.new(1, 0, 0, 22)
    label.BackgroundTransparency = 1
    label.Text = labelText
    label.TextColor3 = Theme.TextSecondary
    label.TextSize = 11
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Font = Enum.Font.Gotham
    label.Parent = tab.Frame
    
    return label
end

-- Create Separator (Voidware Style - Improved)
function GuiLibrary:CreateSeparator(tab, separatorName)
    local separator = Instance.new("Frame")
    separator.Name = "Separator_" .. (separatorName or "Separator")
    separator.Size = UDim2.new(1, 0, 0, 28)
    separator.BackgroundTransparency = 1
    separator.Parent = tab.Frame
    
    local line = Instance.new("Frame")
    line.Name = "Line"
    line.Size = UDim2.new(1, -20, 0, 2) -- Thicker line
    line.Position = UDim2.new(0, 10, 0.5, 0)
    line.BackgroundColor3 = Color3.fromRGB(80, 80, 80) -- Dark gray for contrast
    line.BorderSizePixel = 0
    line.Parent = separator
    
    local label = Instance.new("TextLabel")
    label.Name = "Label"
    label.Size = UDim2.new(0, 0, 0, 20) -- Auto-size width
    label.Position = UDim2.new(0, 10, 0.5, 0) -- Changed to left position
    label.AnchorPoint = Vector2.new(0, 0.5) -- Changed anchor to left
    label.BackgroundColor3 = Color3.fromRGB(30, 30, 30) -- Dark background
    label.BackgroundTransparency = 0
    label.BorderSizePixel = 0
    label.Text = (separatorName or "Separator")-- Bold format with brackets
    label.TextColor3 = Color3.fromRGB(255, 255, 255) -- Bright white text
    label.TextSize = 12
    label.Font = Enum.Font.GothamBold -- Bold font
    label.TextStrokeColor3 = Color3.fromRGB(0, 0, 0) -- Black outline
    label.TextStrokeTransparency = 0.3 -- Slight outline for readability
    label.TextXAlignment = Enum.TextXAlignment.Left -- Left align text
    label.Parent = separator
    
    -- Auto-size the label to fit text
    local textSize = game:GetService("TextService"):GetTextSize(label.Text, label.TextSize, label.Font, Vector2.new(1000, 20))
    label.Size = UDim2.new(0, textSize.X + 20, 0, 20)
    
    local labelCorner = Instance.new("UICorner")
    labelCorner.CornerRadius = UDim.new(0, 6)
    labelCorner.Parent = label
    
    return separator
end
-- Create Dropdown (Voidware Style) with Premium Support
function GuiLibrary:CreateDropdown(tab, dropdownName, options, defaultSelection, callback, isPremium)
    local dropdown = Instance.new("TextButton")
    dropdown.Name = "Dropdown_" .. dropdownName
    dropdown.Size = UDim2.new(1, 0, 0, 32)
    dropdown.BackgroundColor3 = Theme.Secondary
    dropdown.BackgroundTransparency = 0.4
    dropdown.BorderSizePixel = 0
    dropdown.Text = ""
    dropdown.ZIndex = 5
    dropdown.Parent = tab.Frame

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 4)
    corner.Parent = dropdown

    local label = Instance.new("TextLabel")
    label.Name = "Label"
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.Position = UDim2.new(0, 10, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = dropdownName
    label.TextColor3 = Theme.Text
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Font = Enum.Font.Gotham
    label.ZIndex = 6
    label.Parent = dropdown

    local valueLabel = Instance.new("TextLabel")
    valueLabel.Name = "Value"
    valueLabel.Size = UDim2.new(0.25, 0, 1, 0)
    valueLabel.Position = UDim2.new(0.75, 0, 0, 0)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Text = defaultSelection or "Select..."
    valueLabel.TextColor3 = Theme.TextSecondary
    valueLabel.TextSize = 11
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    valueLabel.Font = Enum.Font.Gotham
    valueLabel.ZIndex = 6
    valueLabel.Parent = dropdown

    local arrow = Instance.new("TextLabel")
    arrow.Name = "Arrow"
    arrow.Size = UDim2.new(0, 16, 0, 16)
    arrow.Position = UDim2.new(1, -20, 0.5, -8)
    arrow.BackgroundTransparency = 1
    arrow.Text = "â–¼"
    arrow.TextColor3 = Theme.TextSecondary
    arrow.TextSize = 10
    arrow.Font = Enum.Font.Gotham
    arrow.ZIndex = 6
    arrow.Parent = dropdown

    -- Options Frame
    local optionsFrame = Instance.new("ScrollingFrame")
    optionsFrame.Name = "Options"
    optionsFrame.Size = UDim2.new(1, 0, 0, 0)
    optionsFrame.Position = UDim2.new(0, 0, 1, 3)
    optionsFrame.BackgroundColor3 = Theme.Secondary
    optionsFrame.BackgroundTransparency = 0.2
    optionsFrame.BorderSizePixel = 0
    optionsFrame.ScrollBarThickness = 3
    optionsFrame.ScrollBarImageColor3 = Theme.Accent
    optionsFrame.ScrollBarImageTransparency = 0.5
    optionsFrame.Visible = false
    optionsFrame.ClipsDescendants = true
    optionsFrame.ZIndex = 20
    optionsFrame.Parent = dropdown

    local optionsCorner = Instance.new("UICorner")
    optionsCorner.CornerRadius = UDim.new(0, 4)
    optionsCorner.Parent = optionsFrame

    local optionsLayout = Instance.new("UIListLayout")
    optionsLayout.Padding = UDim.new(0, 2)
    optionsLayout.SortOrder = Enum.SortOrder.LayoutOrder
    optionsLayout.Parent = optionsFrame

    local optionsPadding = Instance.new("UIPadding")
    optionsPadding.PaddingTop = UDim.new(0, 4)
    optionsPadding.PaddingBottom = UDim.new(0, 4)
    optionsPadding.PaddingLeft = UDim.new(0, 4)
    optionsPadding.PaddingRight = UDim.new(0, 4)
    optionsPadding.Parent = optionsFrame

    local isOpen = false
    local selectedOption = defaultSelection

    if defaultSelection and not table.find(options, defaultSelection) then
        selectedOption = nil
        valueLabel.Text = "Select..."
    end

    -- Mark as premium if required
    local premiumLock
    if isPremium and not IsPremium then
        premiumLock = self:MarkAsPremium(dropdown, "PREMIUM")
        callback = function() end -- Disable callback for non-premium users
    end

    -- Create options
    for i, option in ipairs(options) do
        local optionButton = Instance.new("TextButton")
        optionButton.Name = option
        optionButton.Size = UDim2.new(1, 0, 0, 22)
        optionButton.BackgroundColor3 = Theme.Secondary
        optionButton.BackgroundTransparency = 0.4
        optionButton.BorderSizePixel = 0
        optionButton.Text = option
        optionButton.TextColor3 = Theme.TextSecondary
        optionButton.TextSize = 11
        optionButton.Font = Enum.Font.Gotham
        optionButton.LayoutOrder = i
        optionButton.ZIndex = 21
        optionButton.Parent = optionsFrame

        local optionCorner = Instance.new("UICorner")
        optionCorner.CornerRadius = UDim.new(0, 3)
        optionCorner.Parent = optionButton

        if option == selectedOption then
            optionButton.BackgroundColor3 = Theme.Accent
            optionButton.BackgroundTransparency = 0.3
            optionButton.TextColor3 = Theme.Text
        end

        optionButton.MouseButton1Click:Connect(function()
            if isPremium and not IsPremium then return end
            
            selectedOption = option
            valueLabel.Text = option
            
            for _, btn in pairs(optionsFrame:GetChildren()) do
                if btn:IsA("TextButton") then
                    if btn.Name == option then
                        btn.BackgroundColor3 = Theme.Accent
                        btn.BackgroundTransparency = 0.3
                        btn.TextColor3 = Theme.Text
                    else
                        btn.BackgroundColor3 = Theme.Secondary
                        btn.BackgroundTransparency = 0.4
                        btn.TextColor3 = Theme.TextSecondary
                    end
                end
            end
            
            isOpen = false
            optionsFrame.Visible = false
            TweenService:Create(arrow, TweenInfo.new(0.2), {Rotation = 0}):Play()
            TweenService:Create(optionsFrame, TweenInfo.new(0.2), {Size = UDim2.new(1, 0, 0, 0)}):Play()
            
            if callback then
                callback(option)
            end
        end)
    end

    -- Update canvas size
    optionsLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        optionsFrame.CanvasSize = UDim2.new(0, 0, 0, optionsLayout.AbsoluteContentSize.Y + 8)
    end)

    -- Toggle dropdown
    dropdown.MouseButton1Click:Connect(function()
        if isPremium and not IsPremium then return end
        
        isOpen = not isOpen
        
        if isOpen then
            optionsFrame.Visible = true
            local height = math.min(#options * 24 + 8, 150)
            TweenService:Create(arrow, TweenInfo.new(0.2), {Rotation = 180}):Play()
            TweenService:Create(optionsFrame, TweenInfo.new(0.2), {Size = UDim2.new(1, 0, 0, height)}):Play()
            
            dropdown.ZIndex = 25
            optionsFrame.ZIndex = 26
            for _, child in pairs(optionsFrame:GetChildren()) do
                if child:IsA("GuiObject") then
                    child.ZIndex = 27
                end
            end
        else
            TweenService:Create(arrow, TweenInfo.new(0.2), {Rotation = 0}):Play()
            TweenService:Create(optionsFrame, TweenInfo.new(0.2), {Size = UDim2.new(1, 0, 0, 0)}):Play()
            wait(0.2)
            optionsFrame.Visible = false
            
            dropdown.ZIndex = 5
            optionsFrame.ZIndex = 20
        end
    end)

    -- Close dropdown
    local function closeDropdown(input)
        if isOpen and input.UserInputType == Enum.UserInputType.MouseButton1 then
            local mousePos = input.Position
            local dropdownAbsPos = dropdown.AbsolutePosition
            local dropdownSize = dropdown.AbsoluteSize
            local optionsAbsPos = optionsFrame.AbsolutePosition
            local optionsSize = optionsFrame.AbsoluteSize
            
            local isInsideDropdown = (mousePos.X >= dropdownAbsPos.X and mousePos.X <= dropdownAbsPos.X + dropdownSize.X and
                                    mousePos.Y >= dropdownAbsPos.Y and mousePos.Y <= dropdownAbsPos.Y + dropdownSize.Y)
            
            local isInsideOptions = (mousePos.X >= optionsAbsPos.X and mousePos.X <= optionsAbsPos.X + optionsSize.X and
                                   mousePos.Y >= optionsAbsPos.Y and mousePos.Y <= optionsAbsPos.Y + optionsSize.Y)
            
            if not isInsideDropdown and not isInsideOptions then
                isOpen = false
                TweenService:Create(arrow, TweenInfo.new(0.2), {Rotation = 0}):Play()
                TweenService:Create(optionsFrame, TweenInfo.new(0.2), {Size = UDim2.new(1, 0, 0, 0)}):Play()
                wait(0.2)
                optionsFrame.Visible = false
                
                dropdown.ZIndex = 5
                optionsFrame.ZIndex = 20
            end
        end
    end

    UserInputService.InputBegan:Connect(closeDropdown)

    -- Create dropdown object with methods
    local dropdownObj = {
        Instance = dropdown,
        PremiumLock = premiumLock
    }

    function dropdownObj:GetSelection()
        return selectedOption
    end

    function dropdownObj:SetSelection(selection)
        if isPremium and not IsPremium then return end
        
        if selection and table.find(options, selection) then
            selectedOption = selection
            valueLabel.Text = selection
            
            for _, btn in pairs(optionsFrame:GetChildren()) do
                if btn:IsA("TextButton") then
                    if btn.Name == selection then
                        btn.BackgroundColor3 = Theme.Accent
                        btn.BackgroundTransparency = 0.3
                        btn.TextColor3 = Theme.Text
                    else
                        btn.BackgroundColor3 = Theme.Secondary
                        btn.BackgroundTransparency = 0.4
                        btn.TextColor3 = Theme.TextSecondary
                    end
                end
            end
            
            if callback then
                callback(selection)
            end
        else
            selectedOption = nil
            valueLabel.Text = "Select..."
            
            for _, btn in pairs(optionsFrame:GetChildren()) do
                if btn:IsA("TextButton") then
                    btn.BackgroundColor3 = Theme.Secondary
                    btn.BackgroundTransparency = 0.4
                    btn.TextColor3 = Theme.TextSecondary
                end
            end
        end
    end

    function dropdownObj:SetPremium(isPremiumFeature)
        if isPremiumFeature and not IsPremium then
            if not self.PremiumLock then
                self.PremiumLock = GuiLibrary:MarkAsPremium(dropdown, "PREMIUM")
            end
        elseif self.PremiumLock then
            self.PremiumLock.Unlock()
            self.PremiumLock = nil
        end
    end
	if dropdownName and dropdownObj then
        elementRegistry[dropdownName] = dropdownObj
        guiElements[dropdownName] = dropdownObj
    end
    return dropdownObj
end
-- Create Slider (Voidware Style) with Premium Support
function GuiLibrary:CreateSlider(tab, sliderName, minValue, maxValue, defaultValue, callback, isPremium)
    local slider = Instance.new("Frame")
    slider.Name = sliderName
    slider.Size = UDim2.new(1, 0, 0, 55)
    slider.BackgroundTransparency = 1
    slider.Parent = tab.Frame

    local label = Instance.new("TextLabel")
    label.Name = "Label"
    label.Size = UDim2.new(1, 0, 0, 18)
    label.BackgroundTransparency = 1
    label.Text = sliderName
    label.TextColor3 = Theme.Text
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Font = Enum.Font.Gotham
    label.Parent = slider

    local valueLabel = Instance.new("TextLabel")
    valueLabel.Name = "Value"
    valueLabel.Size = UDim2.new(0, 60, 0, 18)
    valueLabel.Position = UDim2.new(1, -60, 0, 0)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Text = tostring(defaultValue or minValue)
    valueLabel.TextColor3 = Theme.TextSecondary
    valueLabel.TextSize = 11
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    valueLabel.Font = Enum.Font.Gotham
    valueLabel.Parent = slider

    local sliderTrack = Instance.new("Frame")
    sliderTrack.Name = "Track"
    sliderTrack.Size = UDim2.new(1, 0, 0, 6)
    sliderTrack.Position = UDim2.new(0, 0, 0, 30)
    sliderTrack.BackgroundColor3 = Theme.Secondary
    sliderTrack.BackgroundTransparency = 0.4
    sliderTrack.BorderSizePixel = 0
    sliderTrack.Parent = slider

    local trackCorner = Instance.new("UICorner")
    trackCorner.CornerRadius = UDim.new(0, 3)
    trackCorner.Parent = sliderTrack

    local sliderFill = Instance.new("Frame")
    sliderFill.Name = "Fill"
    sliderFill.Size = UDim2.new(0, 0, 1, 0)
    sliderFill.BackgroundColor3 = Theme.Accent
    sliderFill.BackgroundTransparency = 0.3
    sliderFill.BorderSizePixel = 0
    sliderFill.Parent = sliderTrack

    local fillCorner = Instance.new("UICorner")
    fillCorner.CornerRadius = UDim.new(0, 3)
    fillCorner.Parent = sliderFill

    local sliderThumb = Instance.new("TextButton")
    sliderThumb.Name = "Thumb"
    sliderThumb.Size = UDim2.new(0, 16, 0, 16)
    sliderThumb.Position = UDim2.new(0, -8, 0.5, -8)
    sliderThumb.BackgroundColor3 = Theme.Text
    sliderThumb.BorderSizePixel = 0
    sliderThumb.Text = ""
    sliderThumb.Parent = sliderTrack

    local thumbCorner = Instance.new("UICorner")
    thumbCorner.CornerRadius = UDim.new(1, 0)
    thumbCorner.Parent = sliderThumb

    local currentValue = defaultValue or minValue
    local isDragging = false

    -- Mark as premium if required
    local premiumLock
    if isPremium and not IsPremium then
        premiumLock = self:MarkAsPremium(slider, "PREMIUM")
        callback = function() end -- Disable callback for non-premium users
        
        -- Also disable the thumb button specifically
        sliderThumb.Active = false
        sliderTrack.Active = false
    end

    local function updateSlider(value, triggerCallback)
        if isPremium and not IsPremium then 
            -- Keep the visual state but don't execute callback
            currentValue = math.clamp(value, minValue, maxValue)
            local percentage = (currentValue - minValue) / (maxValue - minValue)
            
            sliderFill.Size = UDim2.new(percentage, 0, 1, 0)
            sliderThumb.Position = UDim2.new(percentage, -8, 0.5, -8)
            valueLabel.Text = tostring(math.floor(currentValue))
            return 
        end
        
        currentValue = math.clamp(value, minValue, maxValue)
        local percentage = (currentValue - minValue) / (maxValue - minValue)
        
        sliderFill.Size = UDim2.new(percentage, 0, 1, 0)
        sliderThumb.Position = UDim2.new(percentage, -8, 0.5, -8)
        valueLabel.Text = tostring(math.floor(currentValue))
        
        if triggerCallback and callback then
            callback(currentValue)
        end
    end

    updateSlider(currentValue, false)

    local function onInputChanged(input)
        if isDragging and (not isPremium or IsPremium) then
            local relativeX = (input.Position.X - sliderTrack.AbsolutePosition.X) / sliderTrack.AbsoluteSize.X
            local value = minValue + (relativeX * (maxValue - minValue))
            updateSlider(value, true)
        end
    end

    sliderThumb.InputBegan:Connect(function(input)
        if isPremium and not IsPremium then return end
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isDragging = true
        end
    end)

    sliderThumb.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isDragging = false
        end
    end)

    sliderTrack.InputBegan:Connect(function(input)
        if isPremium and not IsPremium then return end
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isDragging = true
            local relativeX = (input.Position.X - sliderTrack.AbsolutePosition.X) / sliderTrack.AbsoluteSize.X
            local value = minValue + (relativeX * (maxValue - minValue))
            updateSlider(value, true)
        end
    end)

    sliderTrack.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            isDragging = false
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if isDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            onInputChanged(input)
        end
    end)

    local sliderObj = {
        Instance = slider,
        PremiumLock = premiumLock
    }

    function sliderObj:GetValue()
        return currentValue
    end

    function sliderObj:SetValue(value)
        if isPremium and not IsPremium then 
            -- Allow visual update but no callback
            updateSlider(value, false)
            return 
        end
        updateSlider(value, true)
    end

    function sliderObj:SetPremium(isPremiumFeature)
        if isPremiumFeature and not IsPremium then
            if not self.PremiumLock then
                self.PremiumLock = GuiLibrary:MarkAsPremium(slider, "PREMIUM")
                -- Disable interaction
                sliderThumb.Active = false
                sliderTrack.Active = false
            end
        elseif self.PremiumLock then
            self.PremiumLock.Unlock()
            self.PremiumLock = nil
            -- Re-enable interaction
            sliderThumb.Active = true
            sliderTrack.Active = true
        end
    end
	if sliderName and sliderObj then
        elementRegistry[sliderName] = sliderObj
        guiElements[sliderName] = sliderObj
    end
	
    return sliderObj
end


-- Input Text Field (Voidware Style) with Premium Support
function GuiLibrary:CreateInput(tab, inputName, placeholder, defaultValue, callback, isPremium)
    local inputFrame = Instance.new("Frame")
    inputFrame.Name = "Input_" .. inputName
    inputFrame.Size = UDim2.new(1, 0, 0, 32)
    inputFrame.BackgroundTransparency = 1
    inputFrame.Parent = tab.Frame

    local label = Instance.new("TextLabel")
    label.Name = "Label"
    label.Size = UDim2.new(0.4, 0, 1, 0)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = inputName
    label.TextColor3 = Theme.Text
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Font = Enum.Font.Gotham
    label.Parent = inputFrame

    local textBox = Instance.new("TextBox")
    textBox.Name = "TextBox"
    textBox.Size = UDim2.new(0.6, 0, 1, 0)
    textBox.Position = UDim2.new(0.4, 0, 0, 0)
    textBox.BackgroundColor3 = Theme.Secondary
    textBox.BackgroundTransparency = 0.4
    textBox.BorderSizePixel = 0
    textBox.Text = defaultValue or ""
    textBox.PlaceholderText = placeholder or "Enter text..."
    textBox.TextColor3 = Theme.Text
    textBox.PlaceholderColor3 = Theme.TextSecondary
    textBox.TextSize = 11
    textBox.Font = Enum.Font.Gotham
    textBox.ClearTextOnFocus = false
    textBox.Parent = inputFrame

    local textBoxCorner = Instance.new("UICorner")
    textBoxCorner.CornerRadius = UDim.new(0, 4)
    textBoxCorner.Parent = textBox

    local textBoxPadding = Instance.new("UIPadding")
    textBoxPadding.PaddingLeft = UDim.new(0, 8)
    textBoxPadding.PaddingRight = UDim.new(0, 8)
    textBoxPadding.Parent = textBox

    -- Mark as premium if required
    local premiumLock
    if isPremium and not IsPremium then
        premiumLock = self:MarkAsPremium(inputFrame, "PREMIUM")
        callback = function() end -- Disable callback for non-premium users
    end

    -- TextBox effects
    textBox.Focused:Connect(function()
        if isPremium and not IsPremium then return end
        TweenService:Create(textBox, TweenInfo.new(0.1), {BackgroundTransparency = 0.2}):Play()
    end)

    textBox.FocusLost:Connect(function(enterPressed)
        if isPremium and not IsPremium then return end
        TweenService:Create(textBox, TweenInfo.new(0.1), {BackgroundTransparency = 0.4}):Play()
        
        if callback then
            callback(textBox.Text, enterPressed)
        end
    end)

    -- Create input object with methods
    local inputObj = {
        Instance = inputFrame,
        PremiumLock = premiumLock
    }

    function inputObj:GetValue()
        return textBox.Text
    end

    function inputObj:SetValue(value)
        if isPremium and not IsPremium then return end
        textBox.Text = value or ""
    end

    function inputObj:SetPlaceholder(text)
        textBox.PlaceholderText = text or ""
    end

    function inputObj:SetPremium(isPremiumFeature)
        if isPremiumFeature and not IsPremium then
            if not self.PremiumLock then
                self.PremiumLock = GuiLibrary:MarkAsPremium(inputFrame, "PREMIUM")
            end
        elseif self.PremiumLock then
            self.PremiumLock.Unlock()
            self.PremiumLock = nil
        end
    end
	if inputName and inputObj then
        elementRegistry[inputName] = inputObj
        guiElements[inputName] = inputObj
    end
    return inputObj
end
-- Multi Dropdown Function (Voidware Style) with Premium Support - FIXED MOBILE COMPATIBILITY
function GuiLibrary:CreateMultiDropdown(tab, dropdownName, options, defaultSelections, callback, isPremium)
    local uniqueName = "MultiDropdown_" .. dropdownName .. "_" .. tostring(tick()):gsub("%.", "")
 
    local multiDropdown = Instance.new("TextButton")
    multiDropdown.Name = uniqueName
    multiDropdown.Size = UDim2.new(1, 0, 0, 32)
    multiDropdown.BackgroundColor3 = Theme.Secondary
    multiDropdown.BackgroundTransparency = 0.4
    multiDropdown.BorderSizePixel = 0
    multiDropdown.Text = ""
    multiDropdown.ZIndex = 20
    multiDropdown.Parent = tab.Frame
 
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 4)
    corner.Parent = multiDropdown
 
    local label = Instance.new("TextLabel")
    label.Name = "Label"
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.Position = UDim2.new(0, 10, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = dropdownName
    label.TextColor3 = Theme.Text
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Font = Enum.Font.Gotham
    label.ZIndex = 21
    label.Parent = multiDropdown
 
    local valueLabel = Instance.new("TextLabel")
    valueLabel.Name = "Value"
    valueLabel.Size = UDim2.new(0.25, 0, 1, 0)
    valueLabel.Position = UDim2.new(0.75, 0, 0, 0)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Text = "Select..."
    valueLabel.TextColor3 = Theme.TextSecondary
    valueLabel.TextSize = 11
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    valueLabel.Font = Enum.Font.Gotham
    valueLabel.ZIndex = 21
    valueLabel.Parent = multiDropdown
 
    local arrow = Instance.new("TextLabel")
    arrow.Name = "Arrow"
    arrow.Size = UDim2.new(0, 16, 0, 16)
    arrow.Position = UDim2.new(1, -20, 0.5, -8)
    arrow.BackgroundTransparency = 1
    arrow.Text = "â–¼"
    arrow.TextColor3 = Theme.TextSecondary
    arrow.TextSize = 10
    arrow.Font = Enum.Font.Gotham
    arrow.ZIndex = 21
    arrow.Parent = multiDropdown
 
    -- Options Frame as ScrollingFrame - IMPROVED FOR MOBILE
    local optionsFrame = Instance.new("ScrollingFrame")
    optionsFrame.Name = "OptionsFrame"
    optionsFrame.Size = UDim2.new(1, 0, 0, 0) -- Start closed
    optionsFrame.Position = UDim2.new(0, 0, 1, 3)
    optionsFrame.BackgroundColor3 = Theme.Secondary
    optionsFrame.BackgroundTransparency = 0.2
    optionsFrame.BorderSizePixel = 0
    optionsFrame.ScrollBarThickness = isMobile and 8 or 4 -- Thicker on mobile
    optionsFrame.ScrollBarImageColor3 = Theme.Accent
    optionsFrame.ScrollBarImageTransparency = 0.5
    optionsFrame.VerticalScrollBarInset = Enum.ScrollBarInset.Always
    optionsFrame.ScrollingDirection = Enum.ScrollingDirection.Y
    optionsFrame.VerticalScrollBarPosition = Enum.VerticalScrollBarPosition.Right
    optionsFrame.Visible = false
    optionsFrame.ClipsDescendants = true
    optionsFrame.ZIndex = 50
    optionsFrame.Parent = multiDropdown
 
    local optionsCorner = Instance.new("UICorner")
    optionsCorner.CornerRadius = UDim.new(0, 4)
    optionsCorner.Parent = optionsFrame
 
    local optionsLayout = Instance.new("UIListLayout")
    optionsLayout.Padding = UDim.new(0, isMobile and 6 or 3) -- More spacing on mobile
    optionsLayout.SortOrder = Enum.SortOrder.LayoutOrder
    optionsLayout.Parent = optionsFrame
 
    local optionsPadding = Instance.new("UIPadding")
    optionsPadding.PaddingTop = UDim.new(0, isMobile and 10 or 6)
    optionsPadding.PaddingBottom = UDim.new(0, isMobile and 10 or 6)
    optionsPadding.PaddingLeft = UDim.new(0, isMobile and 10 or 6)
    optionsPadding.PaddingRight = UDim.new(0, isMobile and 10 or 6)
    optionsPadding.Parent = optionsFrame
 
    local selectedOptions = {}
    local isOpen = false
 
    -- Handle default selections
    if defaultSelections then
        if typeof(defaultSelections) == "table" then
            if #defaultSelections > 0 then
                for _, option in ipairs(defaultSelections) do
                    if table.find(options, option) then
                        selectedOptions[option] = true
                    end
                end
            else
                for option, isSelected in pairs(defaultSelections) do
                    if table.find(options, option) and isSelected then
                        selectedOptions[option] = true
                    end
                end
            end
        end
    end
 
    -- Mark as premium if required
    local premiumLock
    if isPremium and not IsPremium then
        premiumLock = self:MarkAsPremium(multiDropdown, "PREMIUM")
        callback = function() end -- Disable callback for non-premium users
    end
 
    local function updateDisplayText()
        local selectedCount = 0
 
        for option, isSelected in pairs(selectedOptions) do
            if isSelected then
                selectedCount = selectedCount + 1
            end
        end
 
        if selectedCount == 0 then
            valueLabel.Text = "Select..."
        else
            valueLabel.Text = selectedCount .. " selected"
        end
    end
 
    updateDisplayText()
 
    -- Create option buttons with better mobile support
    for i, option in ipairs(options) do
        local optionButton = Instance.new("TextButton")
        optionButton.Name = "Option_" .. option
        optionButton.Size = UDim2.new(1, -8, 0, isMobile and 32 or 22) -- Taller on mobile for better touch
        optionButton.BackgroundColor3 = Theme.Secondary
        optionButton.BackgroundTransparency = 0.4
        optionButton.BorderSizePixel = 0
        optionButton.Text = option
        optionButton.TextColor3 = Theme.Text
        optionButton.TextSize = isMobile and 14 or 11 -- Larger text on mobile
        optionButton.TextXAlignment = Enum.TextXAlignment.Left
        optionButton.Font = Enum.Font.Gotham
        optionButton.LayoutOrder = i
        optionButton.ZIndex = 51
        optionButton.Parent = optionsFrame
 
        local optionCorner = Instance.new("UICorner")
        optionCorner.CornerRadius = UDim.new(0, 4)
        optionCorner.Parent = optionButton
 
        local textPadding = Instance.new("UIPadding")
        textPadding.PaddingLeft = UDim.new(0, isMobile and 16 or 8) -- More padding on mobile
        textPadding.Parent = optionButton
 
        -- Set initial state
        if selectedOptions[option] then
            optionButton.BackgroundColor3 = Theme.Accent
            optionButton.BackgroundTransparency = 0.3
        else
            optionButton.BackgroundColor3 = Theme.Secondary
            optionButton.BackgroundTransparency = 0.4
        end
 
        -- Button interaction with improved mobile support
        local function handleOptionClick()
            if isPremium and not IsPremium then return end
 
            selectedOptions[option] = not selectedOptions[option]
 
            if selectedOptions[option] then
                optionButton.BackgroundColor3 = Theme.Accent
                optionButton.BackgroundTransparency = 0.3
            else
                optionButton.BackgroundColor3 = Theme.Secondary
                optionButton.BackgroundTransparency = 0.4
            end
 
            updateDisplayText()
 
            if callback then
                local selectionsArray = {}
                for opt, isSelected in pairs(selectedOptions) do
                    if isSelected then
                        table.insert(selectionsArray, opt)
                    end
                end
                callback(selectionsArray, selectedOptions)
            end
        end
 
        -- Improved mobile touch handling
        if isMobile then
            -- Use InputBegan for better touch detection
            local touchStartTime = 0
            local touchStartPos = nil
            
            optionButton.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.Touch then
                    touchStartTime = tick()
                    touchStartPos = input.Position
                    
                    -- Visual feedback for touch
                    TweenService:Create(optionButton, TweenInfo.new(0.1), {
                        BackgroundTransparency = 0.2
                    }):Play()
                end
            end)
            
            optionButton.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.Touch then
                    local touchDuration = tick() - touchStartTime
                    
                    -- Reset visual feedback
                    TweenService:Create(optionButton, TweenInfo.new(0.1), {
                        BackgroundTransparency = selectedOptions[option] and 0.3 or 0.4
                    }):Play()
                    
                    -- Only register as click if it was a quick tap (not a scroll)
                    if touchDuration < 0.3 then
                        handleOptionClick()
                    end
                end
            end)
        else
            -- Desktop mouse handling
            optionButton.MouseButton1Click:Connect(handleOptionClick)
        end
    end
 
    -- Calculate optimal dropdown height based on content and screen size
    local function calculateOptimalHeight()
        local optionHeight = isMobile and 32 or 22
        local padding = isMobile and 20 or 12
        local maxVisibleOptions = isMobile and 4 or 6 -- Show fewer options on mobile
 
        local totalContentHeight = (#options * optionHeight) + ((#options - 1) * optionsLayout.Padding.Offset) + padding
        local maxHeight = optionHeight * maxVisibleOptions + padding
 
        return math.min(totalContentHeight, maxHeight)
    end
 
    -- Toggle dropdown with smooth animations
    local function toggleDropdown()
        if isPremium and not IsPremium then return end
 
        isOpen = not isOpen
 
        if isOpen then
            -- Open dropdown
            optionsFrame.Visible = true
            local targetHeight = calculateOptimalHeight()
 
            -- Animate arrow and dropdown
            TweenService:Create(arrow, TweenInfo.new(0.2), {Rotation = 180}):Play()
            TweenService:Create(optionsFrame, TweenInfo.new(0.2), {Size = UDim2.new(1, 0, 0, targetHeight)}):Play()
 
            -- Increase ZIndex to appear above other elements
            multiDropdown.ZIndex = 60
            optionsFrame.ZIndex = 61
            for _, child in pairs(optionsFrame:GetChildren()) do
                if child:IsA("GuiObject") then
                    child.ZIndex = 62
                end
            end
 
            -- Auto-scroll to show selected options
            spawn(function()
                wait(0.25) -- Wait for animation to complete
                if optionsFrame.CanvasSize.Y.Offset > optionsFrame.AbsoluteWindowSize.Y then
                    -- Find first selected option and scroll to it
                    for i, option in ipairs(options) do
                        if selectedOptions[option] then
                            local optionHeight = isMobile and 32 or 22
                            local targetPosition = (i - 1) * (optionHeight + optionsLayout.Padding.Offset)
                            optionsFrame.CanvasPosition = Vector2.new(0, math.max(0, targetPosition - 20))
                            break
                        end
                    end
                end
            end)
 
        else
            -- Close dropdown
            TweenService:Create(arrow, TweenInfo.new(0.2), {Rotation = 0}):Play()
            TweenService:Create(optionsFrame, TweenInfo.new(0.2), {Size = UDim2.new(1, 0, 0, 0)}):Play()
 
            spawn(function()
                wait(0.2) -- Wait for close animation
                optionsFrame.Visible = false
 
                -- Reset ZIndex
                multiDropdown.ZIndex = 20
                optionsFrame.ZIndex = 50
            end)
        end
    end
 
    -- Main dropdown click with improved mobile support
    if isMobile then
        -- Mobile touch handling for main dropdown
        local dropdownTouchStartTime = 0
        local dropdownTouchStartPos = nil
        
        multiDropdown.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.Touch then
                dropdownTouchStartTime = tick()
                dropdownTouchStartPos = input.Position
                
                -- Visual feedback
                TweenService:Create(multiDropdown, TweenInfo.new(0.1), {
                    BackgroundTransparency = 0.3
                }):Play()
            end
        end)
        
        multiDropdown.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.Touch then
                local touchDuration = tick() - dropdownTouchStartTime
                
                -- Reset visual feedback
                TweenService:Create(multiDropdown, TweenInfo.new(0.1), {
                    BackgroundTransparency = 0.4
                }):Play()
                
                -- Only register as click if it was a quick tap
                if touchDuration < 0.3 then
                    toggleDropdown()
                end
            end
        end)
    else
        -- Desktop mouse handling
        multiDropdown.MouseButton1Click:Connect(toggleDropdown)
    end
 
    -- Close dropdown when clicking outside (improved for mobile)
    local function closeDropdown(input)
        if isOpen then
            local inputType = input.UserInputType
            local isRelevantInput = inputType == Enum.UserInputType.MouseButton1 or 
                                   inputType == Enum.UserInputType.Touch
 
            if isRelevantInput then
                local mousePos = input.Position
                local dropdownAbsPos = multiDropdown.AbsolutePosition
                local dropdownSize = multiDropdown.AbsoluteSize
                local optionsAbsPos = optionsFrame.AbsolutePosition
                local optionsSize = optionsFrame.AbsoluteSize
 
                local isInsideDropdown = (mousePos.X >= dropdownAbsPos.X and mousePos.X <= dropdownAbsPos.X + dropdownSize.X and
                                        mousePos.Y >= dropdownAbsPos.Y and mousePos.Y <= dropdownAbsPos.Y + dropdownSize.Y)
 
                local isInsideOptions = (mousePos.X >= optionsAbsPos.X and mousePos.X <= optionsAbsPos.X + optionsSize.X and
                                       mousePos.Y >= optionsAbsPos.Y and mousePos.Y <= optionsAbsPos.Y + optionsSize.Y)
 
                if not isInsideDropdown and not isInsideOptions then
                    isOpen = false
                    TweenService:Create(arrow, TweenInfo.new(0.2), {Rotation = 0}):Play()
                    TweenService:Create(optionsFrame, TweenInfo.new(0.2), {Size = UDim2.new(1, 0, 0, 0)}):Play()
 
                    spawn(function()
                        wait(0.2)
                        optionsFrame.Visible = false
                        multiDropdown.ZIndex = 20
                        optionsFrame.ZIndex = 50
                    end)
                end
            end
        end
    end
 
    UserInputService.InputBegan:Connect(closeDropdown)
 
    -- Update canvas size when options change
    optionsLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        optionsFrame.CanvasSize = UDim2.new(0, 0, 0, optionsLayout.AbsoluteContentSize.Y + optionsPadding.PaddingTop.Offset + optionsPadding.PaddingBottom.Offset)
    end)
 
    -- Create dropdown object with methods
    local multiDropdownObj = {
        Instance = multiDropdown,
        PremiumLock = premiumLock
    }
 
    function multiDropdownObj:GetSelections()
        local selections = {}
        for option, selected in pairs(selectedOptions) do
            if selected then
                table.insert(selections, option)
            end
        end
        return selections
    end
 
    function multiDropdownObj:GetSelectionsTable()
        return selectedOptions
    end
 
    function multiDropdownObj:SetSelections(selections)
        if isPremium and not IsPremium then return end
 
        selectedOptions = {}
 
        if selections then
            if typeof(selections) == "table" then
                if #selections > 0 then
                    for _, option in ipairs(selections) do
                        if table.find(options, option) then
                            selectedOptions[option] = true
                        end
                    end
                else
                    for option, isSelected in pairs(selections) do
                        if table.find(options, option) and isSelected then
                            selectedOptions[option] = true
                        end
                    end
                end
            end
        end
 
        -- Update visual state
        for _, optionButton in pairs(optionsFrame:GetChildren()) do
            if optionButton:IsA("TextButton") and optionButton.Name:find("Option_") then
                local option = optionButton.Name:sub(8)
                if selectedOptions[option] then
                    optionButton.BackgroundColor3 = Theme.Accent
                    optionButton.BackgroundTransparency = 0.3
                else
                    optionButton.BackgroundColor3 = Theme.Secondary
                    optionButton.BackgroundTransparency = 0.4
                end
            end
        end
 
        updateDisplayText()
 
        if callback then
            local selectionsArray = self:GetSelections()
            callback(selectionsArray, selectedOptions)
        end
    end
 
    function multiDropdownObj:ClearSelections()
        if isPremium and not IsPremium then return end
 
        for option in pairs(selectedOptions) do
            selectedOptions[option] = false
        end
 
        for _, optionButton in pairs(optionsFrame:GetChildren()) do
            if optionButton:IsA("TextButton") and optionButton.Name:find("Option_") then
                optionButton.BackgroundColor3 = Theme.Secondary
                optionButton.BackgroundTransparency = 0.4
            end
        end
 
        updateDisplayText()
 
        if callback then
            callback({}, {})
        end
    end
 
    function multiDropdownObj:SelectAll()
        if isPremium and not IsPremium then return end
 
        local allSelections = {}
        for _, option in ipairs(options) do
            selectedOptions[option] = true
            allSelections[option] = true
        end
 
        for _, optionButton in pairs(optionsFrame:GetChildren()) do
            if optionButton:IsA("TextButton") and optionButton.Name:find("Option_") then
                optionButton.BackgroundColor3 = Theme.Accent
                optionButton.BackgroundTransparency = 0.3
            end
        end
 
        updateDisplayText()
 
        if callback then
            local selectionsArray = self:GetSelections()
            callback(selectionsArray, selectedOptions)
        end
    end
 
    function multiDropdownObj:IsOpen()
        return isOpen
    end
 
    function multiDropdownObj:Close()
        if isOpen then
            isOpen = false
            TweenService:Create(arrow, TweenInfo.new(0.2), {Rotation = 0}):Play()
            TweenService:Create(optionsFrame, TweenInfo.new(0.2), {Size = UDim2.new(1, 0, 0, 0)}):Play()
 
            spawn(function()
                wait(0.2)
                optionsFrame.Visible = false
                multiDropdown.ZIndex = 20
                optionsFrame.ZIndex = 50
            end)
        end
    end
 
    function multiDropdownObj:Open()
        if not isOpen then
            toggleDropdown()
        end
    end
 
    function multiDropdownObj:RefreshOptions(newOptions)
        if isPremium and not IsPremium then return end
 
        -- Clear existing options
        for _, child in pairs(optionsFrame:GetChildren()) do
            if child:IsA("TextButton") then
                child:Destroy()
            end
        end
 
        -- Update options
        options = newOptions or options
 
        -- Recreate option buttons
        for i, option in ipairs(options) do
            local optionButton = Instance.new("TextButton")
            optionButton.Name = "Option_" .. option
            optionButton.Size = UDim2.new(1, -8, 0, isMobile and 32 or 22)
            optionButton.BackgroundColor3 = Theme.Secondary
            optionButton.BackgroundTransparency = 0.4
            optionButton.BorderSizePixel = 0
            optionButton.Text = option
            optionButton.TextColor3 = Theme.Text
            optionButton.TextSize = isMobile and 14 or 11
            optionButton.TextXAlignment = Enum.TextXAlignment.Left
            optionButton.Font = Enum.Font.Gotham
            optionButton.LayoutOrder = i
            optionButton.ZIndex = 51
            optionButton.Parent = optionsFrame
 
            local optionCorner = Instance.new("UICorner")
            optionCorner.CornerRadius = UDim.new(0, 4)
            optionCorner.Parent = optionButton
 
            local textPadding = Instance.new("UIPadding")
            textPadding.PaddingLeft = UDim.new(0, isMobile and 16 or 8)
            textPadding.Parent = optionButton
 
            -- Set state based on current selections
            if selectedOptions[option] then
                optionButton.BackgroundColor3 = Theme.Accent
                optionButton.BackgroundTransparency = 0.3
            end
 
            -- Improved mobile touch handling for new buttons
            if isMobile then
                local touchStartTime = 0
                local touchStartPos = nil
                
                optionButton.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.Touch then
                        touchStartTime = tick()
                        touchStartPos = input.Position
                        
                        TweenService:Create(optionButton, TweenInfo.new(0.1), {
                            BackgroundTransparency = 0.2
                        }):Play()
                    end
                end)
                
                optionButton.InputEnded:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.Touch then
                        local touchDuration = tick() - touchStartTime
                        
                        TweenService:Create(optionButton, TweenInfo.new(0.1), {
                            BackgroundTransparency = selectedOptions[option] and 0.3 or 0.4
                        }):Play()
                        
                        if touchDuration < 0.3 then
                            selectedOptions[option] = not selectedOptions[option]
 
                            if selectedOptions[option] then
                                optionButton.BackgroundColor3 = Theme.Accent
                                optionButton.BackgroundTransparency = 0.3
                            else
                                optionButton.BackgroundColor3 = Theme.Secondary
                                optionButton.BackgroundTransparency = 0.4
                            end
 
                            updateDisplayText()
 
                            if callback then
                                local selectionsArray = {}
                                for opt, isSelected in pairs(selectedOptions) do
                                    if isSelected then
                                        table.insert(selectionsArray, opt)
                                    end
                                end
                                callback(selectionsArray, selectedOptions)
                            end
                        end
                    end
                end)
            else
                optionButton.MouseButton1Click:Connect(function()
                    selectedOptions[option] = not selectedOptions[option]
 
                    if selectedOptions[option] then
                        optionButton.BackgroundColor3 = Theme.Accent
                        optionButton.BackgroundTransparency = 0.3
                    else
                        optionButton.BackgroundColor3 = Theme.Secondary
                        optionButton.BackgroundTransparency = 0.4
                    end
 
                    updateDisplayText()
 
                    if callback then
                        local selectionsArray = {}
                        for opt, isSelected in pairs(selectedOptions) do
                            if isSelected then
                                table.insert(selectionsArray, opt)
                            end
                        end
                        callback(selectionsArray, selectedOptions)
                    end
                end)
            end
        end
 
        -- Update display
        updateDisplayText()
    end
 
    function multiDropdownObj:SetPremium(isPremiumFeature)
        if isPremiumFeature and not IsPremium then
            if not self.PremiumLock then
                self.PremiumLock = GuiLibrary:MarkAsPremium(multiDropdown, "PREMIUM")
            end
        elseif self.PremiumLock then
            self.PremiumLock.Unlock()
            self.PremiumLock = nil
        end
    end
 	if dropdownName and multiDropdownObj then
        elementRegistry[dropdownName] = multiDropdownObj
        guiElements[dropdownName] = multiDropdownObj
    end
    return multiDropdownObj
end


-- Color Picker Function (Voidware Style) with Premium Support
function GuiLibrary:CreateColorPicker(tab, pickerName, defaultColor, callback, isPremium)
    local defaultColor = defaultColor or Color3.fromRGB(255, 255, 255)
    
    local colorPicker = Instance.new("TextButton")
    colorPicker.Name = "ColorPicker_" .. pickerName
    colorPicker.Size = UDim2.new(1, 0, 0, 32)
    colorPicker.BackgroundColor3 = Theme.Secondary
    colorPicker.BackgroundTransparency = 0.4
    colorPicker.BorderSizePixel = 0
    colorPicker.Text = ""
    colorPicker.Parent = tab.Frame

    local colorPickerCorner = Instance.new("UICorner")
    colorPickerCorner.CornerRadius = UDim.new(0, 4)
    colorPickerCorner.Parent = colorPicker

    local label = Instance.new("TextLabel")
    label.Name = "Label"
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.Position = UDim2.new(0, 10, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = pickerName
    label.TextColor3 = Theme.Text
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Font = Enum.Font.Gotham
    label.Parent = colorPicker

    local colorPreview = Instance.new("Frame")
    colorPreview.Name = "ColorPreview"
    colorPreview.Size = UDim2.new(0, 22, 0, 22)
    colorPreview.Position = UDim2.new(1, -30, 0.5, -11)
    colorPreview.BackgroundColor3 = defaultColor
    colorPreview.BorderSizePixel = 0
    colorPreview.Parent = colorPicker

    local colorPreviewCorner = Instance.new("UICorner")
    colorPreviewCorner.CornerRadius = UDim.new(0, 4)
    colorPreviewCorner.Parent = colorPreview

    -- Mark as premium if required
    local premiumLock
    if isPremium and not IsPremium then
        premiumLock = self:MarkAsPremium(colorPicker, "PREMIUM")
        callback = function() end -- Disable callback for non-premium users
    end

    local isOpen = false
    local currentColor = defaultColor

    colorPicker.MouseButton1Click:Connect(function()
        if isPremium and not IsPremium then return end
        isOpen = not isOpen
        -- Add your color picker window logic here
    end)

    -- Create color picker object with methods
    local colorPickerObj = {
        Instance = colorPicker,
        PremiumLock = premiumLock
    }

    function colorPickerObj:GetColor()
        return currentColor
    end

    function colorPickerObj:SetColor(color)
        if isPremium and not IsPremium then return end
        currentColor = color
        colorPreview.BackgroundColor3 = color
        if callback then
            callback(color)
        end
    end

    function colorPickerObj:SetPremium(isPremiumFeature)
        if isPremiumFeature and not IsPremium then
            if not self.PremiumLock then
                self.PremiumLock = GuiLibrary:MarkAsPremium(colorPicker, "PREMIUM")
            end
        elseif self.PremiumLock then
            self.PremiumLock.Unlock()
            self.PremiumLock = nil
        end
    end
	if pickerName and colorPickerObj then
        elementRegistry[pickerName] = colorPickerObj
        guiElements[pickerName] = colorPickerObj
    end
    return colorPickerObj
end

-- Number Input Field Function (Voidware Style) with Premium Support
function GuiLibrary:CreateNumberInput(tab, inputName, placeholder, defaultValue, minValue, maxValue, callback, isPremium)
    local inputFrame = Instance.new("Frame")
    inputFrame.Name = "NumberInput_" .. inputName
    inputFrame.Size = UDim2.new(1, 0, 0, 32)
    inputFrame.BackgroundTransparency = 1
    inputFrame.Parent = tab.Frame

    local label = Instance.new("TextLabel")
    label.Name = "Label"
    label.Size = UDim2.new(0.4, 0, 1, 0)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = inputName
    label.TextColor3 = Theme.Text
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Font = Enum.Font.Gotham
    label.Parent = inputFrame

    local inputContainer = Instance.new("Frame")
    inputContainer.Name = "InputContainer"
    inputContainer.Size = UDim2.new(0.6, 0, 1, 0)
    inputContainer.Position = UDim2.new(0.4, 0, 0, 0)
    inputContainer.BackgroundTransparency = 1
    inputContainer.Parent = inputFrame

    local textBox = Instance.new("TextBox")
    textBox.Name = "TextBox"
    textBox.Size = UDim2.new(0.7, 0, 1, 0)
    textBox.Position = UDim2.new(0, 0, 0, 0)
    textBox.BackgroundColor3 = Theme.Secondary
    textBox.BackgroundTransparency = 0.4
    textBox.BorderSizePixel = 0
    textBox.Text = tostring(defaultValue or "")
    textBox.PlaceholderText = placeholder or "Enter number..."
    textBox.TextColor3 = Theme.Text
    textBox.PlaceholderColor3 = Theme.TextSecondary
    textBox.TextSize = 11
    textBox.Font = Enum.Font.Gotham
    textBox.ClearTextOnFocus = false
    textBox.Parent = inputContainer

    local textBoxCorner = Instance.new("UICorner")
    textBoxCorner.CornerRadius = UDim.new(0, 4)
    textBoxCorner.Parent = textBox

    local textBoxPadding = Instance.new("UIPadding")
    textBoxPadding.PaddingLeft = UDim.new(0, 8)
    textBoxPadding.PaddingRight = UDim.new(0, 8)
    textBoxPadding.Parent = textBox

    -- Stepper buttons
    local stepperFrame = Instance.new("Frame")
    stepperFrame.Name = "Stepper"
    stepperFrame.Size = UDim2.new(0.3, 0, 1, 0)
    stepperFrame.Position = UDim2.new(0.7, 4, 0, 0)
    stepperFrame.BackgroundTransparency = 1
    stepperFrame.Parent = inputContainer

    local increaseButton = Instance.new("TextButton")
    increaseButton.Name = "Increase"
    increaseButton.Size = UDim2.new(0.5, -2, 1, 0)
    increaseButton.Position = UDim2.new(0.5, 2, 0, 0)
    increaseButton.BackgroundColor3 = Theme.Accent
    increaseButton.BackgroundTransparency = 0.3
    increaseButton.BorderSizePixel = 0
    increaseButton.Text = "+"
    increaseButton.TextColor3 = Theme.Text
    increaseButton.TextSize = 12
    increaseButton.Font = Enum.Font.GothamBold
    increaseButton.Parent = stepperFrame

    local decreaseButton = Instance.new("TextButton")
    decreaseButton.Name = "Decrease"
    decreaseButton.Size = UDim2.new(0.5, -2, 1, 0)
    decreaseButton.Position = UDim2.new(0, 0, 0, 0)
    decreaseButton.BackgroundColor3 = Theme.Accent
    decreaseButton.BackgroundTransparency = 0.3
    decreaseButton.BorderSizePixel = 0
    decreaseButton.Text = "-"
    decreaseButton.TextColor3 = Theme.Text
    decreaseButton.TextSize = 12
    decreaseButton.Font = Enum.Font.GothamBold
    decreaseButton.Parent = stepperFrame

    local stepperCorner = Instance.new("UICorner")
    stepperCorner.CornerRadius = UDim.new(0, 4)
    stepperCorner.Parent = increaseButton

    local stepperCorner2 = Instance.new("UICorner")
    stepperCorner2.CornerRadius = UDim.new(0, 4)
    stepperCorner2.Parent = decreaseButton

    local min = minValue or -math.huge
    local max = maxValue or math.huge
    local currentValue = tonumber(defaultValue) or 0

    -- Mark as premium if required
    local premiumLock
    if isPremium and not IsPremium then
        premiumLock = self:MarkAsPremium(inputFrame, "PREMIUM")
        callback = function() end -- Disable callback for non-premium users
    end

    local function validateNumber(value)
        local num = tonumber(value)
        if num then
            return math.clamp(num, min, max)
        end
        return currentValue
    end

    local function updateValue(newValue, triggerCallback)
        if isPremium and not IsPremium then return end
        
        local validatedValue = validateNumber(newValue)
        currentValue = validatedValue
        textBox.Text = tostring(validatedValue)
        
        if triggerCallback and callback then
            callback(validatedValue)
        end
    end

    local function stepValue(amount)
        if isPremium and not IsPremium then return end
        local newValue = currentValue + amount
        updateValue(newValue, true)
    end

    textBox.Focused:Connect(function()
        if isPremium and not IsPremium then return end
        TweenService:Create(textBox, TweenInfo.new(0.1), {BackgroundTransparency = 0.2}):Play()
    end)

    textBox.FocusLost:Connect(function(enterPressed)
        if isPremium and not IsPremium then return end
        TweenService:Create(textBox, TweenInfo.new(0.1), {BackgroundTransparency = 0.4}):Play()
        updateValue(textBox.Text, true)
    end)

    increaseButton.MouseButton1Click:Connect(function()
        stepValue(1)
    end)

    decreaseButton.MouseButton1Click:Connect(function()
        stepValue(-1)
    end)

    updateValue(defaultValue or 0, false)

    local numberInputObj = {
        Instance = inputFrame,
        PremiumLock = premiumLock
    }

    function numberInputObj:GetValue()
        return currentValue
    end

    function numberInputObj:SetValue(value)
        updateValue(value, false)
    end

    function numberInputObj:SetRange(newMin, newMax)
        min = newMin or min
        max = newMax or max
        updateValue(currentValue, false)
    end

    function numberInputObj:SetPlaceholder(text)
        textBox.PlaceholderText = text or ""
    end

    function numberInputObj:SetPremium(isPremiumFeature)
        if isPremiumFeature and not IsPremium then
            if not self.PremiumLock then
                self.PremiumLock = GuiLibrary:MarkAsPremium(inputFrame, "PREMIUM")
            end
        elseif self.PremiumLock then
            self.PremiumLock.Unlock()
            self.PremiumLock = nil
        end
    end
	if inputName and numberInputObj then
        elementRegistry[inputName] = numberInputObj
        guiElements[inputName] = numberInputObj
    end
    return numberInputObj
end


-- Player List Function (Voidware Style)
function GuiLibrary:CreatePlayerList(tab, listName, callback)
    local Players = game:GetService("Players")
    local playerEntries = {}
    local playerListFrame = nil
    
    local function createPlayerListFrame()
        if playerListFrame then
            playerListFrame:Destroy()
        end
        
        playerListFrame = Instance.new("Frame")
        playerListFrame.Name = "PlayerList_" .. listName
        playerListFrame.Size = UDim2.new(1, 0, 0, 0)
        playerListFrame.BackgroundTransparency = 1
        playerListFrame.Parent = tab.Frame
        
        local layout = Instance.new("UIListLayout")
        layout.Padding = UDim.new(0, 4)
        layout.SortOrder = Enum.SortOrder.LayoutOrder
        layout.Parent = playerListFrame
        
        layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            playerListFrame.Size = UDim2.new(1, 0, 0, layout.AbsoluteContentSize.Y)
        end)
        
        return playerListFrame
    end
    
    local function teleportToPlayer(targetPlayer)
        local character = Players.LocalPlayer.Character
        local targetCharacter = targetPlayer.Character
        
        if character and character:FindFirstChild("HumanoidRootPart") and 
           targetCharacter and targetCharacter:FindFirstChild("HumanoidRootPart") then
            local targetHRP = targetCharacter.HumanoidRootPart
            local offset = Vector3.new(0, 3, 0)
            
            character.HumanoidRootPart.CFrame = targetHRP.CFrame + offset
            print("âœ… Teleported to " .. targetPlayer.Name)
            
            if callback then
                callback(targetPlayer)
            end
        else
            warn("âŒ Cannot teleport - player or target character not found")
        end
    end
    
    local function createPlayerEntry(player, isLocalPlayer)
        local playerFrame = Instance.new("Frame")
        playerFrame.Name = "PlayerEntry_" .. player.UserId
        playerFrame.Size = UDim2.new(1, 0, 0, 35)
        playerFrame.BackgroundColor3 = isLocalPlayer and Theme.Accent or Theme.Secondary
        playerFrame.BackgroundTransparency = isLocalPlayer and 0.3 or 0.4
        playerFrame.BorderSizePixel = 0
        playerFrame.LayoutOrder = isLocalPlayer and 0 or player.UserId
        playerFrame.Parent = playerListFrame
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 4)
        corner.Parent = playerFrame
        
        local infoLabel = Instance.new("TextLabel")
        infoLabel.Name = "PlayerInfo"
        infoLabel.Size = UDim2.new(0.6, -8, 1, 0)
        infoLabel.Position = UDim2.new(0, 8, 0, 0)
        infoLabel.BackgroundTransparency = 1
        infoLabel.TextColor3 = Theme.Text
        infoLabel.TextSize = 11
        infoLabel.TextXAlignment = Enum.TextXAlignment.Left
        infoLabel.Font = Enum.Font.Gotham
        infoLabel.Parent = playerFrame
        
        local playerText = player.Name
        if player.DisplayName ~= player.Name then
            playerText = playerText .. "\n[@" .. player.DisplayName .. "]"
        end
        if isLocalPlayer then
            playerText = "ðŸ‘‘ " .. playerText .. " (You)"
        end
        infoLabel.Text = playerText
        
        if not isLocalPlayer then
            local tpButton = Instance.new("TextButton")
            tpButton.Name = "TPButton"
            tpButton.Size = UDim2.new(0.35, -8, 0, 25)
            tpButton.Position = UDim2.new(0.65, 4, 0.5, -12.5)
            tpButton.BackgroundColor3 = Theme.Accent
            tpButton.BackgroundTransparency = 0.3
            tpButton.BorderSizePixel = 0
            tpButton.Text = "ðŸ“¡ TP"
            tpButton.TextColor3 = Theme.Text
            tpButton.TextSize = 10
            tpButton.Font = Enum.Font.GothamBold
            tpButton.Parent = playerFrame
            
            local tpCorner = Instance.new("UICorner")
            tpCorner.CornerRadius = UDim.new(0, 4)
            tpCorner.Parent = tpButton
            
            tpButton.MouseEnter:Connect(function()
                if not isMobile then
                    TweenService:Create(tpButton, TweenInfo.new(0.1), {BackgroundTransparency = 0.1}):Play()
                end
            end)
            
            tpButton.MouseLeave:Connect(function()
                if not isMobile then
                    TweenService:Create(tpButton, TweenInfo.new(0.1), {BackgroundTransparency = 0.3}):Play()
                end
            end)
            
            tpButton.MouseButton1Click:Connect(function()
                teleportToPlayer(player)
            end)
        end
        
        return playerFrame
    end
    
    local function refreshPlayerList()
        local container = createPlayerListFrame()
        local players = Players:GetPlayers()
        
        table.sort(players, function(a, b)
            return a.Name:lower() < b.Name:lower()
        end)
        
        for _, player in ipairs(players) do
            local isLocalPlayer = (player == Players.LocalPlayer)
            local playerEntry = createPlayerEntry(player, isLocalPlayer)
            playerEntries[player.UserId] = playerEntry
        end
        
        print("ðŸ”„ Player list updated: " .. (#players - 1) .. " other players")
    end
    
    local function setupAutoRefresh()
        Players.PlayerAdded:Connect(function(player)
            task.wait(1)
            refreshPlayerList()
        end)
        
        Players.PlayerRemoving:Connect(function(player)
            refreshPlayerList()
        end)
    end
    
    refreshPlayerList()
    setupAutoRefresh()
    
    local playerListObj = {}
    
    function playerListObj:Refresh()
        refreshPlayerList()
    end
    
    function playerListObj:GetPlayerCount()
        return #Players:GetPlayers()
    end
    
    function playerListObj:GetOtherPlayerCount()
        return #Players:GetPlayers() - 1
    end
    
    function playerListObj:TeleportToPlayer(player)
        if typeof(player) == "Instance" and player:IsA("Player") then
            teleportToPlayer(player)
        else
            warn("âŒ Invalid player provided")
        end
    end
    
    function playerListObj:GetPlayers()
        return Players:GetPlayers()
    end
    
    function playerListObj:GetInstance()
        return playerListFrame
    end
    
    function playerListObj:Destroy()
        if playerListFrame then
            playerListFrame:Destroy()
            playerListFrame = nil
        end
        playerEntries = {}
    end
    
    return playerListObj
end

-- Progress Bar Function (Voidware Style)
function GuiLibrary:CreateProgressBar(tab, progressName, minValue, maxValue, defaultValue, callback)
    local progressBar = Instance.new("Frame")
    progressBar.Name = "ProgressBar_" .. progressName
    progressBar.Size = UDim2.new(1, 0, 0, 50)
    progressBar.BackgroundTransparency = 1
    progressBar.Parent = tab.Frame
    
    local label = Instance.new("TextLabel")
    label.Name = "Label"
    label.Size = UDim2.new(1, 0, 0, 18)
    label.BackgroundTransparency = 1
    label.Text = progressName
    label.TextColor3 = Theme.Text
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Font = Enum.Font.Gotham
    label.Parent = progressBar
    
    local valueLabel = Instance.new("TextLabel")
    valueLabel.Name = "Value"
    valueLabel.Size = UDim2.new(0, 60, 0, 18)
    valueLabel.Position = UDim2.new(1, -60, 0, 0)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Text = tostring(defaultValue or minValue) .. "/" .. tostring(maxValue)
    valueLabel.TextColor3 = Theme.TextSecondary
    valueLabel.TextSize = 10
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    valueLabel.Font = Enum.Font.Gotham
    valueLabel.Parent = progressBar
    
    local progressTrack = Instance.new("Frame")
    progressTrack.Name = "Track"
    progressTrack.Size = UDim2.new(1, 0, 0, 16)
    progressTrack.Position = UDim2.new(0, 0, 0, 25)
    progressTrack.BackgroundColor3 = Theme.Secondary
    progressTrack.BackgroundTransparency = 0.4
    progressTrack.BorderSizePixel = 0
    progressTrack.Parent = progressBar
    
    local trackCorner = Instance.new("UICorner")
    trackCorner.CornerRadius = UDim.new(0, 8)
    trackCorner.Parent = progressTrack
    
    local progressFill = Instance.new("Frame")
    progressFill.Name = "Fill"
    progressFill.Size = UDim2.new(0, 0, 1, 0)
    progressFill.BackgroundColor3 = Theme.Accent
    progressFill.BackgroundTransparency = 0.3
    progressFill.BorderSizePixel = 0
    progressFill.Parent = progressTrack
    
    local fillCorner = Instance.new("UICorner")
    fillCorner.CornerRadius = UDim.new(0, 8)
    fillCorner.Parent = progressFill
    
    local percentageLabel = Instance.new("TextLabel")
    percentageLabel.Name = "Percentage"
    percentageLabel.Size = UDim2.new(1, 0, 1, 0)
    percentageLabel.BackgroundTransparency = 1
    percentageLabel.Text = "0%"
    percentageLabel.TextColor3 = Theme.Text
    percentageLabel.TextSize = 10
    percentageLabel.Font = Enum.Font.GothamBold
    percentageLabel.Parent = progressTrack
    
    local currentValue = defaultValue or minValue
    local min = minValue or 0
    local max = maxValue or 100
    
    local function updateProgress(value, triggerCallback)
        currentValue = math.clamp(value, min, max)
        local percentage = (currentValue - min) / (max - min)
        local fillWidth = percentage * progressTrack.AbsoluteSize.X
        
        progressFill.Size = UDim2.new(percentage, 0, 1, 0)
        valueLabel.Text = tostring(math.floor(currentValue)) .. "/" .. tostring(max)
        percentageLabel.Text = string.format("%d%%", math.floor(percentage * 100))
        
        if percentage > 0.5 then
            percentageLabel.TextColor3 = Color3.new(1, 1, 1)
        else
            percentageLabel.TextColor3 = Theme.Text
        end
        
        if triggerCallback and callback then
            callback(currentValue, percentage)
        end
    end
    
    updateProgress(currentValue, false)
    
    local progressBarObj = {}
    
    function progressBarObj:GetValue()
        return currentValue
    end
    
    function progressBarObj:SetValue(value)
        updateProgress(value, true)
    end
    
    function progressBarObj:SetRange(newMin, newMax)
        min = newMin or min
        max = newMax or max
        updateProgress(currentValue, false)
    end
    
    function progressBarObj:Increment(amount)
        amount = amount or 1
        updateProgress(currentValue + amount, true)
    end
    
    function progressBarObj:Decrement(amount)
        amount = amount or 1
        updateProgress(currentValue - amount, true)
    end
    
    function progressBarObj:GetPercentage()
        return (currentValue - min) / (max - min)
    end
    
    function progressBarObj:SetColor(color)
        progressFill.BackgroundColor3 = color or Theme.Accent
    end
    
    function progressBarObj:Reset()
        updateProgress(min, true)
    end
    
    function progressBarObj:SetToMax()
        updateProgress(max, true)
    end
    
    function progressBarObj:IsComplete()
        return currentValue >= max
    end
    
    function progressBarObj:GetInstance()
        return progressBar
    end
    
    return progressBarObj
end

-- Temporary Progress Bar Function (Voidware Style)
function GuiLibrary:CreateTemporaryProgressBar(progressName, duration, callback)
    local temporaryProgress = {}
    temporaryProgress.Destroyed = false
    
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "TemporaryProgress_" .. progressName
    screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
    screenGui.ResetOnSpawn = false
    
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, 280, 0, 70)
    mainFrame.Position = UDim2.new(0.5, -140, 0.1, 0)
    mainFrame.BackgroundColor3 = Theme.Background
    mainFrame.BackgroundTransparency = 0.2
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = screenGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = mainFrame
    
    local shadow = Instance.new("ImageLabel")
    shadow.Size = UDim2.new(1, 8, 1, 8)
    shadow.Position = UDim2.new(0, -4, 0, -4)
    shadow.BackgroundTransparency = 1
    shadow.Image = "rbxassetid://1316045217"
    shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
    shadow.ImageTransparency = 0.9
    shadow.ScaleType = Enum.ScaleType.Slice
    shadow.SliceCenter = Rect.new(10, 10, 118, 118)
    shadow.Parent = mainFrame
    
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, -16, 0, 20)
    title.Position = UDim2.new(0, 8, 0, 8)
    title.BackgroundTransparency = 1
    title.Text = progressName
    title.TextColor3 = Theme.Text
    title.TextSize = 12
    title.Font = Enum.Font.GothamBold
    title.Parent = mainFrame
    
    local progressTrack = Instance.new("Frame")
    progressTrack.Size = UDim2.new(1, -16, 0, 16)
    progressTrack.Position = UDim2.new(0, 8, 0, 32)
    progressTrack.BackgroundColor3 = Theme.Secondary
    progressTrack.BackgroundTransparency = 0.4
    progressTrack.BorderSizePixel = 0
    progressTrack.Parent = mainFrame
    
    local trackCorner = Instance.new("UICorner")
    trackCorner.CornerRadius = UDim.new(0, 8)
    trackCorner.Parent = progressTrack
    
    local progressFill = Instance.new("Frame")
    progressFill.Size = UDim2.new(0, 0, 1, 0)
    progressFill.BackgroundColor3 = Theme.Accent
    progressFill.BackgroundTransparency = 0.3
    progressFill.BorderSizePixel = 0
    progressFill.Parent = progressTrack
    
    local fillCorner = Instance.new("UICorner")
    fillCorner.CornerRadius = UDim.new(0, 8)
    fillCorner.Parent = progressFill
    
    local percentageLabel = Instance.new("TextLabel")
    percentageLabel.Size = UDim2.new(1, 0, 1, 0)
    percentageLabel.BackgroundTransparency = 1
    percentageLabel.Text = "0%"
    percentageLabel.TextColor3 = Theme.Text
    percentageLabel.TextSize = 10
    percentageLabel.Font = Enum.Font.GothamBold
    percentageLabel.Parent = progressTrack
    
    local timeLabel = Instance.new("TextLabel")
    timeLabel.Size = UDim2.new(1, -16, 0, 12)
    timeLabel.Position = UDim2.new(0, 8, 0, 50)
    timeLabel.BackgroundTransparency = 1
    timeLabel.Text = "Time remaining: " .. duration .. "s"
    timeLabel.TextColor3 = Theme.TextSecondary
    timeLabel.TextSize = 9
    timeLabel.TextXAlignment = Enum.TextXAlignment.Right
    timeLabel.Font = Enum.Font.Gotham
    timeLabel.Parent = mainFrame
    
    local startTime = tick()
    local endTime = startTime + duration
    
    local function animateProgress()
        while tick() < endTime and not temporaryProgress.Destroyed do
            local elapsed = tick() - startTime
            local progress = elapsed / duration
            local remaining = duration - elapsed
            
            progressFill.Size = UDim2.new(progress, 0, 1, 0)
            percentageLabel.Text = string.format("%d%%", math.floor(progress * 100))
            timeLabel.Text = string.format("Time remaining: %.1fs", remaining)
            
            if progress > 0.5 then
                percentageLabel.TextColor3 = Color3.new(1, 1, 1)
            else
                percentageLabel.TextColor3 = Theme.Text
            end
            
            if callback then
                callback(progress, remaining)
            end
            
            wait(0.1)
        end
        
        if not temporaryProgress.Destroyed then
            progressFill.Size = UDim2.new(1, 0, 1, 0)
            percentageLabel.Text = "100%"
            timeLabel.Text = "Completed!"
            
            if callback then
                callback(1, 0)
            end
            
            wait(2)
            temporaryProgress:Destroy()
        end
    end
    
    spawn(animateProgress)
    
    function temporaryProgress:Destroy()
        if not self.Destroyed then
            self.Destroyed = true
            if screenGui and screenGui.Parent then
                screenGui:Destroy()
            end
        end
    end
    
    function temporaryProgress:GetRemainingTime()
        return math.max(0, endTime - tick())
    end
    
    function temporaryProgress:GetProgress()
        local elapsed = tick() - startTime
        return math.min(1, elapsed / duration)
    end
    
    function temporaryProgress:IsComplete()
        return tick() >= endTime
    end
    
    function temporaryProgress:GetInstance()
        return screenGui
    end
    
    return temporaryProgress
end



-- new added

-- Predefined badge types for quick use
GuiLibrary.BadgeTypes = {
    NEW = {Text = "NEW", Color = Color3.fromRGB(255, 50, 50)},
    UPDATED = {Text = "UPD", Color = Color3.fromRGB(0, 150, 255)},
    BETA = {Text = "BETA", Color = Color3.fromRGB(255, 165, 0)},
    RISK = {Text = "RISK", Color = Color3.fromRGB(255, 0, 0)},
    WARNING = {Text = "WARN", Color = Color3.fromRGB(255, 165, 0)},
    IMPROVED = {Text = "IMPROVED", Color = Color3.fromRGB(150, 0, 255)},
    V2 = {Text = "V2", Color = Color3.fromRGB(0, 200, 100)},
    V3 = {Text = "V3", Color = Color3.fromRGB(0, 150, 255)},
    HOT = {Text = "HOT", Color = Color3.fromRGB(255, 0, 0)},
    POPULAR = {Text = "POPULAR", Color = Color3.fromRGB(255, 105, 180)}
}

-- Mark GUI Elements as New
function GuiLibrary:MarkAsNew(guiElement, badgeText, badgeColor)
    -- Support for predefined badge types
    local badgeType = nil
    if type(badgeText) == "table" and badgeText.Text and badgeText.Color then
        badgeType = badgeText
        badgeText = badgeType.Text
        badgeColor = badgeType.Color
    elseif GuiLibrary.BadgeTypes[badgeText] then
        badgeType = GuiLibrary.BadgeTypes[badgeText]
        badgeText = badgeType.Text
        badgeColor = badgeType.Color
    end
    
    badgeText = badgeText or "NEW"
    badgeColor = badgeColor or Color3.fromRGB(255, 50, 50) -- Red color for "NEW"
    
    -- Create badge container
    local badge = Instance.new("Frame")
    badge.Name = "NewBadge"
    badge.Size = UDim2.new(0, 25, 0, 12)
    badge.Position = UDim2.new(0, 0, 0, 3)
    badge.BackgroundColor3 = badgeColor
    badge.BorderSizePixel = 0
    badge.ZIndex = 10
    badge.Parent = guiElement
    
    local badgeCorner = Instance.new("UICorner")
    badgeCorner.CornerRadius = UDim.new(0, 3)
    badgeCorner.Parent = badge
    
    local badgeLabel = Instance.new("TextLabel")
    badgeLabel.Name = "BadgeText"
    badgeLabel.Size = UDim2.new(1, 0, 1, 0)
    badgeLabel.BackgroundTransparency = 1
    badgeLabel.Text = badgeText
    badgeLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    badgeLabel.TextSize = 8
    badgeLabel.Font = Enum.Font.GothamBold
    badgeLabel.ZIndex = 11
    badgeLabel.Parent = badge
    
    -- Add subtle animation
    local connection
    connection = RunService.Heartbeat:Connect(function()
        local time = tick()
        local alpha = math.sin(time * 5) * 0.2 + 0.8
        badge.BackgroundTransparency = 1 - alpha
    end)
    
    -- Function to remove badge
    local function removeBadge()
        if connection then
            connection:Disconnect()
        end
        badge:Destroy()
    end
    
    -- Auto-remove after 24 hours (optional)
    delay(12000, removeBadge)
    
    return {
        Remove = removeBadge,
        UpdateText = function(newText)
            badgeLabel.Text = newText or badgeText
        end,
        UpdateColor = function(newColor)
            badge.BackgroundColor3 = newColor or badgeColor
        end,
        UpdateType = function(badgeTypeName)
            local badgeType = GuiLibrary.BadgeTypes[badgeTypeName]
            if badgeType then
                badgeLabel.Text = badgeType.Text
                badge.BackgroundColor3 = badgeType.Color
            end
        end,
        GetInstance = function()
            return badge
        end
    }
end

-- Mark Information Items as New (for Information page)
function GuiLibrary:MarkInformationAsNew(infoItem, badgeText, badgeColor)
    -- Support for predefined badge types
    local badgeType = nil
    if type(badgeText) == "table" and badgeText.Text and badgeText.Color then
        badgeType = badgeText
        badgeText = badgeType.Text
        badgeColor = badgeType.Color
    elseif GuiLibrary.BadgeTypes[badgeText] then
        badgeType = GuiLibrary.BadgeTypes[badgeText]
        badgeText = badgeType.Text
        badgeColor = badgeType.Color
    end
    
    badgeText = badgeText or "NEW"
    badgeColor = badgeColor or Color3.fromRGB(255, 50, 50)
    
    local badge = Instance.new("Frame")
    badge.Name = "InfoBadge"
    badge.Size = UDim2.new(0, 20, 0, 10)
    badge.Position = UDim2.new(0, 5, 0, 5)
    badge.BackgroundColor3 = badgeColor
    badge.BorderSizePixel = 0
    badge.ZIndex = 10
    badge.Parent = infoItem
    
    local badgeCorner = Instance.new("UICorner")
    badgeCorner.CornerRadius = UDim.new(0, 2)
    badgeCorner.Parent = badge
    
    local badgeLabel = Instance.new("TextLabel")
    badgeLabel.Name = "BadgeText"
    badgeLabel.Size = UDim2.new(1, 0, 1, 0)
    badgeLabel.BackgroundTransparency = 1
    badgeLabel.Text = badgeText
    badgeLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    badgeLabel.TextSize = 6
    badgeLabel.Font = Enum.Font.GothamBold
    badgeLabel.ZIndex = 11
    badgeLabel.Parent = badge
    
    return {
        Remove = function()
            badge:Destroy()
        end,
        UpdateType = function(badgeTypeName)
            local badgeType = GuiLibrary.BadgeTypes[badgeTypeName]
            if badgeType then
                badgeLabel.Text = badgeType.Text
                badge.BackgroundColor3 = badgeType.Color
            end
        end
    }
end

-- Welcome New
-- Welcome Function (Professional Style)
function GuiLibrary:CreateWelcomeScreen(scriptDetails)
    -- Default values with professional styling
    local config = {
        ScriptName = scriptDetails.ScriptName or "Voidware Script",
        Version = scriptDetails.Version or "v2.1.0",
        Developer = scriptDetails.Developer or "Voidware Team",
        Website = scriptDetails.Website or "https://voidware.xyz",
        Discord = scriptDetails.Discord or "https://discord.gg/voidware",
        SpecialThanks = scriptDetails.SpecialThanks or {"Community", "Testers", "Contributors"},
        Logo = scriptDetails.Logo or nil, -- Can be ImageLabel or Text
        ThemeColor = scriptDetails.ThemeColor or Theme.Accent
    }
    
    -- Create welcome screen
    local welcomeScreen = Instance.new("ScreenGui")
    welcomeScreen.Name = "WelcomeScreen"
    welcomeScreen.ResetOnSpawn = false
    welcomeScreen.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    welcomeScreen.Parent = playerGui
    
    -- Main container
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "WelcomeFrame"
    mainFrame.Size = UDim2.new(0, 450, 0, 500)
    mainFrame.Position = UDim2.new(0.5, -225, 0.5, -250)
    mainFrame.BackgroundColor3 = Theme.Background
    mainFrame.BackgroundTransparency = 0.15
    mainFrame.BorderSizePixel = 0
    mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    mainFrame.Parent = welcomeScreen
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = mainFrame
    
    local shadow = Instance.new("ImageLabel")
    shadow.Name = "Shadow"
    shadow.Size = UDim2.new(1, 15, 1, 15)
    shadow.Position = UDim2.new(0, -7.5, 0, -7.5)
    shadow.BackgroundTransparency = 1
    shadow.Image = "rbxassetid://1316045217"
    shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
    shadow.ImageTransparency = 0.9
    shadow.ScaleType = Enum.ScaleType.Slice
    shadow.SliceCenter = Rect.new(10, 10, 118, 118)
    shadow.Parent = mainFrame
    
    -- Header with accent
    local header = Instance.new("Frame")
    header.Name = "Header"
    header.Size = UDim2.new(1, 0, 0, 80)
    header.BackgroundColor3 = config.ThemeColor
    header.BackgroundTransparency = 0.2
    header.BorderSizePixel = 0
    header.Parent = mainFrame
    
    local headerCorner = Instance.new("UICorner")
    headerCorner.CornerRadius = UDim.new(0, 12)
    headerCorner.Parent = header
    
    -- Logo/Title area
    local logoContainer = Instance.new("Frame")
    logoContainer.Name = "LogoContainer"
    logoContainer.Size = UDim2.new(1, -40, 1, -20)
    logoContainer.Position = UDim2.new(0, 20, 0, 10)
    logoContainer.BackgroundTransparency = 1
    logoContainer.Parent = header
    
    if config.Logo then
        -- If logo is provided as image
        local logo = Instance.new("ImageLabel")
        logo.Name = "Logo"
        logo.Size = UDim2.new(0, 50, 0, 50)
        logo.Position = UDim2.new(0, 0, 0.5, -25)
        logo.BackgroundTransparency = 1
        logo.Image = config.Logo
        logo.ScaleType = Enum.ScaleType.Fit
        logo.Parent = logoContainer
        
        local titleFrame = Instance.new("Frame")
        titleFrame.Name = "TitleFrame"
        titleFrame.Size = UDim2.new(1, -60, 1, 0)
        titleFrame.Position = UDim2.new(0, 60, 0, 0)
        titleFrame.BackgroundTransparency = 1
        titleFrame.Parent = logoContainer
        
        local scriptName = Instance.new("TextLabel")
        scriptName.Name = "ScriptName"
        scriptName.Size = UDim2.new(1, 0, 0, 30)
        scriptName.Position = UDim2.new(0, 0, 0, 10)
        scriptName.BackgroundTransparency = 1
        scriptName.Text = config.ScriptName
        scriptName.TextColor3 = Theme.Text
        scriptName.TextSize = 24
        scriptName.Font = Enum.Font.GothamBold
        scriptName.TextXAlignment = Enum.TextXAlignment.Left
        scriptName.Parent = titleFrame
        
        local version = Instance.new("TextLabel")
        version.Name = "Version"
        version.Size = UDim2.new(1, 0, 0, 20)
        version.Position = UDim2.new(0, 0, 0, 40)
        version.BackgroundTransparency = 1
        version.Text = config.Version
        version.TextColor3 = Theme.TextSecondary
        version.TextSize = 14
        version.Font = Enum.Font.Gotham
        version.TextXAlignment = Enum.TextXAlignment.Left
        version.Parent = titleFrame
    else
        -- Text-only logo
        local scriptName = Instance.new("TextLabel")
        scriptName.Name = "ScriptName"
        scriptName.Size = UDim2.new(1, 0, 0, 40)
        scriptName.Position = UDim2.new(0, 0, 0, 10)
        scriptName.BackgroundTransparency = 1
        scriptName.Text = config.ScriptName
        scriptName.TextColor3 = Theme.Text
        scriptName.TextSize = 28
        scriptName.Font = Enum.Font.GothamBold
        scriptName.Parent = logoContainer
        
        local version = Instance.new("TextLabel")
        version.Name = "Version"
        version.Size = UDim2.new(1, 0, 0, 20)
        version.Position = UDim2.new(0, 0, 0, 50)
        version.BackgroundTransparency = 1
        version.Text = config.Version
        version.TextColor3 = Theme.TextSecondary
        version.TextSize = 16
        version.Font = Enum.Font.Gotham
        version.Parent = logoContainer
    end
    
    -- Content area
    local content = Instance.new("ScrollingFrame")
    content.Name = "Content"
    content.Size = UDim2.new(1, -40, 1, -120)
    content.Position = UDim2.new(0, 20, 0, 100)
    content.BackgroundTransparency = 1
    content.ScrollBarThickness = 3
    content.ScrollBarImageColor3 = config.ThemeColor
    content.ScrollBarImageTransparency = 0.5
    content.Parent = mainFrame
    
    local contentLayout = Instance.new("UIListLayout")
    contentLayout.Padding = UDim.new(0, 15)
    contentLayout.SortOrder = Enum.SortOrder.LayoutOrder
    contentLayout.Parent = content
    
    local contentPadding = Instance.new("UIPadding")
    contentPadding.PaddingTop = UDim.new(0, 10)
    contentPadding.PaddingLeft = UDim.new(0, 5)
    contentPadding.PaddingRight = UDim.new(0, 5)
    contentPadding.Parent = content
    
    -- Developer Section
    local devSection = self:CreateInfoSection(content, "ðŸ‘‘ DEVELOPER", config.Developer)
    
    -- Website Section
    local websiteFrame = Instance.new("Frame")
    websiteFrame.Name = "WebsiteSection"
    websiteFrame.Size = UDim2.new(1, 0, 0, 60)
    websiteFrame.BackgroundTransparency = 1
    websiteFrame.LayoutOrder = 2
    websiteFrame.Parent = content
    
    local websiteTitle = Instance.new("TextLabel")
    websiteTitle.Name = "Title"
    websiteTitle.Size = UDim2.new(1, 0, 0, 20)
    websiteTitle.BackgroundTransparency = 1
    websiteTitle.Text = "ðŸŒ WEBSITE"
    websiteTitle.TextColor3 = Theme.Text
    websiteTitle.TextSize = 12
    websiteTitle.Font = Enum.Font.GothamBold
    websiteTitle.TextXAlignment = Enum.TextXAlignment.Left
    websiteTitle.Parent = websiteFrame
    
    local websiteButton = Instance.new("TextButton")
    websiteButton.Name = "WebsiteButton"
    websiteButton.Size = UDim2.new(1, 0, 0, 35)
    websiteButton.Position = UDim2.new(0, 0, 0, 25)
    websiteButton.BackgroundColor3 = Theme.Secondary
    websiteButton.BackgroundTransparency = 0.3
    websiteButton.BorderSizePixel = 0
    websiteButton.Text = config.Website
    websiteButton.TextColor3 = config.ThemeColor
    websiteButton.TextSize = 11
    websiteButton.Font = Enum.Font.Gotham
    websiteButton.Parent = websiteFrame
    
    local websiteCorner = Instance.new("UICorner")
    websiteCorner.CornerRadius = UDim.new(0, 6)
    websiteCorner.Parent = websiteButton
    
    -- Discord Section
    local discordFrame = Instance.new("Frame")
    discordFrame.Name = "DiscordSection"
    discordFrame.Size = UDim2.new(1, 0, 0, 60)
    discordFrame.BackgroundTransparency = 1
    discordFrame.LayoutOrder = 3
    discordFrame.Parent = content
    
    local discordTitle = Instance.new("TextLabel")
    discordTitle.Name = "Title"
    discordTitle.Size = UDim2.new(1, 0, 0, 20)
    discordTitle.BackgroundTransparency = 1
    discordTitle.Text = "ðŸ’¬ DISCORD"
    discordTitle.TextColor3 = Theme.Text
    discordTitle.TextSize = 12
    discordTitle.Font = Enum.Font.GothamBold
    discordTitle.TextXAlignment = Enum.TextXAlignment.Left
    discordTitle.Parent = discordFrame
    
    local discordButton = Instance.new("TextButton")
    discordButton.Name = "DiscordButton"
    discordButton.Size = UDim2.new(1, 0, 0, 35)
    discordButton.Position = UDim2.new(0, 0, 0, 25)
    discordButton.BackgroundColor3 = Theme.Secondary
    discordButton.BackgroundTransparency = 0.3
    discordButton.BorderSizePixel = 0
    discordButton.Text = config.Discord
    discordButton.TextColor3 = Color3.fromRGB(88, 101, 242) -- Discord blue
    discordButton.TextSize = 11
    discordButton.Font = Enum.Font.Gotham
    discordButton.Parent = discordFrame
    
    local discordCorner = Instance.new("UICorner")
    discordCorner.CornerRadius = UDim.new(0, 6)
    discordCorner.Parent = discordButton
    
    -- Special Thanks Section
    local thanksFrame = Instance.new("Frame")
    thanksFrame.Name = "ThanksSection"
    thanksFrame.Size = UDim2.new(1, 0, 0, 0) -- Auto-size
    thanksFrame.BackgroundTransparency = 1
    thanksFrame.LayoutOrder = 4
    thanksFrame.Parent = content
    
    local thanksTitle = Instance.new("TextLabel")
    thanksTitle.Name = "Title"
    thanksTitle.Size = UDim2.new(1, 0, 0, 20)
    thanksTitle.BackgroundTransparency = 1
    thanksTitle.Text = "ðŸŽ‰ SPECIAL THANKS TO"
    thanksTitle.TextColor3 = Theme.Text
    thanksTitle.TextSize = 12
    thanksTitle.Font = Enum.Font.GothamBold
    thanksTitle.TextXAlignment = Enum.TextXAlignment.Left
    thanksTitle.Parent = thanksFrame
    
    local thanksList = Instance.new("Frame")
    thanksList.Name = "ThanksList"
    thanksList.Size = UDim2.new(1, 0, 0, 0) -- Auto-size
    thanksList.Position = UDim2.new(0, 0, 0, 25)
    thanksList.BackgroundTransparency = 1
    thanksList.Parent = thanksFrame
    
    local thanksLayout = Instance.new("UIListLayout")
    thanksLayout.Padding = UDim.new(0, 5)
    thanksLayout.SortOrder = Enum.SortOrder.LayoutOrder
    thanksLayout.Parent = thanksList
    
    -- Add special thanks items
    for i, person in ipairs(config.SpecialThanks) do
        local thanksItem = Instance.new("TextLabel")
        thanksItem.Name = "ThanksItem"
        thanksItem.Size = UDim2.new(1, 0, 0, 20)
        thanksItem.BackgroundTransparency = 1
        thanksItem.Text = "â€¢ " .. person
        thanksItem.TextColor3 = Theme.TextSecondary
        thanksItem.TextSize = 11
        thanksItem.Font = Enum.Font.Gotham
        thanksItem.TextXAlignment = Enum.TextXAlignment.Left
        thanksItem.LayoutOrder = i
        thanksItem.Parent = thanksList
    end
    
    -- Update thanks list size
    thanksLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        thanksList.Size = UDim2.new(1, 0, 0, thanksLayout.AbsoluteContentSize.Y)
        thanksFrame.Size = UDim2.new(1, 0, 0, thanksLayout.AbsoluteContentSize.Y + 25)
    end)
    
    -- Close Button
    local closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.Size = UDim2.new(0, 120, 0, 35)
    closeButton.Position = UDim2.new(0.5, -60, 1, -50)
    closeButton.BackgroundColor3 = config.ThemeColor
    closeButton.BackgroundTransparency = 0.2
    closeButton.BorderSizePixel = 0
    closeButton.Text = "GET STARTED"
    closeButton.TextColor3 = Theme.Text
    closeButton.TextSize = 12
    closeButton.Font = Enum.Font.GothamBold
    closeButton.Parent = mainFrame
    
    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 6)
    closeCorner.Parent = closeButton
    
    -- Update content size
    contentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        content.CanvasSize = UDim2.new(0, 0, 0, contentLayout.AbsoluteContentSize.Y + 20)
    end)
    
    -- Button interactions
    websiteButton.MouseButton1Click:Connect(function()
        self:CopyToClipboard(config.Website)
        self:ShowNotification("Website link copied to clipboard!", 3)
    end)
    
    discordButton.MouseButton1Click:Connect(function()
        self:CopyToClipboard(config.Discord)
        self:ShowNotification("Discord link copied to clipboard!", 3)
    end)
    
    closeButton.MouseButton1Click:Connect(function()
        welcomeScreen:Destroy()
    end)
    
    -- Button hover effects
    local function setupButtonEffects(button)
        button.MouseEnter:Connect(function()
            if not isMobile then
                TweenService:Create(button, TweenInfo.new(0.1), {BackgroundTransparency = 0.1}):Play()
            end
        end)
        
        button.MouseLeave:Connect(function()
            if not isMobile then
                TweenService:Create(button, TweenInfo.new(0.1), {BackgroundTransparency = 0.3}):Play()
            end
        end)
    end
    
    setupButtonEffects(websiteButton)
    setupButtonEffects(discordButton)
    setupButtonEffects(closeButton)
    
    -- Auto-close after 30 seconds
    delay(30, function()
        if welcomeScreen and welcomeScreen.Parent then
            welcomeScreen:Destroy()
        end
    end)
    
    return welcomeScreen
end

-- Helper function to create info sections
function GuiLibrary:CreateInfoSection(parent, title, contentText)
    local section = Instance.new("Frame")
    section.Name = title .. "Section"
    section.Size = UDim2.new(1, 0, 0, 60)
    section.BackgroundTransparency = 1
    section.Parent = parent
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "Title"
    titleLabel.Size = UDim2.new(1, 0, 0, 20)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title
    titleLabel.TextColor3 = Theme.Text
    titleLabel.TextSize = 12
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = section
    
    local contentFrame = Instance.new("Frame")
    contentFrame.Name = "Content"
    contentFrame.Size = UDim2.new(1, 0, 0, 35)
    contentFrame.Position = UDim2.new(0, 0, 0, 25)
    contentFrame.BackgroundColor3 = Theme.Secondary
    contentFrame.BackgroundTransparency = 0.3
    contentFrame.BorderSizePixel = 0
    contentFrame.Parent = section
    
    local contentCorner = Instance.new("UICorner")
    contentCorner.CornerRadius = UDim.new(0, 6)
    contentCorner.Parent = contentFrame
    
    local contentLabel = Instance.new("TextLabel")
    contentLabel.Name = "Text"
    contentLabel.Size = UDim2.new(1, -20, 1, 0)
    contentLabel.Position = UDim2.new(0, 10, 0, 0)
    contentLabel.BackgroundTransparency = 1
    contentLabel.Text = contentText
    contentLabel.TextColor3 = Theme.TextSecondary
    contentLabel.TextSize = 11
    contentLabel.Font = Enum.Font.Gotham
    contentLabel.TextXAlignment = Enum.TextXAlignment.Left
    contentLabel.TextYAlignment = Enum.TextYAlignment.Center
    contentLabel.Parent = contentFrame
    
    return section
end

-- Copy to clipboard function
function GuiLibrary:CopyToClipboard(text)
    local clipBoard = setclipboard or toclipboard or set_clipboard or (Clipboard and Clipboard.set)
    if clipBoard then
        clipBoard(text)
        return true
    else
        warn("Clipboard function not available")
        return false
    end
end

-- Notification function
function GuiLibrary:ShowNotification(message, duration)
    duration = duration or 3
    
    local notification = Instance.new("ScreenGui")
    notification.Name = "Notification"
    notification.ResetOnSpawn = false
    notification.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    notification.Parent = playerGui
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 300, 0, 50)
    frame.Position = UDim2.new(0.5, -150, 0.1, 0)
    frame.BackgroundColor3 = Theme.Background
    frame.BackgroundTransparency = 0.15
    frame.BorderSizePixel = 0
    frame.Parent = notification
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = frame
    
    local shadow = Instance.new("ImageLabel")
    shadow.Size = UDim2.new(1, 10, 1, 10)
    shadow.Position = UDim2.new(0, -5, 0, -5)
    shadow.BackgroundTransparency = 1
    shadow.Image = "rbxassetid://1316045217"
    shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
    shadow.ImageTransparency = 0.9
    shadow.ScaleType = Enum.ScaleType.Slice
    shadow.SliceCenter = Rect.new(10, 10, 118, 118)
    shadow.Parent = frame
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -20, 1, -10)
    label.Position = UDim2.new(0, 10, 0, 5)
    label.BackgroundTransparency = 1
    label.Text = message
    label.TextColor3 = Theme.Text
    label.TextSize = 12
    label.Font = Enum.Font.Gotham
    label.TextWrapped = true
    label.Parent = frame
    
    -- Animate in
    frame.Position = UDim2.new(0.5, -150, 0, -60)
    TweenService:Create(frame, TweenInfo.new(0.3), {Position = UDim2.new(0.5, -150, 0.1, 0)}):Play()
    
    -- Auto-remove
    delay(duration, function()
        TweenService:Create(frame, TweenInfo.new(0.3), {Position = UDim2.new(0.5, -150, 0, -60)}):Play()
        wait(0.3)
        notification:Destroy()
    end)
end


-- Create Script Info Section
function GuiLibrary:CreateScriptInfo(tab, scriptData)
    if not tab or not scriptData then
        warn("CreateScriptInfo: Invalid parameters")
        return
    end
    
    local config = {
        Name = scriptData.Name or "Script",
        Version = scriptData.Version or "v1.0.0",
        Developer = scriptData.Developer or "Unknown",
        Description = scriptData.Description or "No description provided",
        Discord = scriptData.Discord or "No Discord link",
        Features = scriptData.Features or {"No features listed"},
        News = scriptData.News or {"No news available"}
    }
    
    -- Main Info Section
    self:CreateSeparator(tab, "ðŸ“‹ SCRIPT INFORMATION")
    
    -- Script Name and Version
    self:CreateLabel(tab, "ðŸŽ® " .. config.Name)
    self:CreateLabel(tab, "ðŸ“± Version: " .. config.Version)
    self:CreateLabel(tab, "ðŸ‘¨â€ðŸ’» Developer: " .. config.Developer)
    
    -- Description
    self:CreateSeparator(tab, "ðŸ“ DESCRIPTION")
    self:CreateLabel(tab, config.Description)
    
    -- Discord Link
    self:CreateSeparator(tab, "ðŸ’¬ DISCORD")
    self:CreateButton(tab, "Join Discord: " .. config.Discord, function()
    self:CopyToClipboard(config.Discord)
    end)
    
    -- Features Section
    self:CreateSeparator(tab, "âœ¨ FEATURES")
    for i, feature in ipairs(config.Features) do
        self:CreateLabel(tab, "âœ… " .. feature)
    end
    
    -- News/Updates Section
    self:CreateSeparator(tab, "ðŸ“° LATEST NEWS")
    for i, news in ipairs(config.News) do
        self:CreateLabel(tab, "ðŸ“¢ " .. news)
    end
    
    -- Status
    self:CreateSeparator(tab, "ðŸ”§ STATUS")
    self:CreateLabel(tab, "ðŸŸ¢ Script Status: ACTIVE")
    self:CreateLabel(tab, "ðŸŽ¯ Premium Features: " .. (IsPremium and "ENABLED ðŸŸ¢" or "LOCKED ðŸ”’"))
    
    return {
        UpdateNews = function(newNews)
            config.News = newNews or config.News
        end,
        
        UpdateVersion = function(newVersion)
            config.Version = newVersion or config.Version
        end,
        
        GetInfo = function()
            return config
        end
    }
end

-- Copy to clipboard function
function GuiLibrary:CopyToClipboard(text)
    local clipBoard = setclipboard or toclipboard or set_clipboard or (Clipboard and Clipboard.set)
    if clipBoard then
        clipBoard(text)
        print("âœ… Copied to clipboard: " .. text)
        return true
    else
        warn("âŒ Clipboard function not available")
        return false
    end
end



-- Close function
local function closeGUI()
    if isDestroyed then return end
    isDestroyed = true
    
    -- Destroy all GUI elements
    screenGui:Destroy()
    
    -- Disconnect any running connections (if they exist)
    for _, button in pairs(buttons) do
        -- Check if button has connections stored in a different way
        -- This prevents the "Connection is not a valid member" error
        if button and typeof(button) == "Instance" then
            -- Button is an Instance, no need to disconnect anything
            -- The connections will be automatically cleaned up when the GUI is destroyed
        end
    end
    
    -- Also clear any other connections
    if AutoChop and AutoChop.Connection then
        AutoChop.Connection:Disconnect()
    end
    
    -- Clear the buttons table
    buttons = {}
end



-- Group Container Function (Voidware Style)
function GuiLibrary:CreateGroup(tab, groupName, groupHeight)
    local groupFrame = Instance.new("Frame")
    groupFrame.Name = "Group_" .. groupName
    groupFrame.Size = UDim2.new(1, 0, 0, groupHeight or 150)
    groupFrame.BackgroundTransparency = 1
    groupFrame.Parent = tab.Frame

    -- Main container with professional styling
    local container = Instance.new("Frame")
    container.Name = "Container"
    container.Size = UDim2.new(1, 0, 1, 0)
    container.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
    container.BackgroundTransparency = 0.1
    container.BorderSizePixel = 0
    container.Parent = groupFrame

    local containerCorner = Instance.new("UICorner")
    containerCorner.CornerRadius = UDim.new(0, 8)
    containerCorner.Parent = container

    -- Subtle border for depth
    local border = Instance.new("Frame")
    border.Name = "Border"
    border.Size = UDim2.new(1, 0, 1, 0)
    border.BackgroundTransparency = 1
    border.BorderColor3 = Color3.fromRGB(45, 45, 50)
    border.BorderSizePixel = 1
    border.Parent = container

    local borderCorner = Instance.new("UICorner")
    borderCorner.CornerRadius = UDim.new(0, 8)
    borderCorner.Parent = border

    -- Header with accent
    local header = Instance.new("Frame")
    header.Name = "Header"
    header.Size = UDim2.new(1, 0, 0, 28)
    header.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
    header.BackgroundTransparency = 0.1
    header.BorderSizePixel = 0
    header.Parent = container

    local headerCorner = Instance.new("UICorner")
    headerCorner.CornerRadius = UDim.new(0, 8)
    headerCorner.Parent = header

    -- Header top corner mask to only round top corners
    local headerMask = Instance.new("Frame")
    headerMask.Name = "HeaderMask"
    headerMask.Size = UDim2.new(1, 0, 1, 8)
    headerMask.Position = UDim2.new(0, 0, 0, 0)
    headerMask.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
    headerMask.BorderSizePixel = 0
    headerMask.Parent = header

    -- Group title
    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.Size = UDim2.new(1, -20, 1, 0)
    title.Position = UDim2.new(0, 10, 0, 0)
    title.BackgroundTransparency = 1
    title.Text = groupName
    title.TextColor3 = Color3.fromRGB(220, 220, 220)
    title.TextSize = 12
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Font = Enum.Font.GothamSemibold
    title.Parent = header

    -- Accent line under header
    local accentLine = Instance.new("Frame")
    accentLine.Name = "AccentLine"
    accentLine.Size = UDim2.new(1, 0, 0, 1)
    accentLine.Position = UDim2.new(0, 0, 1, 0)
    accentLine.BackgroundColor3 = Theme.Accent
    accentLine.BackgroundTransparency = 0.3
    accentLine.BorderSizePixel = 0
    accentLine.Parent = header

    -- Content area
    local content = Instance.new("ScrollingFrame")
    content.Name = "Content"
    content.Size = UDim2.new(1, -16, 1, -44)
    content.Position = UDim2.new(0, 8, 0, 36)
    content.BackgroundTransparency = 1
    content.BorderSizePixel = 0
    content.ScrollBarThickness = 3
    content.ScrollBarImageColor3 = Theme.Accent
    content.ScrollBarImageTransparency = 0.5
    content.Parent = container

    local contentLayout = Instance.new("UIListLayout")
    contentLayout.Padding = UDim.new(0, 6)
    contentLayout.SortOrder = Enum.SortOrder.LayoutOrder
    contentLayout.Parent = content

    local contentPadding = Instance.new("UIPadding")
    contentPadding.PaddingTop = UDim.new(0, 8)
    contentPadding.PaddingLeft = UDim.new(0, 4)
    contentPadding.PaddingRight = UDim.new(0, 4)
    contentPadding.Parent = content

    -- Update content size
    contentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        content.CanvasSize = UDim2.new(0, 0, 0, contentLayout.AbsoluteContentSize.Y + 16)
    end)

    -- Create group object with methods
    local groupObj = {}

    function groupObj:AddButton(buttonName, callback, isPremium)
        return GuiLibrary:CreateButton({Frame = content}, buttonName, callback, isPremium)
    end
	
	function groupObj:AddColorPicker(label, defaultColor, callback, isPremium, configKey)
    	return GuiLibrary:CreateColorPicker({Frame = content}, label, defaultColor, callback, isPremium, configKey)
	end

    function groupObj:AddToggle(toggleName, defaultState, callback, isPremium)
        return GuiLibrary:CreateToggle({Frame = content}, toggleName, defaultState, callback, isPremium)
    end

    function groupObj:AddLabel(labelText)
        return GuiLibrary:CreateLabel({Frame = content}, labelText)
    end

    function groupObj:AddSeparator(separatorName)
        return GuiLibrary:CreateSeparator({Frame = content}, separatorName)
    end

    function groupObj:AddDropdown(dropdownName, options, defaultSelection, callback, isPremium)
        return GuiLibrary:CreateDropdown({Frame = content}, dropdownName, options, defaultSelection, callback, isPremium)
    end

    function groupObj:AddSlider(sliderName, minValue, maxValue, defaultValue, callback, isPremium)
        return GuiLibrary:CreateSlider({Frame = content}, sliderName, minValue, maxValue, defaultValue, callback, isPremium)
    end

    function groupObj:AddInput(inputName, placeholder, defaultValue, callback, isPremium)
        return GuiLibrary:CreateInput({Frame = content}, inputName, placeholder, defaultValue, callback, isPremium)
    end

    function groupObj:AddMultiDropdown(dropdownName, options, defaultSelections, callback, isPremium)
        return GuiLibrary:CreateMultiDropdown({Frame = content}, dropdownName, options, defaultSelections, callback, isPremium)
    end

    function groupObj:AddCombo(comboName, toggleCallback, action1Callback, action2Callback, isPremium)
        return GuiLibrary:CreateCombo({Frame = content}, comboName, toggleCallback, action1Callback, action2Callback, isPremium)
    end

    function groupObj:AddProgressBar(progressName, minValue, maxValue, defaultValue, callback)
        return GuiLibrary:CreateProgressBar({Frame = content}, progressName, minValue, maxValue, defaultValue, callback)
    end

    function groupObj:SetHeight(newHeight)
        groupFrame.Size = UDim2.new(1, 0, 0, newHeight)
    end

    function groupObj:GetHeight()
        return groupFrame.Size.Y.Offset
    end

    function groupObj:SetVisible(visible)
        groupFrame.Visible = visible
    end

    function groupObj:IsVisible()
        return groupFrame.Visible
    end

    function groupObj:SetTitle(newTitle)
        title.Text = newTitle
    end

    function groupObj:GetTitle()
        return title.Text
    end

    function groupObj:SetAccentColor(color)
        accentLine.BackgroundColor3 = color
    end

    function groupObj:Clear()
        for _, child in pairs(content:GetChildren()) do
            if child:IsA("GuiObject") and child.Name ~= "UIListLayout" and child.Name ~= "UIPadding" then
                child:Destroy()
            end
        end
    end

    function groupObj:GetContentCount()
        local count = 0
        for _, child in pairs(content:GetChildren()) do
            if child:IsA("GuiObject") and child.Name ~= "UIListLayout" and child.Name ~= "UIPadding" then
                count = count + 1
            end
        end
        return count
    end

    function groupObj:GetInstance()
        return groupFrame
    end

    function groupObj:Destroy()
        groupFrame:Destroy()
    end

    return groupObj
end

-- Collapsible Group Function (Voidware Style) - UPDATED WITH AUTO-REGISTRATION
function GuiLibrary:CreateCollapsibleGroup(tab, groupName, defaultExpanded, groupHeight)
    local isExpanded = defaultExpanded ~= false -- Default to expanded
 
    local groupFrame = Instance.new("Frame")
    groupFrame.Name = "CollapsibleGroup_" .. groupName
    groupFrame.Size = UDim2.new(1, 0, 0, isExpanded and (groupHeight or 150) or 36)
    groupFrame.BackgroundTransparency = 1
    groupFrame.Parent = tab.Frame
 
    -- Main container
    local container = Instance.new("Frame")
    container.Name = "Container"
    container.Size = UDim2.new(1, 0, 1, 0)
    container.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
    container.BackgroundTransparency = 0.1
    container.BorderSizePixel = 0
    container.Parent = groupFrame
 
    local containerCorner = Instance.new("UICorner")
    containerCorner.CornerRadius = UDim.new(0, 8)
    containerCorner.Parent = container
 
    -- Border
    local border = Instance.new("Frame")
    border.Name = "Border"
    border.Size = UDim2.new(1, 0, 1, 0)
    border.BackgroundTransparency = 1
    border.BorderColor3 = Color3.fromRGB(45, 45, 50)
    border.BorderSizePixel = 1
    border.Parent = container
 
    local borderCorner = Instance.new("UICorner")
    borderCorner.CornerRadius = UDim.new(0, 8)
    borderCorner.Parent = border
 
    -- Header with toggle functionality
    local header = Instance.new("TextButton")
    header.Name = "Header"
    header.Size = UDim2.new(1, 0, 0, 28)
    header.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
    header.BackgroundTransparency = 0.1
    header.BorderSizePixel = 0
    header.Text = ""
    header.Parent = container
 
    local headerCorner = Instance.new("UICorner")
    headerCorner.CornerRadius = UDim.new(0, 8)
    headerCorner.Parent = header
 
    -- Header mask for rounded corners
    local headerMask = Instance.new("Frame")
    headerMask.Name = "HeaderMask"
    headerMask.Size = UDim2.new(1, 0, 1, isExpanded and 8 or 0)
    headerMask.Position = UDim2.new(0, 0, 0, 0)
    headerMask.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
    headerMask.BorderSizePixel = 0
    headerMask.Parent = header
 
    -- Group title
    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.Size = UDim2.new(1, -40, 1, 0)
    title.Position = UDim2.new(0, 10, 0, 0)
    title.BackgroundTransparency = 1
    title.Text = groupName
    title.TextColor3 = Color3.fromRGB(220, 220, 220)
    title.TextSize = 12
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Font = Enum.Font.GothamSemibold
    title.Parent = header
 
    -- Expand/collapse icon
    local expandIcon = Instance.new("TextLabel")
    expandIcon.Name = "ExpandIcon"
    expandIcon.Size = UDim2.new(0, 20, 0, 20)
    expandIcon.Position = UDim2.new(1, -25, 0.5, -10)
    expandIcon.BackgroundTransparency = 1
    expandIcon.Text = isExpanded and "â–¼" or "â–º"
    expandIcon.TextColor3 = Theme.Accent
    expandIcon.TextSize = 12
    expandIcon.Font = Enum.Font.GothamBold
    expandIcon.Parent = header
 
    -- Accent line
    local accentLine = Instance.new("Frame")
    accentLine.Name = "AccentLine"
    accentLine.Size = UDim2.new(1, 0, 0, 1)
    accentLine.Position = UDim2.new(0, 0, 1, 0)
    accentLine.BackgroundColor3 = Theme.Accent
    accentLine.BackgroundTransparency = 0.3
    accentLine.BorderSizePixel = 0
    accentLine.Visible = isExpanded
    accentLine.Parent = header
 
    -- Content area
    local content = Instance.new("ScrollingFrame")
    content.Name = "Content"
    content.Size = UDim2.new(1, -16, 1, -44)
    content.Position = UDim2.new(0, 8, 0, 36)
    content.BackgroundTransparency = 1
    content.BorderSizePixel = 0
    content.ScrollBarThickness = 3
    content.ScrollBarImageColor3 = Theme.Accent
    content.ScrollBarImageTransparency = 0.5
    content.Visible = isExpanded
    content.Parent = container
 
    local contentLayout = Instance.new("UIListLayout")
    contentLayout.Padding = UDim.new(0, 6)
    contentLayout.SortOrder = Enum.SortOrder.LayoutOrder
    contentLayout.Parent = content
 
    local contentPadding = Instance.new("UIPadding")
    contentPadding.PaddingTop = UDim.new(0, 8)
    contentPadding.PaddingLeft = UDim.new(0, 4)
    contentPadding.PaddingRight = UDim.new(0, 4)
    contentPadding.Parent = content
 
    -- Update content size
    contentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        content.CanvasSize = UDim2.new(0, 0, 0, contentLayout.AbsoluteContentSize.Y + 16)
    end)
 
    -- Toggle function
    local function toggleExpanded()
        isExpanded = not isExpanded
 
        if isExpanded then
            -- Expand
            groupFrame.Size = UDim2.new(1, 0, 0, groupHeight or 150)
            expandIcon.Text = "â–¼"
            accentLine.Visible = true
            content.Visible = true
            headerMask.Size = UDim2.new(1, 0, 1, 8)
 
            TweenService:Create(groupFrame, TweenInfo.new(0.2), {
                Size = UDim2.new(1, 0, 0, groupHeight or 150)
            }):Play()
        else
            -- Collapse
            expandIcon.Text = "â–º"
            accentLine.Visible = false
            content.Visible = false
            headerMask.Size = UDim2.new(1, 0, 1, 0)
 
            TweenService:Create(groupFrame, TweenInfo.new(0.2), {
                Size = UDim2.new(1, 0, 0, 36)
            }):Play()
        end
    end
 
    header.MouseButton1Click:Connect(toggleExpanded)
 
    -- Create collapsible group object with methods
    local collapsibleGroupObj = {}
    
    -- Helper function to auto-register elements
    local function autoRegisterElement(elementName, elementObject)
        if not elementName or not elementObject then return end
        
        -- Register with simple name
        elementRegistry[elementName] = elementObject
        
        -- Also register with group prefix
        local fullName = groupName .. "." .. elementName
        elementRegistry[fullName] = elementObject
        
        -- Alternative: Register with group name
        elementRegistry[groupName .. "_" .. elementName] = elementObject
        
        return elementObject
    end
 
    -- NEW: Add Combo method WITH AUTO-REGISTRATION
    function collapsibleGroupObj:AddCombo(comboName, toggleCallback, action1Callback, action2Callback, isPremium)
        local comboObj = GuiLibrary:CreateCombo({Frame = content}, comboName, toggleCallback, action1Callback, action2Callback, isPremium)
        return autoRegisterElement(comboName, comboObj)
    end
 
    function collapsibleGroupObj:AddButton(buttonName, callback, isPremium)
        local buttonObj = GuiLibrary:CreateButton({Frame = content}, buttonName, callback, isPremium)
        return autoRegisterElement(buttonName, buttonObj)
    end
	
	function collapsibleGroupObj:AddColorPicker(label, defaultColor, callback, isPremium, configKey)
    	local colorPickerObj = GuiLibrary:CreateColorPicker({Frame = content}, label, defaultColor, callback, isPremium, configKey)
        return autoRegisterElement(label, colorPickerObj)
	end
 
    function collapsibleGroupObj:AddToggle(toggleName, defaultState, callback, isPremium)
        local toggleObj = GuiLibrary:CreateToggle({Frame = content}, toggleName, defaultState, callback, isPremium)
        return autoRegisterElement(toggleName, toggleObj)
    end
 
    function collapsibleGroupObj:AddLabel(labelText)
        local labelObj = GuiLibrary:CreateLabel({Frame = content}, labelText)
        return autoRegisterElement(labelText, labelObj)
    end
 
    function collapsibleGroupObj:AddSeparator(separatorName)
        local separatorObj = GuiLibrary:CreateSeparator({Frame = content}, separatorName)
        return autoRegisterElement(separatorName, separatorObj)
    end
 
    function collapsibleGroupObj:AddDropdown(dropdownName, options, defaultSelection, callback, isPremium)
        local dropdownObj = GuiLibrary:CreateDropdown({Frame = content}, dropdownName, options, defaultSelection, callback, isPremium)
        return autoRegisterElement(dropdownName, dropdownObj)
    end
 
    function collapsibleGroupObj:AddSlider(sliderName, minValue, maxValue, defaultValue, callback, isPremium)
        local sliderObj = GuiLibrary:CreateSlider({Frame = content}, sliderName, minValue, maxValue, defaultValue, callback, isPremium)
        return autoRegisterElement(sliderName, sliderObj)
    end
 
    function collapsibleGroupObj:AddInput(inputName, placeholder, defaultValue, callback, isPremium)
        local inputObj = GuiLibrary:CreateInput({Frame = content}, inputName, placeholder, defaultValue, callback, isPremium)
        return autoRegisterElement(inputName, inputObj)
    end
 
    function collapsibleGroupObj:AddMultiDropdown(dropdownName, options, defaultSelections, callback, isPremium)
        local multiDropdownObj = GuiLibrary:CreateMultiDropdown({Frame = content}, dropdownName, options, defaultSelections, callback, isPremium)
        return autoRegisterElement(dropdownName, multiDropdownObj)
    end
 
    function collapsibleGroupObj:AddProgressBar(progressName, minValue, maxValue, defaultValue, callback)
        local progressBarObj = GuiLibrary:CreateProgressBar({Frame = content}, progressName, minValue, maxValue, defaultValue, callback)
        return autoRegisterElement(progressName, progressBarObj)
    end
 
    function collapsibleGroupObj:Expand()
        if not isExpanded then
            toggleExpanded()
        end
    end
 
    function collapsibleGroupObj:Collapse()
        if isExpanded then
            toggleExpanded()
        end
    end
 
    function collapsibleGroupObj:IsExpanded()
        return isExpanded
    end
 
    function collapsibleGroupObj:SetHeight(newHeight)
        if isExpanded then
            groupFrame.Size = UDim2.new(1, 0, 0, newHeight)
        end
        groupHeight = newHeight
    end
 
    function collapsibleGroupObj:SetTitle(newTitle)
        title.Text = newTitle
    end
 
    function collapsibleGroupObj:GetTitle()
        return title.Text
    end
 
    function collapsibleGroupObj:SetAccentColor(color)
        accentLine.BackgroundColor3 = color
        expandIcon.TextColor3 = color
    end
 
    function collapsibleGroupObj:Clear()
        for _, child in pairs(content:GetChildren()) do
            if child:IsA("GuiObject") and child.Name ~= "UIListLayout" and child.Name ~= "UIPadding" then
                child:Destroy()
            end
        end
    end
 
    function collapsibleGroupObj:GetContentCount()
        local count = 0
        for _, child in pairs(content:GetChildren()) do
            if child:IsA("GuiObject") and child.Name ~= "UIListLayout" and child.Name ~= "UIPadding" then
                count = count + 1
            end
        end
        return count
    end
 
    function collapsibleGroupObj:GetInstance()
        return groupFrame
    end
 
    function collapsibleGroupObj:Destroy()
        groupFrame:Destroy()
    end
    
    -- NEW: Get all registered elements from this group
    function collapsibleGroupObj:GetRegisteredElements()
        local elements = {}
        for name, element in pairs(elementRegistry) do
            if name:find(groupName .. ".") == 1 or name:find(groupName .. "_") == 1 then
                elements[name] = element
            end
        end
        return elements
    end
    
    -- NEW: Get element by name from this group
    function collapsibleGroupObj:GetElement(elementName)
        -- Try different naming patterns
        local patterns = {
            elementName,
            groupName .. "." .. elementName,
            groupName .. "_" .. elementName
        }
        
        for _, pattern in ipairs(patterns) do
            local element = elementRegistry[pattern]
            if element then
                return element
            end
        end
        return nil
    end
 
    return collapsibleGroupObj
end


--NewCombo
-- Create Combo Function (Professional Style) - Label, Toggle, Action Buttons with Keybind below
function GuiLibrary:CreateCombo(tab, comboName, toggleCallback, action1Callback, action2Callback, isPremium, defaultKeybind)
    local comboFrame = Instance.new("Frame")
    comboFrame.Name = "Combo_" .. comboName
    comboFrame.Size = UDim2.new(1, 0, 0, 72)
    comboFrame.BackgroundTransparency = 1
    comboFrame.Parent = tab.Frame
 
    -- Main container with professional dark theme
    local background = Instance.new("Frame")
    background.Name = "Background"
    background.Size = UDim2.new(1, 0, 1, 0)
    background.BackgroundColor3 = Color3.fromRGB(28, 28, 32)
    background.BackgroundTransparency = 0
    background.BorderSizePixel = 0
    background.Parent = comboFrame
 
    local backgroundCorner = Instance.new("UICorner")
    backgroundCorner.CornerRadius = UDim.new(0, 6)
    backgroundCorner.Parent = background
 
    -- Subtle border for depth
    local border = Instance.new("Frame")
    border.Name = "Border"
    border.Size = UDim2.new(1, 0, 1, 0)
    border.BackgroundTransparency = 1
    border.BorderColor3 = Color3.fromRGB(45, 45, 50)
    border.BorderSizePixel = 1
    border.Parent = background
 
    local borderCorner = Instance.new("UICorner")
    borderCorner.CornerRadius = UDim.new(0, 6)
    borderCorner.Parent = border
 
    -- Top row container: Label - Toggle - Button1 - Button2
    local topRow = Instance.new("Frame")
    topRow.Name = "TopRow"
    topRow.Size = UDim2.new(1, -20, 0, 32)
    topRow.Position = UDim2.new(0, 10, 0, 8)
    topRow.BackgroundTransparency = 1
    topRow.Parent = comboFrame
 
    -- Professional label
    local label = Instance.new("TextLabel")
    label.Name = "Label"
    label.Size = UDim2.new(0.25, -6, 1, 0)
    label.Position = UDim2.new(0, 0, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = comboName
    label.TextColor3 = Color3.fromRGB(230, 230, 230)
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Font = Enum.Font.Gotham
    label.Parent = topRow
 
    -- Toggle Button (ON/OFF) - maintains state
    local toggleButton = Instance.new("TextButton")
    toggleButton.Name = "Toggle"
    toggleButton.Size = UDim2.new(0.2, -4, 0.7, 0)
    toggleButton.Position = UDim2.new(0.50, 4, 0.15, 0)
    toggleButton.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
    toggleButton.BackgroundTransparency = 0
    toggleButton.BorderSizePixel = 0
    toggleButton.Text = "OFF"
    toggleButton.TextColor3 = Color3.fromRGB(180, 180, 180)
    toggleButton.TextSize = 10
    toggleButton.Font = Enum.Font.GothamMedium
    toggleButton.Parent = topRow
 
    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(0, 4)
    toggleCorner.Parent = toggleButton
 
    -- Action Button 1 (Press button - no toggle state)
    local action1Button = Instance.new("TextButton")
    action1Button.Name = "Action1"
    action1Button.Size = UDim2.new(0.15, -2, 0.7, 0)
    action1Button.Position = UDim2.new(0.70, 4, 0.15, 0)
    action1Button.BackgroundColor3 = Color3.fromRGB(40, 120, 80)
    action1Button.BackgroundTransparency = 0
    action1Button.BorderSizePixel = 0
    action1Button.Text = "RUN"
    action1Button.TextColor3 = Color3.fromRGB(230, 230, 230)
    action1Button.TextSize = 10
    action1Button.Font = Enum.Font.GothamMedium
    action1Button.Parent = topRow
 
    local action1Corner = Instance.new("UICorner")
    action1Corner.CornerRadius = UDim.new(0, 4)
    action1Corner.Parent = action1Button
 
    -- Action Button 2 (Press button - no toggle state)
    local action2Button = Instance.new("TextButton")
    action2Button.Name = "Action2"
    action2Button.Size = UDim2.new(0.15, -2, 0.7, 0)
    action2Button.Position = UDim2.new(0.85, 4, 0.15, 0)
    action2Button.BackgroundColor3 = Color3.fromRGB(120, 80, 80)
    action2Button.BackgroundTransparency = 0
    action2Button.BorderSizePixel = 0
    action2Button.Text = "RESET"
    action2Button.TextColor3 = Color3.fromRGB(230, 230, 230)
    action2Button.TextSize = 10
    action2Button.Font = Enum.Font.GothamMedium
    action2Button.Parent = topRow
 
    local action2Corner = Instance.new("UICorner")
    action2Corner.CornerRadius = UDim.new(0, 4)
    action2Corner.Parent = action2Button
 
    -- Keybind container (bottom line)
    local keybindContainer = Instance.new("Frame")
    keybindContainer.Name = "KeybindContainer"
    keybindContainer.Size = UDim2.new(1, -20, 0, 20)
    keybindContainer.Position = UDim2.new(0, 10, 0, 44)
    keybindContainer.BackgroundTransparency = 1
    keybindContainer.Parent = comboFrame
 
    -- Keybind label
    local keybindLabel = Instance.new("TextLabel")
    keybindLabel.Name = "KeybindLabel"
    keybindLabel.Size = UDim2.new(0.3, 0, 1, 0)
    keybindLabel.Position = UDim2.new(0, 0, 0, 0)
    keybindLabel.BackgroundTransparency = 1
    keybindLabel.Text = "Keybind:"
    keybindLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    keybindLabel.TextSize = 10
    keybindLabel.TextXAlignment = Enum.TextXAlignment.Left
    keybindLabel.Font = Enum.Font.Gotham
    keybindLabel.Parent = keybindContainer
 
    -- Keybind display button (shows current keybind and allows changing)
    local keybindButton = Instance.new("TextButton")
    keybindButton.Name = "KeybindButton"
    keybindButton.Size = UDim2.new(0.3, 0, 0.7, 0)
    keybindButton.Position = UDim2.new(0.3, 4, 0.15, 0)
    keybindButton.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    keybindButton.BackgroundTransparency = 0
    keybindButton.BorderSizePixel = 0
    keybindButton.TextColor3 = Color3.fromRGB(230, 230, 230)
    keybindButton.TextSize = 10
    keybindButton.Font = Enum.Font.GothamMedium
    keybindButton.Parent = keybindContainer
 
    local keybindButtonCorner = Instance.new("UICorner")
    keybindButtonCorner.CornerRadius = UDim.new(0, 4)
    keybindButtonCorner.Parent = keybindButton
 
    -- Keybind status (shows if listening for input)
    local keybindStatus = Instance.new("TextLabel")
    keybindStatus.Name = "KeybindStatus"
    keybindStatus.Size = UDim2.new(0.4, 0, 1, 0)
    keybindStatus.Position = UDim2.new(0.6, 8, 0, 0)
    keybindStatus.BackgroundTransparency = 1
    keybindStatus.Text = "Click to change"
    keybindStatus.TextColor3 = Color3.fromRGB(120, 120, 120)
    keybindStatus.TextSize = 9
    keybindStatus.TextXAlignment = Enum.TextXAlignment.Right
    keybindStatus.Font = Enum.Font.Gotham
    keybindStatus.Parent = keybindContainer
 
    -- State variables
    local isToggled = false
    local currentKeybind = defaultKeybind or Enum.KeyCode.U
    local isListeningForInput = false
    local keybindConnection = nil
    local comboId = comboName:gsub("%s+", "_"):upper() -- Create unique ID for saving

    -- ========== UPDATED FUNCTIONS ==========
    
    -- Function to convert key string to Enum.KeyCode (SUPPORTS MOUSE)
    local function stringToKeyCode(keyString)
        -- Handle mouse buttons
        if keyString:upper() == "MOUSEBUTTON2" or keyString:upper() == "RIGHTMOUSE" then
            return Enum.UserInputType.MouseButton2
        elseif keyString:upper() == "MOUSEBUTTON1" or keyString:upper() == "LEFTMOUSE" then
            return Enum.UserInputType.MouseButton1
        elseif keyString:upper() == "MOUSEBUTTON3" then
            return Enum.UserInputType.MouseButton3
        end
        
        -- Handle keyboard keys
        for _, key in pairs(Enum.KeyCode:GetEnumItems()) do
            if tostring(key) == "Enum.KeyCode." .. keyString then
                return key
            end
        end
        
        -- Manual mapping for special keys
        local specialKeys = {
            ["INSERT"] = Enum.KeyCode.Insert,
            ["DELETE"] = Enum.KeyCode.Delete,
            ["HOME"] = Enum.KeyCode.Home,
            ["END"] = Enum.KeyCode.End,
            ["PAGEUP"] = Enum.KeyCode.PageUp,
            ["PAGEDOWN"] = Enum.KeyCode.PageDown,
            ["PRINT"] = Enum.KeyCode.Print,
            ["SCROLLLOCK"] = Enum.KeyCode.ScrollLock,
            ["PAUSE"] = Enum.KeyCode.Pause,
            ["CAPSLOCK"] = Enum.KeyCode.CapsLock,
            ["NUMLOCK"] = Enum.KeyCode.NumLock,
        }
        
        if specialKeys[keyString:upper()] then
            return specialKeys[keyString:upper()]
        end
        
        return defaultKeybind or Enum.KeyCode.U -- Fallback
    end
 
    -- Function to get key name for display (SUPPORTS MOUSE)
    local function getKeyName(keyInput)
        if typeof(keyInput) == "EnumItem" then
            if keyInput.EnumType == Enum.KeyCode then
                return tostring(keyInput):gsub("Enum.KeyCode.", "")
            elseif keyInput.EnumType == Enum.UserInputType then
                local name = tostring(keyInput):gsub("Enum.UserInputType.", "")
                if name == "MouseButton2" then return "RIGHT MOUSE" end
                if name == "MouseButton1" then return "LEFT MOUSE" end
                if name == "MouseButton3" then return "MIDDLE MOUSE" end
                return name
            end
        end
        return "UNKNOWN"
    end
 
    -- Update keybind display
    local function updateKeybindDisplay()
        keybindButton.Text = getKeyName(currentKeybind)
    end
 
    -- Update toggle appearance
    local function updateToggleAppearance()
        if isToggled then
            toggleButton.BackgroundColor3 = Color3.fromRGB(50, 120, 80)
            toggleButton.TextColor3 = Color3.fromRGB(240, 240, 240)
            toggleButton.Text = "ON"
        else
            toggleButton.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
            toggleButton.TextColor3 = Color3.fromRGB(180, 180, 180)
            toggleButton.Text = "OFF"
        end
    end
 
    -- Save keybind to file
    local function saveKeybindToFile()
        local success, message = pcall(function()
            -- Create config directory if it doesn't exist
            if not isfolder("KeybindConfig") then
                makefolder("KeybindConfig")
            end
 
            -- Read existing config or create new one
            local config = {}
            if isfile("KeybindConfig/keybinds.json") then
                local existingData = readfile("KeybindConfig/keybinds.json")
                config = game:GetService("HttpService"):JSONDecode(existingData)
            end
 
            -- Save keybind as string (handle both keyboard and mouse)
            local keybindString = ""
            if typeof(currentKeybind) == "EnumItem" then
                if currentKeybind.EnumType == Enum.KeyCode then
                    keybindString = tostring(currentKeybind):gsub("Enum.KeyCode.", "")
                elseif currentKeybind.EnumType == Enum.UserInputType then
                    keybindString = tostring(currentKeybind):gsub("Enum.UserInputType.", "")
                end
            end
 
            -- Update or add this combo's keybind
            config[comboId] = {
                keybind = keybindString,
                timestamp = os.time()
            }
 
            -- Save to file
            writefile("KeybindConfig/keybinds.json", game:GetService("HttpService"):JSONEncode(config))
 
            -- Show save confirmation
            keybindStatus.Text = "Saved!"
            keybindStatus.TextColor3 = Color3.fromRGB(80, 180, 80)
 
            delay(2, function()
                if keybindStatus then
                    keybindStatus.Text = "Click to change"
                    keybindStatus.TextColor3 = Color3.fromRGB(120, 120, 120)
                end
            end)
        end)
 
        if not success then
            warn("Failed to save keybind: " .. tostring(message))
            keybindStatus.Text = "Save failed!"
            keybindStatus.TextColor3 = Color3.fromRGB(220, 80, 80)
        end
    end
 
    -- Load keybind from file
    local function loadKeybindFromFile()
        local success, message = pcall(function()
            if isfile("KeybindConfig/keybinds.json") then
                local configData = readfile("KeybindConfig/keybinds.json")
                local config = game:GetService("HttpService"):JSONDecode(configData)
 
                if config[comboId] then
                    local savedKeybind = config[comboId].keybind
                    currentKeybind = stringToKeyCode(savedKeybind)
                    updateKeybindDisplay()
 
                    keybindStatus.Text = "Loaded!"
                    keybindStatus.TextColor3 = Color3.fromRGB(80, 180, 80)
 
                    delay(2, function()
                        if keybindStatus then
                            keybindStatus.Text = "Click to change"
                            keybindStatus.TextColor3 = Color3.fromRGB(120, 120, 120)
                        end
                    end)
 
                    return true
                end
            end
            return false
        end)
 
        if not success then
            warn("Failed to load keybind: " .. tostring(message))
        end
 
        return false
    end
 
    -- Reset keybind to default using Delete key
    local function resetKeybindWithDelete()
        -- Show instructions
        keybindStatus.Text = "Press DELETE to reset"
        keybindStatus.TextColor3 = Color3.fromRGB(255, 100, 100)
        
        -- Listen for Delete key
        local deleteListener = nil
        deleteListener = game:GetService("UserInputService").InputBegan:Connect(function(input, gameProcessed)
            if gameProcessed then return end
            
            if input.KeyCode == Enum.KeyCode.Delete then
                currentKeybind = defaultKeybind or Enum.KeyCode.U
                updateKeybindDisplay()
                saveKeybindToFile()
                
                keybindStatus.Text = "Reset to default"
                keybindStatus.TextColor3 = Color3.fromRGB(255, 165, 0)
                
                -- Clean up listener
                if deleteListener then
                    deleteListener:Disconnect()
                end
                
                -- Reset status after 2 seconds
                delay(2, function()
                    if keybindStatus then
                        keybindStatus.Text = "Click to change"
                        keybindStatus.TextColor3 = Color3.fromRGB(120, 120, 120)
                    end
                end)
            end
        end)
        
        -- Auto-cancel after 5 seconds
        delay(5, function()
            if deleteListener then
                deleteListener:Disconnect()
            end
            if keybindStatus then
                keybindStatus.Text = "Click to change"
                keybindStatus.TextColor3 = Color3.fromRGB(120, 120, 120)
            end
        end)
    end
 
    -- Start listening for keybind input (SUPPORTS MOUSE)
    local function startKeybindListening()
        if isPremium and not IsPremium then return end
        if isListeningForInput then return end
 
        isListeningForInput = true
        keybindButton.BackgroundColor3 = Color3.fromRGB(70, 130, 200)
        keybindStatus.Text = "Press any key/mouse..."
        keybindStatus.TextColor3 = Color3.fromRGB(70, 130, 200)
 
        -- Disconnect previous connection if exists
        if keybindConnection then
            keybindConnection:Disconnect()
        end
 
        -- Listen for key/mouse input
        keybindConnection = game:GetService("UserInputService").InputBegan:Connect(function(input, gameProcessed)
            if gameProcessed then return end
 
            -- Accept keyboard keys
            if input.UserInputType == Enum.UserInputType.Keyboard then
                currentKeybind = input.KeyCode
            -- Accept mouse buttons
            elseif input.UserInputType == Enum.UserInputType.MouseButton1 then
                currentKeybind = Enum.UserInputType.MouseButton1
            elseif input.UserInputType == Enum.UserInputType.MouseButton2 then
                currentKeybind = Enum.UserInputType.MouseButton2
            elseif input.UserInputType == Enum.UserInputType.MouseButton3 then
                currentKeybind = Enum.UserInputType.MouseButton3
            else
                return -- Ignore other inputs
            end
            
            updateKeybindDisplay()
 
            -- Save automatically when keybind is changed
            saveKeybindToFile()
 
            -- Stop listening
            isListeningForInput = false
            keybindButton.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
 
            -- Disconnect the listener
            if keybindConnection then
                keybindConnection:Disconnect()
                keybindConnection = nil
            end
        end)
    end
 
    -- Stop listening for keybind input
    local function stopKeybindListening()
        if keybindConnection then
            keybindConnection:Disconnect()
            keybindConnection = nil
        end
        isListeningForInput = false
        keybindButton.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
        keybindStatus.Text = "Click to change"
        keybindStatus.TextColor3 = Color3.fromRGB(120, 120, 120)
    end
 
    -- Initialize: Try to load saved keybind, otherwise use default
    local function initializeKeybind()
        local loaded = loadKeybindFromFile()
        if not loaded then
            updateKeybindDisplay() -- Use default keybind
        end
    end
 
    -- Call initialization
    initializeKeybind()
    updateToggleAppearance()
 
    -- Professional button hover effects
    local function setupButtonEffects(button, defaultColor, hoverColor)
        button.MouseEnter:Connect(function()
            if not isMobile and (not isPremium or IsPremium) then
                TweenService:Create(button, TweenInfo.new(0.15), {BackgroundColor3 = hoverColor}):Play()
            end
        end)
 
        button.MouseLeave:Connect(function()
            if not isMobile and (not isPremium or IsPremium) then
                TweenService:Create(button, TweenInfo.new(0.15), {BackgroundColor3 = defaultColor}):Play()
            end
        end)
    end
 
    -- Setup button effects
    setupButtonEffects(toggleButton, 
        isToggled and Color3.fromRGB(50, 120, 80) or Color3.fromRGB(60, 60, 65),
        Color3.fromRGB(80, 80, 90))
 
    setupButtonEffects(action1Button,
        Color3.fromRGB(40, 120, 80),
        Color3.fromRGB(60, 140, 100))
 
    setupButtonEffects(action2Button,
        Color3.fromRGB(120, 80, 80),
        Color3.fromRGB(140, 100, 100))
 
    setupButtonEffects(keybindButton,
        Color3.fromRGB(50, 50, 55),
        Color3.fromRGB(60, 60, 70))
 
    -- Keybind button functionality
    keybindButton.MouseButton1Click:Connect(function()
        if isPremium and not IsPremium then return end
 
        if isListeningForInput then
            stopKeybindListening()
        else
            startKeybindListening()
        end
    end)
 
    -- Right-click to start Delete key reset process
    keybindButton.MouseButton2Click:Connect(function()
        if isPremium and not IsPremium then return end
        resetKeybindWithDelete()
    end)
 
    -- Global keybind listener for Action1 functionality (SUPPORTS MOUSE)
    local globalKeybindConnection = game:GetService("UserInputService").InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
 
        -- Check if the pressed key/mouse matches current keybind
        local keyMatches = false
        
        if input.UserInputType == Enum.UserInputType.Keyboard and typeof(currentKeybind) == "EnumItem" and currentKeybind.EnumType == Enum.KeyCode then
            keyMatches = input.KeyCode == currentKeybind
        elseif input.UserInputType == Enum.UserInputType.MouseButton1 and typeof(currentKeybind) == "EnumItem" and currentKeybind.EnumType == Enum.UserInputType then
            keyMatches = currentKeybind == Enum.UserInputType.MouseButton1
        elseif input.UserInputType == Enum.UserInputType.MouseButton2 and typeof(currentKeybind) == "EnumItem" and currentKeybind.EnumType == Enum.UserInputType then
            keyMatches = currentKeybind == Enum.UserInputType.MouseButton2
        elseif input.UserInputType == Enum.UserInputType.MouseButton3 and typeof(currentKeybind) == "EnumItem" and currentKeybind.EnumType == Enum.UserInputType then
            keyMatches = currentKeybind == Enum.UserInputType.MouseButton3
        end
 
        if keyMatches then
            -- Simulate Action1 button click
            if action1Callback then
                -- Visual feedback
                TweenService:Create(action1Button, TweenInfo.new(0.1), {BackgroundTransparency = 0.2}):Play()
                delay(0.1, function()
                    if action1Button then
                        TweenService:Create(action1Button, TweenInfo.new(0.1), {BackgroundTransparency = 0}):Play()
                    end
                end)
 
                action1Callback()
            end
        end
    end)
 
    -- Toggle button functionality
    toggleButton.MouseButton1Click:Connect(function()
        if isPremium and not IsPremium then return end
 
        isToggled = not isToggled
        updateToggleAppearance()
 
        -- Update hover colors for new state
        setupButtonEffects(toggleButton, 
            isToggled and Color3.fromRGB(50, 120, 80) or Color3.fromRGB(60, 60, 65),
            Color3.fromRGB(80, 80, 90))
 
        if toggleCallback then
            toggleCallback(isToggled)
        end
    end)
 
    -- Action Button 1 functionality (press button - no state)
    action1Button.MouseButton1Click:Connect(function()
        if isPremium and not IsPremium then return end
 
        -- Press animation
        TweenService:Create(action1Button, TweenInfo.new(0.1), {BackgroundTransparency = 0.2}):Play()
        wait(0.1)
        TweenService:Create(action1Button, TweenInfo.new(0.1), {BackgroundTransparency = 0}):Play()
 
        if action1Callback then
            action1Callback()
        end
    end)
 
    -- Action Button 2 functionality (press button - no state)
    action2Button.MouseButton1Click:Connect(function()
        if isPremium and not IsPremium then return end
 
        -- Press animation
        TweenService:Create(action2Button, TweenInfo.new(0.1), {BackgroundTransparency = 0.2}):Play()
        wait(0.1)
        TweenService:Create(action2Button, TweenInfo.new(0.1), {BackgroundTransparency = 0}):Play()
 
        if action2Callback then
            action2Callback()
        end
    end)
 
    -- Create combo object with methods
    local comboObj = {
        Instance = comboFrame,
        PremiumLock = premiumLock
    }
 
    function comboObj:GetState()
        return {
            Toggled = isToggled,
            Keybind = currentKeybind
        }
    end
 
    function comboObj:SetState(toggleState, keybind)
        if isPremium and not IsPremium then return end
 
        if toggleState ~= nil then
            isToggled = toggleState
            updateToggleAppearance()
        end
 
        if keybind ~= nil then
            currentKeybind = keybind
            updateKeybindDisplay()
            saveKeybindToFile() -- Auto-save when set programmatically
        end
    end
 
    function comboObj:SetToggle(state)
        if isPremium and not IsPremium then return end
        isToggled = state
        updateToggleAppearance()
        if toggleCallback then
            toggleCallback(isToggled)
        end
    end
 
    function comboObj:SetKeybind(keybind)
        if isPremium and not IsPremium then return end
        currentKeybind = keybind
        updateKeybindDisplay()
        saveKeybindToFile() -- Auto-save
    end
 
    function comboObj:GetKeybind()
        return currentKeybind
    end
 
    function comboObj:SetLabel(newLabel)
        label.Text = newLabel or comboName
    end
 
    function comboObj:SaveKeybind()
        saveKeybindToFile()
    end
 
    function comboObj:LoadKeybind()
        return loadKeybindFromFile()
    end
 
    function comboObj:ResetKeybind()
        currentKeybind = defaultKeybind or Enum.KeyCode.U
        updateKeybindDisplay()
        saveKeybindToFile()
    end
 
    function comboObj:SetButtonColors(toggleColor, action1Color, action2Color, keybindColor)
        if toggleColor then
            toggleButton.BackgroundColor3 = toggleColor
        end
        if action1Color then
            action1Button.BackgroundColor3 = action1Color
        end
        if action2Color then
            action2Button.BackgroundColor3 = action2Color
        end
        if keybindColor then
            keybindButton.BackgroundColor3 = keybindColor
        end
    end
 
    -- Clean up connections when destroyed
    function comboObj:Destroy()
        if globalKeybindConnection then
            globalKeybindConnection:Disconnect()
        end
        if keybindConnection then
            keybindConnection:Disconnect()
        end
        comboFrame:Destroy()
    end
 
    return comboObj
end

-- Global Keybind Manager Functions
GuiLibrary.KeybindManager = {}

-- Save all keybinds (useful for manual saving)
function GuiLibrary.KeybindManager:SaveAllKeybinds(comboObjects)
    local success, message = pcall(function()
        if not isfolder("KeybindConfig") then
            makefolder("KeybindConfig")
        end
        
        local config = {}
        
        -- Collect all keybinds from combo objects
        for name, combo in pairs(comboObjects) do
            if combo and combo.GetKeybind then
                local keybind = combo:GetKeybind()
                config[name] = {
                    keybind = tostring(keybind):gsub("Enum.KeyCode.", ""),
                    timestamp = os.time()
                }
            end
        end
        
        writefile("KeybindConfig/keybinds.json", game:GetService("HttpService"):JSONEncode(config))
        return true
    end)
    
    return success, message
end

-- Load all keybinds (useful for batch loading)
function GuiLibrary.KeybindManager:LoadAllKeybinds(comboObjects)
    local success, message = pcall(function()
        if not isfile("KeybindConfig/keybinds.json") then
            return false, "No saved keybinds found"
        end
        
        local configData = readfile("KeybindConfig/keybinds.json")
        local config = game:GetService("HttpService"):JSONDecode(configData)
        
        local loadedCount = 0
        for name, combo in pairs(comboObjects) do
            if combo and combo.SetKeybind and config[name] then
                local keyCode = stringToKeyCode(config[name].keybind)
                combo:SetKeybind(keyCode)
                loadedCount = loadedCount + 1
            end
        end
        
        return true, "Loaded " .. loadedCount .. " keybinds"
    end)
    
    return success, message
end

-- Reset all keybinds to default
function GuiLibrary.KeybindManager:ResetAllKeybinds(comboObjects, defaultKeybinds)
    for name, combo in pairs(comboObjects) do
        if combo and combo.ResetKeybind then
            combo:ResetKeybind()
        end
    end
end

-- Get keybind configuration file path
function GuiLibrary.KeybindManager:GetConfigPath()
    return "KeybindConfig/keybinds.json"
end

-- Check if config file exists
function GuiLibrary.KeybindManager:ConfigExists()
    return isfile("KeybindConfig/keybinds.json")
end

-- Delete config file (reset all)
function GuiLibrary.KeybindManager:DeleteConfig()
    if isfile("KeybindConfig/keybinds.json") then
        delfile("KeybindConfig/keybinds.json")
        return true
    end
    return false
end
--NewCombo
-- Enhanced Update History with Emoji & Colors
function GuiLibrary:CreateEnhancedUpdateHistory(tab, historyData)
    local scrollFrame = Instance.new("ScrollingFrame")
    scrollFrame.Name = "EnhancedUpdateHistory"
    scrollFrame.Size = UDim2.new(1, 0, 0, 300)
    scrollFrame.BackgroundTransparency = 1
    scrollFrame.ScrollBarThickness = 4
    scrollFrame.ScrollBarImageColor3 = Theme.Accent
    scrollFrame.ScrollBarImageTransparency = 0.5
    scrollFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    scrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    scrollFrame.Parent = tab.Frame
    
    local layout = Instance.new("UIListLayout")
    layout.Padding = UDim.new(0, 28)
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Parent = scrollFrame
    
    local padding = Instance.new("UIPadding")
    padding.PaddingLeft = UDim.new(0, 10)
    padding.PaddingRight = UDim.new(0, 10)
    padding.PaddingTop = UDim.new(0, 10)
    padding.PaddingBottom = UDim.new(0, 10)
    padding.Parent = scrollFrame
    
    -- Emoji and color mappings for different types
    local typeConfig = {
        bug = {
            emoji = "ðŸ›",
            color = Color3.fromRGB(220, 80, 80),  -- Red for bugs
            titleColor = Color3.fromRGB(220, 80, 80),
            bgColor = Color3.fromRGB(220, 80, 80, 0.1)
        },
        update = {
            emoji = "ðŸ”„",
            color = Color3.fromRGB(0, 150, 255),  -- Blue for updates
            titleColor = Color3.fromRGB(0, 150, 255),
            bgColor = Color3.fromRGB(0, 150, 255, 0.1)
        },
        improvement = {
            emoji = "âš¡",
            color = Color3.fromRGB(255, 165, 0),  -- Orange for improvements
            titleColor = Color3.fromRGB(255, 165, 0),
            bgColor = Color3.fromRGB(255, 165, 0, 0.1)
        },
        feature = {
            emoji = "âœ¨",
            color = Color3.fromRGB(0, 200, 100),  -- Green for features
            titleColor = Color3.fromRGB(0, 200, 100),
            bgColor = Color3.fromRGB(0, 200, 100, 0.1)
        },
        security = {
            emoji = "ðŸ”’",
            color = Color3.fromRGB(150, 100, 255), -- Purple for security
            titleColor = Color3.fromRGB(150, 100, 255),
            bgColor = Color3.fromRGB(150, 100, 255, 0.1)
        },
        default = {
            emoji = "ðŸ“",
            color = Theme.TextSecondary,
            titleColor = Theme.TextSecondary,
            bgColor = Theme.Secondary
        }
    }
    
    -- Helper function to get type config
    local function getTypeConfig(changeType)
        local typeLower = string.lower(changeType or "default")
        return typeConfig[typeLower] or typeConfig.default
    end
    
    -- Sort by date (newest first)
    local sortedUpdates = {}
    for _, update in ipairs(historyData.Updates) do
        table.insert(sortedUpdates, update)
    end
    
    table.sort(sortedUpdates, function(a, b)
        return a.Date > b.Date
    end)
    
    -- Create each update section
    for i, update in ipairs(sortedUpdates) do
        -- Date section container
        local dateSection = Instance.new("Frame")
        dateSection.Name = "DateSection_" .. update.Date
        dateSection.Size = UDim2.new(1, 0, 0, 0)
        dateSection.BackgroundTransparency = 1
        dateSection.AutomaticSize = Enum.AutomaticSize.Y
        dateSection.LayoutOrder = i
        dateSection.Parent = scrollFrame
        
        -- Date header with emoji indicator
        local dateContainer = Instance.new("Frame")
        dateContainer.Name = "DateContainer"
        dateContainer.Size = UDim2.new(1, 0, 0, 32)
        dateContainer.BackgroundTransparency = 1
        dateContainer.Parent = dateSection
        
        -- Date label with colored accent
        local dateLabel = Instance.new("TextLabel")
        dateLabel.Name = "DateLabel"
        dateLabel.Size = UDim2.new(1, -40, 1, 0)
        dateLabel.Position = UDim2.new(0, 40, 0, 0)
        dateLabel.BackgroundTransparency = 1
        dateLabel.Text = update.Date
        dateLabel.TextColor3 = Theme.Text
        dateLabel.TextSize = 14
        dateLabel.Font = Enum.Font.GothamBold
        dateLabel.TextXAlignment = Enum.TextXAlignment.Left
        dateLabel.Parent = dateContainer
        
        -- Calendar emoji
        local dateEmoji = Instance.new("TextLabel")
        dateEmoji.Name = "DateEmoji"
        dateEmoji.Size = UDim2.new(0, 30, 0, 30)
        dateEmoji.BackgroundTransparency = 1
        dateEmoji.Text = "ðŸ“…"
        dateEmoji.TextColor3 = Theme.Accent
        dateEmoji.TextSize = 16
        dateEmoji.Font = Enum.Font.Gotham
        dateEmoji.Parent = dateContainer
        
        -- Changes list container
        local changesFrame = Instance.new("Frame")
        changesFrame.Name = "ChangesFrame"
        changesFrame.Size = UDim2.new(1, -15, 0, 0)
        changesFrame.Position = UDim2.new(0, 15, 0, 40)
        changesFrame.BackgroundTransparency = 1
        changesFrame.AutomaticSize = Enum.AutomaticSize.Y
        changesFrame.Parent = dateSection
        
        local changesLayout = Instance.new("UIListLayout")
        changesLayout.Padding = UDim.new(0, 16)
        changesLayout.SortOrder = Enum.SortOrder.LayoutOrder
        changesLayout.Parent = changesFrame
        
        -- Add each change with emoji and color
        for _, change in ipairs(update.Changes) do
            local config = getTypeConfig(change.Type)
            
            local changeItem = Instance.new("Frame")
            changeItem.Name = "ChangeItem_" .. change.Title
            changeItem.Size = UDim2.new(1, 0, 0, 0)
            changeItem.BackgroundTransparency = 1
            changeItem.AutomaticSize = Enum.AutomaticSize.Y
            changeItem.LayoutOrder = _
            changeItem.Parent = changesFrame
            
            -- Emoji and title container
            local titleContainer = Instance.new("Frame")
            titleContainer.Name = "TitleContainer"
            titleContainer.Size = UDim2.new(1, 0, 0, 24)
            titleContainer.BackgroundTransparency = 1
            titleContainer.Parent = changeItem
            
            -- Type indicator (colored line)
            local typeIndicator = Instance.new("Frame")
            typeIndicator.Name = "TypeIndicator"
            typeIndicator.Size = UDim2.new(0, 3, 0, 20)
            typeIndicator.Position = UDim2.new(0, 0, 0, 2)
            typeIndicator.BackgroundColor3 = config.color
            typeIndicator.BackgroundTransparency = 0
            typeIndicator.BorderSizePixel = 0
            typeIndicator.Parent = titleContainer
            
            -- Emoji
            local typeEmoji = Instance.new("TextLabel")
            typeEmoji.Name = "TypeEmoji"
            typeEmoji.Size = UDim2.new(0, 24, 0, 24)
            typeEmoji.Position = UDim2.new(0, 10, 0, 0)
            typeEmoji.BackgroundTransparency = 1
            typeEmoji.Text = config.emoji
            typeEmoji.TextColor3 = config.color
            typeEmoji.TextSize = 14
            typeEmoji.Font = Enum.Font.Gotham
            typeEmoji.Parent = titleContainer
            
            -- Change title with color based on type
            local changeTitle = Instance.new("TextLabel")
            changeTitle.Name = "ChangeTitle"
            changeTitle.Size = UDim2.new(1, -40, 0, 24)
            changeTitle.Position = UDim2.new(0, 40, 0, 0)
            changeTitle.BackgroundTransparency = 1
            changeTitle.Text = change.Title
            changeTitle.TextColor3 = config.titleColor
            changeTitle.TextSize = 12
            changeTitle.Font = Enum.Font.GothamSemibold
            changeTitle.TextXAlignment = Enum.TextXAlignment.Left
            changeTitle.TextYAlignment = Enum.TextYAlignment.Center
            changeTitle.Parent = titleContainer
            
            -- Change description (optional)
            if change.Description and change.Description ~= "" then
                local changeDesc = Instance.new("TextLabel")
                changeDesc.Name = "ChangeDescription"
                changeDesc.Size = UDim2.new(1, -45, 0, 0)
                changeDesc.Position = UDim2.new(0, 45, 0, 24)
                changeDesc.BackgroundTransparency = 1
                changeDesc.Text = change.Description
                changeDesc.TextColor3 = Theme.TextSecondary
                changeDesc.TextSize = 11
                changeDesc.Font = Enum.Font.Gotham
                changeDesc.TextXAlignment = Enum.TextXAlignment.Left
                changeDesc.TextYAlignment = Enum.TextYAlignment.Top
                changeDesc.TextWrapped = true
                changeDesc.AutomaticSize = Enum.AutomaticSize.Y
                changeDesc.Parent = changeItem
                
                -- Auto-adjust height
                changeDesc:GetPropertyChangedSignal("TextBounds"):Connect(function()
                    changeItem.Size = UDim2.new(1, 0, 0, changeDesc.TextBounds.Y + 30)
                end)
            else
                changeItem.Size = UDim2.new(1, 0, 0, 24)
            end
        end
        
        -- Add separator line between date sections (except last one)
        if i < #sortedUpdates then
            local separator = Instance.new("Frame")
            separator.Name = "Separator"
            separator.Size = UDim2.new(1, -20, 0, 1)
            separator.Position = UDim2.new(0, 20, 1, 0)
            separator.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
            separator.BackgroundTransparency = 0.5
            separator.BorderSizePixel = 0
            separator.Parent = dateSection
        end
    end
    
    -- Return object with methods
    local historyObj = {}
    
    function historyObj:AddUpdate(newUpdate)
        table.insert(historyData.Updates, newUpdate)
        
        -- Simple refresh: destroy and recreate (or implement smarter refresh)
        scrollFrame:ClearAllChildren()
        
        -- Re-create the layout
        local layout = Instance.new("UIListLayout")
        layout.Padding = UDim.new(0, 28)
        layout.SortOrder = Enum.SortOrder.LayoutOrder
        layout.Parent = scrollFrame
        
        local padding = Instance.new("UIPadding")
        padding.PaddingLeft = UDim.new(0, 10)
        padding.PaddingRight = UDim.new(0, 10)
        padding.PaddingTop = UDim.new(0, 10)
        padding.PaddingBottom = UDim.new(0, 10)
        padding.Parent = scrollFrame
        
        -- Re-sort and recreate
        table.sort(sortedUpdates, function(a, b)
            return a.Date > b.Date
        end)
        
        for i, update in ipairs(sortedUpdates) do
            local dateSection = Instance.new("Frame")
            dateSection.Name = "DateSection_" .. update.Date
            dateSection.Size = UDim2.new(1, 0, 0, 0)
            dateSection.BackgroundTransparency = 1
            dateSection.AutomaticSize = Enum.AutomaticSize.Y
            dateSection.LayoutOrder = i
            dateSection.Parent = scrollFrame
            
            -- ... (same creation code as above, but this is simplified)
            -- In a real implementation, you'd reuse the creation logic
        end
    end
    
    function historyObj:GetInstance()
        return scrollFrame
    end
    
    return historyObj
end

-- Even simpler version with just emoji badges
function GuiLibrary:CreateBadgedUpdateHistory(tab, historyData)
    local scrollFrame = Instance.new("ScrollingFrame")
    scrollFrame.Name = "BadgedUpdateHistory"
    scrollFrame.Size = UDim2.new(1, 0, 0, 300)
    scrollFrame.BackgroundTransparency = 1
    scrollFrame.ScrollBarThickness = 4
    scrollFrame.ScrollBarImageColor3 = Theme.Accent
    scrollFrame.ScrollBarImageTransparency = 0.5
    scrollFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    scrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    scrollFrame.Parent = tab.Frame
    
    local layout = Instance.new("UIListLayout")
    layout.Padding = UDim.new(0, 20)
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Parent = scrollFrame
    
    local padding = Instance.new("UIPadding")
    padding.PaddingLeft = UDim.new(0, 10)
    padding.PaddingRight = UDim.new(0, 10)
    padding.PaddingTop = UDim.new(0, 10)
    padding.Parent = scrollFrame
    
    -- Type configurations with emoji and colors
    local typeStyles = {
        bug = { emoji = "ðŸž", color = Color3.fromRGB(220, 80, 80) },
        fix = { emoji = "âš™ï¸", color = Color3.fromRGB(220, 80, 80) },
        update = { emoji = "ðŸ†•", color = Color3.fromRGB(0, 150, 255) },
        improvement = { emoji = "âš¡", color = Color3.fromRGB(255, 165, 0) },
        feature = { emoji = "âœ¨", color = Color3.fromRGB(0, 200, 100) },
        security = { emoji = "ðŸ”’", color = Color3.fromRGB(150, 100, 255) },
        default = { emoji = "ðŸ“", color = Theme.TextSecondary }
    }
    
    -- Sort by date (newest first)
    local sortedUpdates = {}
    for _, update in ipairs(historyData.Updates) do
        table.insert(sortedUpdates, update)
    end
    
    table.sort(sortedUpdates, function(a, b)
        return a.Date > b.Date
    end)
    
    -- Create each update
    for i, update in ipairs(sortedUpdates) do
        -- Main container for this date
        local dateContainer = Instance.new("Frame")
        dateContainer.Name = "Date_" .. update.Date
        dateContainer.Size = UDim2.new(1, 0, 0, 0)
        dateContainer.BackgroundTransparency = 1
        dateContainer.AutomaticSize = Enum.AutomaticSize.Y
        dateContainer.LayoutOrder = i
        dateContainer.Parent = scrollFrame
        
        -- Date header
        local dateHeader = Instance.new("Frame")
        dateHeader.Name = "DateHeader"
        dateHeader.Size = UDim2.new(1, 0, 0, 28)
        dateHeader.BackgroundTransparency = 1
        dateHeader.Parent = dateContainer
        
        -- Date text
        local dateText = Instance.new("TextLabel")
        dateText.Name = "DateText"
        dateText.Size = UDim2.new(1, 0, 1, 0)
        dateText.BackgroundTransparency = 1
        dateText.Text = "ðŸ“… " .. update.Date
        dateText.TextColor3 = Theme.Text
        dateText.TextSize = 13
        dateText.Font = Enum.Font.GothamBold
        dateText.TextXAlignment = Enum.TextXAlignment.Left
        dateText.Parent = dateHeader
        
        -- Changes list
        local changesContainer = Instance.new("Frame")
        changesContainer.Name = "Changes"
        changesContainer.Size = UDim2.new(1, -10, 0, 0)
        changesContainer.Position = UDim2.new(0, 10, 0, 30)
        changesContainer.BackgroundTransparency = 1
        changesContainer.AutomaticSize = Enum.AutomaticSize.Y
        changesContainer.Parent = dateContainer
        
        local changesLayout = Instance.new("UIListLayout")
        changesLayout.Padding = UDim.new(0, 12)
        changesLayout.SortOrder = Enum.SortOrder.LayoutOrder
        changesLayout.Parent = changesContainer
        
        for _, change in ipairs(update.Changes) do
            local style = typeStyles[change.Type:lower()] or typeStyles.default
            
            local changeItem = Instance.new("Frame")
            changeItem.Name = "Change"
            changeItem.Size = UDim2.new(1, 0, 0, 0)
            changeItem.BackgroundTransparency = 1
            changeItem.AutomaticSize = Enum.AutomaticSize.Y
            changeItem.LayoutOrder = _
            changeItem.Parent = changesContainer
            
            -- Emoji badge
            local emojiBadge = Instance.new("Frame")
            emojiBadge.Name = "EmojiBadge"
            emojiBadge.Size = UDim2.new(0, 26, 0, 26)
            emojiBadge.BackgroundColor3 = style.color
            emojiBadge.BackgroundTransparency = 0.15
            emojiBadge.BorderSizePixel = 0
            emojiBadge.Parent = changeItem
            
            local badgeCorner = Instance.new("UICorner")
            badgeCorner.CornerRadius = UDim.new(0, 6)
            badgeCorner.Parent = emojiBadge
            
            local emojiText = Instance.new("TextLabel")
            emojiText.Name = "Emoji"
            emojiText.Size = UDim2.new(1, 0, 1, 0)
            emojiText.BackgroundTransparency = 1
            emojiText.Text = style.emoji
            emojiText.TextColor3 = Color3.fromRGB(255, 255, 255)
            emojiText.TextSize = 12
            emojiText.Font = Enum.Font.Gotham
            emojiText.Parent = emojiBadge
            
            -- Change content
            local contentFrame = Instance.new("Frame")
            contentFrame.Name = "Content"
            contentFrame.Size = UDim2.new(1, -35, 0, 0)
            contentFrame.Position = UDim2.new(0, 35, 0, 0)
            contentFrame.BackgroundTransparency = 1
            contentFrame.AutomaticSize = Enum.AutomaticSize.Y
            contentFrame.Parent = changeItem
            
            -- Title
            local titleText = Instance.new("TextLabel")
            titleText.Name = "Title"
            titleText.Size = UDim2.new(1, 0, 0, 20)
            titleText.BackgroundTransparency = 1
            titleText.Text = change.Title
            titleText.TextColor3 = style.color
            titleText.TextSize = 12
            titleText.Font = Enum.Font.GothamSemibold
            titleText.TextXAlignment = Enum.TextXAlignment.Left
            titleText.Parent = contentFrame
            
            -- Description
            if change.Description and change.Description ~= "" then
                local descText = Instance.new("TextLabel")
                descText.Name = "Description"
                descText.Size = UDim2.new(1, 0, 0, 0)
                descText.Position = UDim2.new(0, 0, 0, 20)
                descText.BackgroundTransparency = 1
                descText.Text = change.Description
                descText.TextColor3 = Theme.TextSecondary
                descText.TextSize = 11
                descText.Font = Enum.Font.Gotham
                descText.TextXAlignment = Enum.TextXAlignment.Left
                descText.TextYAlignment = Enum.TextYAlignment.Top
                descText.TextWrapped = true
                descText.AutomaticSize = Enum.AutomaticSize.Y
                descText.Parent = contentFrame
                
                -- Auto-size
                descText:GetPropertyChangedSignal("TextBounds"):Connect(function()
                    contentFrame.Size = UDim2.new(1, -35, 0, descText.TextBounds.Y + 25)
                    changeItem.Size = UDim2.new(1, 0, 0, math.max(26, descText.TextBounds.Y + 25))
                end)
            else
                changeItem.Size = UDim2.new(1, 0, 0, 26)
            end
        end
    end
    
    -- Return object
    local historyObj = {}
    
    function historyObj:AddUpdate(newUpdate)
        table.insert(historyData.Updates, newUpdate)
        -- Could implement refresh here
    end
    
    function historyObj:GetInstance()
        return scrollFrame
    end
    
    return historyObj
end

-- Add this function to your existing GuiLibrary
function GuiLibrary:UpdateHistoryBuilder(tab)
    local builder = {}
    local updates = {}
    
    function builder:Add(Date, Type, Title, Description)
        table.insert(updates, {
            Date = Date,
            Type = Type,
            Title = Title,
            Description = Description
        })
        return self
    end
    
    function builder:Build()
        -- Group by date
        local grouped = {}
        for _, update in ipairs(updates) do
            if not grouped[update.Date] then
                grouped[update.Date] = {}
            end
            table.insert(grouped[update.Date], {
                Type = update.Type,
                Title = update.Title,
                Description = update.Description
            })
        end
        
        -- Convert to final format
        local historyData = {Updates = {}}
        for date, changes in pairs(grouped) do
            table.insert(historyData.Updates, {
                Date = date,
                Changes = changes
            })
        end
        
        -- Sort
        table.sort(historyData.Updates, function(a, b)
            return a.Date > b.Date
        end)
        
        return GuiLibrary:CreateBadgedUpdateHistory(tab, historyData)
    end
    
    return builder
end


-- Welcome Panel Function (Gamer Style) - TAB VERSION - FIXED LAYOUT
function GuiLibrary:CreateWelcomePanelTab(tab, scriptInfo)
    -- Configuration with default values
    local config = {
        ScriptName = scriptInfo.ScriptName or "VOIDWARE SCRIPT",
        Version = scriptInfo.Version or "V2.1.0",
        Developer = scriptInfo.Developer or "Voidware Team",
        Discord = scriptInfo.Discord or "discord.gg/voidware",
        Description = scriptInfo.Description or "Advanced gaming utility with premium features",
        Features = scriptInfo.Features or {
            "Player ESP & Highlighting",
            "Auto-Farming Systems", 
            "Teleport & Navigation",
            "Premium Exclusive Features",
            "Regular Updates & Support"
        },
        ThemeColor = scriptInfo.ThemeColor or Theme.Accent,
        ShowCloseButton = scriptInfo.ShowCloseButton ~= false
    }
    
    -- Main container with proper layout
    local welcomeContainer = Instance.new("Frame")
    welcomeContainer.Name = "WelcomePanel"
    welcomeContainer.Size = UDim2.new(1, 0, 0, 0)
    welcomeContainer.BackgroundTransparency = 1
    welcomeContainer.AutomaticSize = Enum.AutomaticSize.Y
    welcomeContainer.Parent = tab.Frame
    
    -- Use UIListLayout for proper spacing
    local containerLayout = Instance.new("UIListLayout")
    containerLayout.Padding = UDim.new(0, 15)
    containerLayout.SortOrder = Enum.SortOrder.LayoutOrder
    containerLayout.Parent = welcomeContainer
    
    -- Header with gaming style
    local header = Instance.new("Frame")
    header.Name = "Header"
    header.Size = UDim2.new(1, 0, 0, 90)
    header.BackgroundColor3 = Theme.Secondary
    header.BackgroundTransparency = 0.7
    header.BorderSizePixel = 0
    header.LayoutOrder = 1
    header.Parent = welcomeContainer
    
    local headerCorner = Instance.new("UICorner")
    headerCorner.CornerRadius = UDim.new(0, 8)
    headerCorner.Parent = header
    
    -- Accent border
    local accentBorder = Instance.new("Frame")
    accentBorder.Name = "AccentBorder"
    accentBorder.Size = UDim2.new(1, 0, 0, 3)
    accentBorder.Position = UDim2.new(0, 0, 1, 0)
    accentBorder.BackgroundColor3 = config.ThemeColor
    accentBorder.BackgroundTransparency = 0.3
    accentBorder.BorderSizePixel = 0
    accentBorder.Parent = header
    
    -- Script title with gaming font
    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.Size = UDim2.new(1, -120, 0, 40)
    title.Position = UDim2.new(0, 15, 0, 10)
    title.BackgroundTransparency = 1
    title.Text = config.ScriptName
    title.TextColor3 = config.ThemeColor
    title.TextSize = 22
    title.Font = Enum.Font.GothamBlack
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.TextYAlignment = Enum.TextYAlignment.Center
    title.Parent = header
    
    -- Version badge (gaming style)
    local versionBadge = Instance.new("Frame")
    versionBadge.Name = "VersionBadge"
    versionBadge.Size = UDim2.new(0, 70, 0, 25)
    versionBadge.Position = UDim2.new(1, -85, 0, 10)
    versionBadge.BackgroundColor3 = config.ThemeColor
    versionBadge.BackgroundTransparency = 0.2
    versionBadge.BorderSizePixel = 0
    versionBadge.Parent = header
    
    local versionCorner = Instance.new("UICorner")
    versionCorner.CornerRadius = UDim.new(0, 6)
    versionCorner.Parent = versionBadge
    
    local versionText = Instance.new("TextLabel")
    versionText.Name = "VersionText"
    versionText.Size = UDim2.new(1, 0, 1, 0)
    versionText.BackgroundTransparency = 1
    versionText.Text = config.Version
    versionText.TextColor3 = Color3.fromRGB(255, 255, 255)
    versionText.TextSize = 12
    versionText.Font = Enum.Font.GothamBold
    versionText.Parent = versionBadge
    
    -- Developer info
    local developerLabel = Instance.new("TextLabel")
    developerLabel.Name = "DeveloperLabel"
    developerLabel.Size = UDim2.new(1, -30, 0, 20)
    developerLabel.Position = UDim2.new(0, 15, 0, 55)
    developerLabel.BackgroundTransparency = 1
    developerLabel.Text = "ðŸ‘‘ DEVELOPED BY: " .. config.Developer
    developerLabel.TextColor3 = Color3.fromRGB(200, 200, 220)
    developerLabel.TextSize = 12
    developerLabel.Font = Enum.Font.GothamBold
    developerLabel.TextXAlignment = Enum.TextXAlignment.Left
    developerLabel.Parent = header
    
    -- Welcome message section
    local welcomeSection = Instance.new("Frame")
    welcomeSection.Name = "WelcomeSection"
    welcomeSection.Size = UDim2.new(1, 0, 0, 0)
    welcomeSection.BackgroundTransparency = 1
    welcomeSection.AutomaticSize = Enum.AutomaticSize.Y
    welcomeSection.LayoutOrder = 2
    welcomeSection.Parent = welcomeContainer
    
    local welcomeTitle = Instance.new("TextLabel")
    welcomeTitle.Name = "WelcomeTitle"
    welcomeTitle.Size = UDim2.new(1, 0, 0, 25)
    welcomeTitle.BackgroundTransparency = 1
    welcomeTitle.Text = "ðŸŽ® WELCOME TO " .. string.upper(config.ScriptName:gsub(" SCRIPT", "")) .. " ðŸŽ®"
    welcomeTitle.TextColor3 = config.ThemeColor
    welcomeTitle.TextSize = 16
    welcomeTitle.Font = Enum.Font.GothamBold
    welcomeTitle.Parent = welcomeSection
    
    local welcomeMessage = Instance.new("TextLabel")
    welcomeMessage.Name = "WelcomeMessage"
    welcomeMessage.Size = UDim2.new(1, 0, 0, 0)
    welcomeMessage.Position = UDim2.new(0, 0, 0, 30)
    welcomeMessage.BackgroundTransparency = 1
    welcomeMessage.Text = config.Description
    welcomeMessage.TextColor3 = Color3.fromRGB(220, 220, 220)
    welcomeMessage.TextSize = 13
    welcomeMessage.Font = Enum.Font.Gotham
    welcomeMessage.TextWrapped = true
    welcomeMessage.AutomaticSize = Enum.AutomaticSize.Y
    welcomeMessage.Parent = welcomeSection
    
    -- Auto-size welcome section
    welcomeMessage:GetPropertyChangedSignal("TextBounds"):Connect(function()
        welcomeSection.Size = UDim2.new(1, 0, 0, welcomeMessage.TextBounds.Y + 35)
    end)
    
    -- Features section - SIMPLIFIED VERSION WITHOUT SCROLLING FRAME
    local featuresSection = Instance.new("Frame")
    featuresSection.Name = "FeaturesSection"
    featuresSection.Size = UDim2.new(1, 0, 0, 0)
    featuresSection.BackgroundTransparency = 1
    featuresSection.AutomaticSize = Enum.AutomaticSize.Y
    featuresSection.LayoutOrder = 3
    featuresSection.Parent = welcomeContainer
    
    local featuresTitle = Instance.new("TextLabel")
    featuresTitle.Name = "FeaturesTitle"
    featuresTitle.Size = UDim2.new(1, 0, 0, 25)
    featuresTitle.BackgroundTransparency = 1
    featuresTitle.Text = "âœ¨ FEATURE HIGHLIGHTS âœ¨"
    featuresTitle.TextColor3 = config.ThemeColor
    featuresTitle.TextSize = 16
    featuresTitle.Font = Enum.Font.GothamBold
    featuresTitle.Parent = featuresSection
    
    local featuresList = Instance.new("Frame")
    featuresList.Name = "FeaturesList"
    featuresList.Size = UDim2.new(1, 0, 0, 0)
    featuresList.Position = UDim2.new(0, 0, 0, 30)
    featuresList.BackgroundTransparency = 1
    featuresList.AutomaticSize = Enum.AutomaticSize.Y
    featuresList.Parent = featuresSection
    
    local featuresLayout = Instance.new("UIListLayout")
    featuresLayout.Padding = UDim.new(0, 8)
    featuresLayout.SortOrder = Enum.SortOrder.LayoutOrder
    featuresLayout.Parent = featuresList
    
    -- Add features with gaming-style icons
    for i, feature in ipairs(config.Features) do
        local featureItem = Instance.new("Frame")
        featureItem.Name = "Feature_" .. i
        featureItem.Size = UDim2.new(1, 0, 0, 35)
        featureItem.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
        featureItem.BackgroundTransparency = 0.6
        featureItem.BorderSizePixel = 0
        featureItem.LayoutOrder = i
        featureItem.Parent = featuresList
        
        local featureCorner = Instance.new("UICorner")
        featureCorner.CornerRadius = UDim.new(0, 6)
        featureCorner.Parent = featureItem
        
        -- Gaming icon
        local icon = Instance.new("TextLabel")
        icon.Name = "Icon"
        icon.Size = UDim2.new(0, 30, 0, 30)
        icon.Position = UDim2.new(0, 8, 0.5, -15)
        icon.BackgroundTransparency = 1
        icon.Text = "âœ“"
        icon.TextColor3 = Color3.fromRGB(0, 255, 100)
        icon.TextSize = 18
        icon.Font = Enum.Font.GothamBold
        icon.Parent = featureItem
        
        -- Feature text
        local featureText = Instance.new("TextLabel")
        featureText.Name = "FeatureText"
        featureText.Size = UDim2.new(1, -45, 1, 0)
        featureText.Position = UDim2.new(0, 40, 0, 0)
        featureText.BackgroundTransparency = 1
        featureText.Text = feature
        featureText.TextColor3 = Color3.fromRGB(240, 240, 240)
        featureText.TextSize = 12
        featureText.Font = Enum.Font.Gotham
        featureText.TextXAlignment = Enum.TextXAlignment.Left
        featureText.TextYAlignment = Enum.TextYAlignment.Center
        featureText.Parent = featureItem
        
        -- Hover effect
        featureItem.MouseEnter:Connect(function()
            if not isMobile then
                TweenService:Create(featureItem, TweenInfo.new(0.2), {
                    BackgroundTransparency = 0.4,
                    BackgroundColor3 = Color3.fromRGB(40, 40, 50)
                }):Play()
                TweenService:Create(icon, TweenInfo.new(0.2), {
                    TextColor3 = config.ThemeColor
                }):Play()
            end
        end)
        
        featureItem.MouseLeave:Connect(function()
            if not isMobile then
                TweenService:Create(featureItem, TweenInfo.new(0.2), {
                    BackgroundTransparency = 0.6,
                    BackgroundColor3 = Color3.fromRGB(30, 30, 40)
                }):Play()
                TweenService:Create(icon, TweenInfo.new(0.2), {
                    TextColor3 = Color3.fromRGB(0, 255, 100)
                }):Play()
            end
        end)
    end
    
    -- Auto-size features section
    featuresLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        featuresList.Size = UDim2.new(1, 0, 0, featuresLayout.AbsoluteContentSize.Y)
        featuresSection.Size = UDim2.new(1, 0, 0, featuresLayout.AbsoluteContentSize.Y + 35)
    end)
    
    -- Discord section - SIMPLIFIED
    local discordSection = Instance.new("Frame")
    discordSection.Name = "DiscordSection"
    discordSection.Size = UDim2.new(1, 0, 0, 70)
    discordSection.BackgroundTransparency = 1
    discordSection.LayoutOrder = 4
    discordSection.Parent = welcomeContainer
    
    local discordTitle = Instance.new("TextLabel")
    discordTitle.Name = "DiscordTitle"
    discordTitle.Size = UDim2.new(1, 0, 0, 25)
    discordTitle.BackgroundTransparency = 1
    discordTitle.Text = "ðŸ’¬ JOIN OUR COMMUNITY ðŸ’¬"
    discordTitle.TextColor3 = Color3.fromRGB(88, 101, 242) -- Discord blue
    discordTitle.TextSize = 14
    discordTitle.Font = Enum.Font.GothamBold
    discordTitle.Parent = discordSection
    
    local discordButton = Instance.new("TextButton")
    discordButton.Name = "DiscordButton"
    discordButton.Size = UDim2.new(1, 0, 0, 40)
    discordButton.Position = UDim2.new(0, 0, 0, 30)
    discordButton.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
    discordButton.BackgroundTransparency = 0.2
    discordButton.BorderSizePixel = 0
    discordButton.Text = "Discord: " .. config.Discord
    discordButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    discordButton.TextSize = 13
    discordButton.Font = Enum.Font.Gotham
    discordButton.Parent = discordSection
    
    local discordCorner = Instance.new("UICorner")
    discordCorner.CornerRadius = UDim.new(0, 6)
    discordCorner.Parent = discordButton
    
    -- Discord icon
    local discordIcon = Instance.new("TextLabel")
    discordIcon.Name = "DiscordIcon"
    discordIcon.Size = UDim2.new(0, 30, 0, 30)
    discordIcon.Position = UDim2.new(0, 10, 0.5, -15)
    discordIcon.BackgroundTransparency = 1
    discordIcon.Text = "ðŸ’¬"
    discordIcon.TextColor3 = Color3.fromRGB(255, 255, 255)
    discordIcon.TextSize = 16
    discordIcon.Font = Enum.Font.Gotham
    discordIcon.Parent = discordButton
    
    -- Support/Help section - SIMPLIFIED
    local supportSection = Instance.new("Frame")
    supportSection.Name = "SupportSection"
    supportSection.Size = UDim2.new(1, 0, 0, 70)
    supportSection.BackgroundTransparency = 1
    supportSection.LayoutOrder = 5
    supportSection.Parent = welcomeContainer
    
    local supportTitle = Instance.new("TextLabel")
    supportTitle.Name = "SupportTitle"
    supportTitle.Size = UDim2.new(1, 0, 0, 25)
    supportTitle.BackgroundTransparency = 1
    supportTitle.Text = "ðŸ› ï¸ GET SUPPORT & HELP ðŸ› ï¸"
    supportTitle.TextColor3 = Color3.fromRGB(255, 165, 0)
    supportTitle.TextSize = 14
    supportTitle.Font = Enum.Font.GothamBold
    supportTitle.Parent = supportSection
    
    local helpButton = Instance.new("TextButton")
    helpButton.Name = "HelpButton"
    helpButton.Size = UDim2.new(1, 0, 0, 40)
    helpButton.Position = UDim2.new(0, 0, 0, 30)
    helpButton.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
    helpButton.BackgroundTransparency = 0.3
    helpButton.BorderSizePixel = 0
    helpButton.Text = "Need help? Click for support options"
    helpButton.TextColor3 = Color3.fromRGB(220, 220, 220)
    helpButton.TextSize = 12
    helpButton.Font = Enum.Font.Gotham
    helpButton.Parent = supportSection
    
    local helpCorner = Instance.new("UICorner")
    helpCorner.CornerRadius = UDim.new(0, 6)
    helpCorner.Parent = helpButton
    
    -- Help icon
    local helpIcon = Instance.new("TextLabel")
    helpIcon.Name = "HelpIcon"
    helpIcon.Size = UDim2.new(0, 30, 0, 30)
    helpIcon.Position = UDim2.new(0, 10, 0.5, -15)
    helpIcon.BackgroundTransparency = 1
    helpIcon.Text = "â“"
    helpIcon.TextColor3 = Color3.fromRGB(255, 255, 255)
    helpIcon.TextSize = 16
    helpIcon.Font = Enum.Font.Gotham
    helpIcon.Parent = helpButton
    
    -- Button hover effects
    local function setupTabButton(button, defaultColor, hoverColor)
        button.MouseEnter:Connect(function()
            if not isMobile then
                TweenService:Create(button, TweenInfo.new(0.2), {
                    BackgroundColor3 = hoverColor,
                    BackgroundTransparency = 0.1
                }):Play()
            end
        end)
        
        button.MouseLeave:Connect(function()
            if not isMobile then
                TweenService:Create(button, TweenInfo.new(0.2), {
                    BackgroundColor3 = defaultColor,
                    BackgroundTransparency = 0.2
                }):Play()
            end
        end)
    end
    
    -- Setup button effects
    setupTabButton(discordButton, 
        Color3.fromRGB(88, 101, 242), 
        Color3.fromRGB(108, 121, 262))
    
    setupTabButton(helpButton,
        Color3.fromRGB(60, 60, 70),
        Color3.fromRGB(80, 80, 90))
    
    -- Button functionality
    discordButton.MouseButton1Click:Connect(function()
        self:CopyToClipboard(config.Discord)
        self:ShowNotification("ðŸ“‹ Discord link copied to clipboard!", 3)
        
        -- Visual feedback
        discordButton.Text = "âœ“ COPIED TO CLIPBOARD!"
        delay(2, function()
            if discordButton then
                discordButton.Text = "Discord: " .. config.Discord
            end
        end)
    end)
    
    helpButton.MouseButton1Click:Connect(function()
        self:ShowNotification("ðŸ“ž Support options:\n1. Join our Discord for help\n2. Check documentation\n3. Report bugs in #support", 5)
        
        -- Show help options in a simple way
        local options = {
            "Join Discord for support",
            "Check FAQ in documentation",
            "Report bugs/issues",
            "Request features"
        }
        
        -- Create simple help popup
        local helpPopup = Instance.new("ScreenGui")
        helpPopup.Name = "HelpPopup"
        helpPopup.Parent = playerGui
        
        local helpFrame = Instance.new("Frame")
        helpFrame.Size = UDim2.new(0, 300, 0, 200)
        helpFrame.Position = UDim2.new(0.5, -150, 0.5, -100)
        helpFrame.BackgroundColor3 = Theme.Background
        helpFrame.BackgroundTransparency = 0.1
        helpFrame.BorderSizePixel = 0
        helpFrame.Parent = helpPopup
        
        local helpCorner = Instance.new("UICorner")
        helpCorner.CornerRadius = UDim.new(0, 8)
        helpCorner.Parent = helpFrame
        
        local helpTitle = Instance.new("TextLabel")
        helpTitle.Size = UDim2.new(1, -20, 0, 40)
        helpTitle.Position = UDim2.new(0, 10, 0, 10)
        helpTitle.BackgroundTransparency = 1
        helpTitle.Text = "ðŸ› ï¸ SUPPORT OPTIONS"
        helpTitle.TextColor3 = Color3.fromRGB(255, 165, 0)
        helpTitle.TextSize = 16
        helpTitle.Font = Enum.Font.GothamBold
        helpTitle.Parent = helpFrame
        
        for i, option in ipairs(options) do
            local optionLabel = Instance.new("TextLabel")
            optionLabel.Size = UDim2.new(1, -40, 0, 25)
            optionLabel.Position = UDim2.new(0, 20, 0, 50 + (i * 25))
            optionLabel.BackgroundTransparency = 1
            optionLabel.Text = i .. ". " .. option
            optionLabel.TextColor3 = Theme.Text
            optionLabel.TextSize = 12
            optionLabel.Font = Enum.Font.Gotham
            optionLabel.TextXAlignment = Enum.TextXAlignment.Left
            optionLabel.Parent = helpFrame
        end
        
        local closeHelp = Instance.new("TextButton")
        closeHelp.Size = UDim2.new(0, 120, 0, 30)
        closeHelp.Position = UDim2.new(0.5, -60, 1, -40)
        closeHelp.BackgroundColor3 = Theme.Accent
        closeHelp.BackgroundTransparency = 0.2
        closeHelp.Text = "CLOSE"
        closeHelp.TextColor3 = Theme.Text
        closeHelp.TextSize = 12
        closeHelp.Font = Enum.Font.GothamBold
        closeHelp.Parent = helpFrame
        
        local closeCorner = Instance.new("UICorner")
        closeCorner.CornerRadius = UDim.new(0, 6)
        closeCorner.Parent = closeHelp
        
        closeHelp.MouseButton1Click:Connect(function()
            helpPopup:Destroy()
        end)
        
        setupTabButton(closeHelp, Theme.Accent, Color3.fromRGB(
            math.min(Theme.Accent.R * 255 + 30, 255),
            math.min(Theme.Accent.G * 255 + 30, 255),
            math.min(Theme.Accent.B * 255 + 30, 255)
        ))
        
        -- Auto-close after 10 seconds
        delay(10, function()
            if helpPopup and helpPopup.Parent then
                helpPopup:Destroy()
            end
        end)
    end)
    
    -- Return panel object with controls
    local panelObj = {}
    
    function panelObj:UpdateConfig(newConfig)
        for key, value in pairs(newConfig) do
            config[key] = value
        end
        
        -- Update UI elements
        if title then title.Text = config.ScriptName end
        if versionText then versionText.Text = config.Version end
        if developerLabel then developerLabel.Text = "ðŸ‘‘ DEVELOPED BY: " .. config.Developer end
        if welcomeMessage then welcomeMessage.Text = config.Description end
        if discordButton then discordButton.Text = "Discord: " .. config.Discord end
        
        -- Update colors
        if accentBorder then accentBorder.BackgroundColor3 = config.ThemeColor end
        if title then title.TextColor3 = config.ThemeColor end
        if versionBadge then versionBadge.BackgroundColor3 = config.ThemeColor end
        if welcomeTitle then welcomeTitle.TextColor3 = config.ThemeColor end
        if featuresTitle then featuresTitle.TextColor3 = config.ThemeColor end
        
        -- Update features list
        if featuresList then
            featuresList:ClearAllChildren()
            
            local featuresLayout = Instance.new("UIListLayout")
            featuresLayout.Padding = UDim.new(0, 8)
            featuresLayout.SortOrder = Enum.SortOrder.LayoutOrder
            featuresLayout.Parent = featuresList
            
            for i, feature in ipairs(config.Features) do
                local featureItem = Instance.new("Frame")
                featureItem.Name = "Feature_" .. i
                featureItem.Size = UDim2.new(1, 0, 0, 35)
                featureItem.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
                featureItem.BackgroundTransparency = 0.6
                featureItem.BorderSizePixel = 0
                featureItem.LayoutOrder = i
                featureItem.Parent = featuresList
                
                local featureCorner = Instance.new("UICorner")
                featureCorner.CornerRadius = UDim.new(0, 6)
                featureCorner.Parent = featureItem
                
                local icon = Instance.new("TextLabel")
                icon.Name = "Icon"
                icon.Size = UDim2.new(0, 30, 0, 30)
                icon.Position = UDim2.new(0, 8, 0.5, -15)
                icon.BackgroundTransparency = 1
                icon.Text = "âœ“"
                icon.TextColor3 = Color3.fromRGB(0, 255, 100)
                icon.TextSize = 18
                icon.Font = Enum.Font.GothamBold
                icon.Parent = featureItem
                
                local featureText = Instance.new("TextLabel")
                featureText.Name = "FeatureText"
                featureText.Size = UDim2.new(1, -45, 1, 0)
                featureText.Position = UDim2.new(0, 40, 0, 0)
                featureText.BackgroundTransparency = 1
                featureText.Text = feature
                featureText.TextColor3 = Color3.fromRGB(240, 240, 240)
                featureText.TextSize = 12
                featureText.Font = Enum.Font.Gotham
                featureText.TextXAlignment = Enum.TextXAlignment.Left
                featureText.TextYAlignment = Enum.TextYAlignment.Center
                featureText.Parent = featureItem
            end
        end
    end
    
    function panelObj:GetConfig()
        return config
    end
    
    function panelObj:GetInstance()
        return welcomeContainer
    end
    
    function panelObj:Destroy()
        if welcomeContainer then
            welcomeContainer:Destroy()
        end
    end
    
    return panelObj
end




-- Player Marker Group (Voidware Style) with Premium Support
-- Shows all players in a list with Mark buttons, marked players get ESP with green lines
function GuiLibrary:CreatePlayerMarkerGroup(tab, groupName, settings, callback, isPremium)
    local groupFrame = Instance.new("Frame")
    groupFrame.Name = "PlayerMarkerGroup_" .. groupName
    groupFrame.Size = UDim2.new(1, 0, 0, 200) -- Initial height, will auto-size
    groupFrame.BackgroundTransparency = 1
    groupFrame.AutomaticSize = Enum.AutomaticSize.Y
    groupFrame.Parent = tab.Frame
    
    -- Main container with professional styling
    local container = Instance.new("Frame")
    container.Name = "Container"
    container.Size = UDim2.new(1, 0, 1, 0)
    container.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
    container.BackgroundTransparency = 0.1
    container.BorderSizePixel = 0
    container.Parent = groupFrame
    
    local containerCorner = Instance.new("UICorner")
    containerCorner.CornerRadius = UDim.new(0, 8)
    containerCorner.Parent = container
    
    -- Border for depth
    local border = Instance.new("Frame")
    border.Name = "Border"
    border.Size = UDim2.new(1, 0, 1, 0)
    border.BackgroundTransparency = 1
    border.BorderColor3 = Color3.fromRGB(45, 45, 50)
    border.BorderSizePixel = 1
    border.Parent = container
    
    local borderCorner = Instance.new("UICorner")
    borderCorner.CornerRadius = UDim.new(0, 8)
    borderCorner.Parent = border
    
    -- Header
    local header = Instance.new("Frame")
    header.Name = "Header"
    header.Size = UDim2.new(1, 0, 0, 28)
    header.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
    header.BackgroundTransparency = 0.1
    header.BorderSizePixel = 0
    header.Parent = container
    
    local headerCorner = Instance.new("UICorner")
    headerCorner.CornerRadius = UDim.new(0, 8)
    headerCorner.Parent = header
    
    -- Header mask for top corners
    local headerMask = Instance.new("Frame")
    headerMask.Name = "HeaderMask"
    headerMask.Size = UDim2.new(1, 0, 1, 8)
    headerMask.Position = UDim2.new(0, 0, 0, 0)
    headerMask.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
    headerMask.BorderSizePixel = 0
    headerMask.Parent = header
    
    -- Group title
    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.Size = UDim2.new(1, -120, 1, 0)
    title.Position = UDim2.new(0, 10, 0, 0)
    title.BackgroundTransparency = 1
    title.Text = groupName
    title.TextColor3 = Color3.fromRGB(220, 220, 220)
    title.TextSize = 12
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Font = Enum.Font.GothamSemibold
    title.Parent = header
    
    -- Stats label
    local statsLabel = Instance.new("TextLabel")
    statsLabel.Name = "Stats"
    statsLabel.Size = UDim2.new(0, 100, 1, 0)
    statsLabel.Position = UDim2.new(1, -110, 0, 0)
    statsLabel.BackgroundTransparency = 1
    statsLabel.Text = "0/0 marked"
    statsLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    statsLabel.TextSize = 10
    statsLabel.TextXAlignment = Enum.TextXAlignment.Right
    title.Font = Enum.Font.Gotham
    statsLabel.Parent = header
    
    -- Accent line
    local accentLine = Instance.new("Frame")
    accentLine.Name = "AccentLine"
    accentLine.Size = UDim2.new(1, 0, 0, 1)
    accentLine.Position = UDim2.new(0, 0, 1, 0)
    accentLine.BackgroundColor3 = Color3.fromRGB(0, 200, 100) -- Green accent
    accentLine.BackgroundTransparency = 0.3
    accentLine.BorderSizePixel = 0
    accentLine.Parent = header
    
    -- Players list container
    local playersList = Instance.new("ScrollingFrame")
    playersList.Name = "PlayersList"
    playersList.Size = UDim2.new(1, -16, 1, -44)
    playersList.Position = UDim2.new(0, 8, 0, 36)
    playersList.BackgroundTransparency = 1
    playersList.BorderSizePixel = 0
    playersList.ScrollBarThickness = 3
    playersList.ScrollBarImageColor3 = Color3.fromRGB(0, 200, 100) -- Green scrollbar
    playersList.ScrollBarImageTransparency = 0.5
    playersList.AutomaticCanvasSize = Enum.AutomaticSize.Y
    playersList.CanvasSize = UDim2.new(0, 0, 0, 0)
    playersList.Parent = container
    
    local listLayout = Instance.new("UIListLayout")
    listLayout.Padding = UDim.new(0, 6)
    listLayout.SortOrder = Enum.SortOrder.LayoutOrder
    listLayout.Parent = playersList
    
    local listPadding = Instance.new("UIPadding")
    listPadding.PaddingTop = UDim.new(0, 8)
    listPadding.PaddingLeft = UDim.new(0, 4)
    listPadding.PaddingRight = UDim.new(0, 4)
    listPadding.Parent = playersList
    
    -- Default settings
    local defaultSettings = {
        maxDistance = settings and settings.maxDistance or 5000,
        lineColor = settings and settings.lineColor or Color3.fromRGB(0, 255, 0), -- Green
        lineThickness = settings and settings.lineThickness or 1,
        showDistance = settings and settings.showDistance or true,
        refreshRate = settings and settings.refreshRate or 0.1,
        showName = settings and settings.showName or true,
        showHealth = settings and settings.showHealth or true,
        teamCheck = settings and settings.teamCheck or false
    }
    
    -- Storage
    local markedPlayers = {} -- {player = markedPosition}
    local espObjects = {} -- {player = {line, billboard, etc}}
    local playerEntries = {} -- UI entries
    local isActive = false
    
    -- Mark as premium if required
    local premiumLock
    if isPremium and not IsPremium then
        premiumLock = self:MarkAsPremium(groupFrame, "PREMIUM")
        callback = function() end
    end
    
    -- Toggle button
    local toggleButton = Instance.new("TextButton")
    toggleButton.Name = "ToggleButton"
    toggleButton.Size = UDim2.new(0, 60, 0, 20)
    toggleButton.Position = UDim2.new(1, -75, 0.5, -10)
    toggleButton.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
    toggleButton.BackgroundTransparency = 0.3
    toggleButton.BorderSizePixel = 0
    toggleButton.Text = "OFF"
    toggleButton.TextColor3 = Color3.fromRGB(180, 180, 180)
    toggleButton.TextSize = 10
    toggleButton.Font = Enum.Font.GothamMedium
    toggleButton.Parent = header
    
    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(0, 4)
    toggleCorner.Parent = toggleButton
    
    -- Function to update stats
    local function updateStats()
        local totalPlayers = #Players:GetPlayers() - 1 -- Exclude local player
        local markedCount = 0
        for _ in pairs(markedPlayers) do
            markedCount = markedCount + 1
        end
        statsLabel.Text = markedCount .. "/" .. totalPlayers .. " marked"
    end
    
    -- Function to create ESP for marked player
    local function createESPForPlayer(player)
        if not player or player == Players.LocalPlayer then return end
        
        local espFolder = Instance.new("Folder")
        espFolder.Name = player.Name .. "_MarkerESP"
        espFolder.Parent = workspace
        
        espObjects[player] = espFolder
        
        local connection = RunService.RenderStepped:Connect(function()
            if not isActive or not markedPlayers[player] or not player.Character then
                return
            end
            
            local character = player.Character
            local humanoid = character:FindFirstChild("Humanoid")
            local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
            
            if not humanoid or not humanoidRootPart then return end
            
            -- Distance check
            local localChar = Players.LocalPlayer.Character
            local localRoot = localChar and localChar:FindFirstChild("HumanoidRootPart")
            
            if not localRoot then return end
            
            local distance = (humanoidRootPart.Position - localRoot.Position).Magnitude
            
            if distance > defaultSettings.maxDistance then
                for _, obj in pairs(espFolder:GetChildren()) do
                    obj.Visible = false
                end
                return
            end
            
            -- Create green line from player to marked position
            local line = espFolder:FindFirstChild("Line")
            if not line then
                line = Instance.new("LineHandleAdornment")
                line.Name = "Line"
                line.Adornee = workspace.Terrain or workspace
                line.AlwaysOnTop = true
                line.ZIndex = 5
                line.Thickness = defaultSettings.lineThickness
                line.Transparency = 0.7
                line.Color3 = defaultSettings.lineColor
                line.Parent = espFolder
            end
            
            -- Update line to connect player to marked position
            line.Visible = true
            line.Length = (markedPlayers[player] - humanoidRootPart.Position).Magnitude
            line.CFrame = CFrame.new(humanoidRootPart.Position, markedPlayers[player])
            
            -- Create billboard with info
            if defaultSettings.showName or defaultSettings.showDistance or defaultSettings.showHealth then
                local billboard = espFolder:FindFirstChild("Billboard")
                if not billboard then
                    billboard = Instance.new("BillboardGui")
                    billboard.Name = "Billboard"
                    billboard.Adornee = humanoidRootPart
                    billboard.AlwaysOnTop = true
                    billboard.Size = UDim2.new(0, 200, 0, 80)
                    billboard.StudsOffset = Vector3.new(0, 4, 0)
                    billboard.Parent = espFolder
                    
                    local textLabel = Instance.new("TextLabel")
                    textLabel.Name = "Text"
                    textLabel.Size = UDim2.new(1, 0, 1, 0)
                    textLabel.BackgroundTransparency = 1
                    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
                    textLabel.TextSize = 14
                    textLabel.Font = Enum.Font.GothamBold
                    textLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
                    textLabel.TextStrokeTransparency = 0.5
                    textLabel.Parent = billboard
                end
                
                -- Update text
                local text = ""
                if defaultSettings.showName then
                    text = text .. player.Name .. "\n"
                end
                if defaultSettings.showDistance then
                    text = text .. string.format("Dist: %.0f\n", distance)
                end
                if defaultSettings.showHealth and humanoid then
                    text = text .. string.format("HP: %.0f/%.0f", humanoid.Health, humanoid.MaxHealth)
                end
                
                billboard:FindFirstChild("Text").Text = text
                billboard.Enabled = true
            else
                local billboard = espFolder:FindFirstChild("Billboard")
                if billboard then billboard.Enabled = false end
            end
            
            -- Create marker indicator at marked position
            local marker = espFolder:FindFirstChild("Marker")
            if not marker then
                marker = Instance.new("Part")
                marker.Name = "Marker"
                marker.Size = Vector3.new(2, 2, 2)
                marker.Anchored = true
                marker.CanCollide = false
                marker.Transparency = 0.7
                marker.Material = Enum.Material.Neon
                marker.Color = defaultSettings.lineColor
                marker.Parent = espFolder
                
                -- Add sparkles effect
                local sparkles = Instance.new("Sparkles")
                sparkles.SparkleColor = defaultSettings.lineColor
                sparkles.Parent = marker
            end
            
            marker.Position = markedPlayers[player]
            marker.Visible = true
        end)
        
        table.insert(espObjects, connection)
    end
    
    -- Function to remove ESP for player
    local function removeESPForPlayer(player)
        if espObjects[player] then
            for _, obj in pairs(espObjects[player]:GetChildren()) do
                if obj:IsA("LineHandleAdornment") or obj:IsA("BillboardGui") or obj:IsA("Part") then
                    obj:Destroy()
                end
            end
            espObjects[player]:Destroy()
            espObjects[player] = nil
        end
    end
    
    -- Function to start ESP for all marked players
    local function startESP()
        isActive = true
        toggleButton.Text = "ON"
        toggleButton.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
        
        for player, position in pairs(markedPlayers) do
            createESPForPlayer(player)
        end
    end
    
    -- Function to stop ESP
    local function stopESP()
        isActive = false
        toggleButton.Text = "OFF"
        toggleButton.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
        
        for player, _ in pairs(markedPlayers) do
            removeESPForPlayer(player)
        end
    end
    
    -- Function to mark player
    local function markPlayer(player)
        if isPremium and not IsPremium then return end
        if not player.Character then return end
        
        local humanoidRootPart = player.Character:FindFirstChild("HumanoidRootPart")
        if not humanoidRootPart then return end
        
        markedPlayers[player] = humanoidRootPart.Position
        
        -- Update UI entry
        if playerEntries[player] then
            local entry = playerEntries[player]
            entry.MarkButton.Text = "MARKED âœ“"
            entry.MarkButton.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
            entry.StatusIndicator.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
        end
        
        -- Start ESP if active
        if isActive then
            createESPForPlayer(player)
        end
        
        updateStats()
        
        if callback then
            callback("marked", player, markedPlayers[player])
        end
    end
    
    -- Function to unmark player
    local function unmarkPlayer(player)
        if isPremium and not IsPremium then return end
        
        markedPlayers[player] = nil
        
        -- Update UI entry
        if playerEntries[player] then
            local entry = playerEntries[player]
            entry.MarkButton.Text = "MARK"
            entry.MarkButton.BackgroundColor3 = Theme.Accent
            entry.StatusIndicator.BackgroundColor3 = Color3.fromRGB(150, 150, 150)
        end
        
        -- Remove ESP
        removeESPForPlayer(player)
        
        updateStats()
        
        if callback then
            callback("unmarked", player)
        end
    end
    
    -- Function to create player entry
    local function createPlayerEntry(player)
        if player == Players.LocalPlayer then return end
        
        local entryFrame = Instance.new("Frame")
        entryFrame.Name = "Entry_" .. player.UserId
        entryFrame.Size = UDim2.new(1, 0, 0, 35)
        entryFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
        entryFrame.BackgroundTransparency = 0.2
        entryFrame.BorderSizePixel = 0
        entryFrame.LayoutOrder = player.UserId
        entryFrame.Parent = playersList
        
        local entryCorner = Instance.new("UICorner")
        entryCorner.CornerRadius = UDim.new(0, 6)
        entryCorner.Parent = entryFrame
        
        -- Player info
        local infoLabel = Instance.new("TextLabel")
        infoLabel.Name = "Info"
        infoLabel.Size = UDim2.new(0.6, -10, 1, 0)
        infoLabel.Position = UDim2.new(0, 10, 0, 0)
        infoLabel.BackgroundTransparency = 1
        infoLabel.Text = player.Name .. (player.DisplayName ~= player.Name and "\n[@" .. player.DisplayName .. "]" or "")
        infoLabel.TextColor3 = Theme.Text
        infoLabel.TextSize = 11
        infoLabel.TextXAlignment = Enum.TextXAlignment.Left
        infoLabel.Font = Enum.Font.Gotham
        infoLabel.Parent = entryFrame
        
        -- Status indicator
        local statusIndicator = Instance.new("Frame")
        statusIndicator.Name = "StatusIndicator"
        statusIndicator.Size = UDim2.new(0, 6, 0, 6)
        statusIndicator.Position = UDim2.new(0.6, 5, 0.5, -3)
        statusIndicator.BackgroundColor3 = Color3.fromRGB(150, 150, 150)
        statusIndicator.BorderSizePixel = 0
        statusIndicator.Parent = entryFrame
        
        local statusCorner = Instance.new("UICorner")
        statusCorner.CornerRadius = UDim.new(1, 0)
        statusCorner.Parent = statusIndicator
        
        -- Mark button
        local markButton = Instance.new("TextButton")
        markButton.Name = "MarkButton"
        markButton.Size = UDim2.new(0.3, -5, 0, 25)
        markButton.Position = UDim2.new(0.7, 5, 0.5, -12.5)
        markButton.BackgroundColor3 = Theme.Accent
        markButton.BackgroundTransparency = 0.2
        markButton.BorderSizePixel = 0
        markButton.Text = "MARK"
        markButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        markButton.TextSize = 10
        markButton.Font = Enum.Font.GothamBold
        markButton.Parent = entryFrame
        
        local markCorner = Instance.new("UICorner")
        markCorner.CornerRadius = UDim.new(0, 4)
        markCorner.Parent = markButton
        
        -- Check if player is already marked
        if markedPlayers[player] then
            markButton.Text = "MARKED âœ“"
            markButton.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
            statusIndicator.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
        end
        
        -- Button click handler
        markButton.MouseButton1Click:Connect(function()
            if isPremium and not IsPremium then return end
            
            if markedPlayers[player] then
                unmarkPlayer(player)
            else
                markPlayer(player)
            end
        end)
        
        -- Button hover effects
        markButton.MouseEnter:Connect(function()
            if not isMobile then
                TweenService:Create(markButton, TweenInfo.new(0.1), {BackgroundTransparency = 0.1}):Play()
            end
        end)
        
        markButton.MouseLeave:Connect(function()
            if not isMobile then
                TweenService:Create(markButton, TweenInfo.new(0.1), {
                    BackgroundTransparency = markedPlayers[player] and 0.1 or 0.2
                }):Play()
            end
        end)
        
        -- Store entry reference
        playerEntries[player] = {
            Frame = entryFrame,
            MarkButton = markButton,
            StatusIndicator = statusIndicator
        }
    end
    
    -- Function to refresh player list
    local function refreshPlayerList()
        -- Clear existing entries
        for _, entry in pairs(playerEntries) do
            entry.Frame:Destroy()
        end
        playerEntries = {}
        
        -- Get all players except local
        local players = Players:GetPlayers()
        table.sort(players, function(a, b)
            return a.Name:lower() < b.Name:lower()
        end)
        
        -- Create entries
        for _, player in ipairs(players) do
            if player ~= Players.LocalPlayer then
                createPlayerEntry(player)
            end
        end
        
        updateStats()
    end
    
    -- Toggle button click
    toggleButton.MouseButton1Click:Connect(function()
        if isPremium and not IsPremium then return end
        
        if isActive then
            stopESP()
        else
            startESP()
        end
    end)
    
    -- Button hover effects for toggle
    toggleButton.MouseEnter:Connect(function()
        if not isMobile then
            TweenService:Create(toggleButton, TweenInfo.new(0.1), {BackgroundTransparency = 0.2}):Play()
        end
    end)
    
    toggleButton.MouseLeave:Connect(function()
        if not isMobile then
            TweenService:Create(toggleButton, TweenInfo.new(0.1), {BackgroundTransparency = 0.3}):Play()
        end
    end)
    
    -- Initial refresh
    refreshPlayerList()
    
    -- Auto-refresh on player join/leave
    Players.PlayerAdded:Connect(function(player)
        wait(1)
        refreshPlayerList()
    end)
    
    Players.PlayerRemoving:Connect(function(player)
        if markedPlayers[player] then
            unmarkPlayer(player)
        end
        refreshPlayerList()
    end)
    
    -- Create group object with methods
    local groupObj = {
        Instance = groupFrame,
        PremiumLock = premiumLock
    }
    
    function groupObj:GetMarkedPlayers()
        local result = {}
        for player, position in pairs(markedPlayers) do
            table.insert(result, {
                player = player,
                position = position
            })
        end
        return result
    end
    
    function groupObj:MarkPlayer(player)
        if typeof(player) == "Instance" and player:IsA("Player") then
            markPlayer(player)
        end
    end
    
    function groupObj:UnmarkPlayer(player)
        if typeof(player) == "Instance" and player:IsA("Player") then
            unmarkPlayer(player)
        end
    end
    
    function groupObj:IsPlayerMarked(player)
        return markedPlayers[player] ~= nil
    end
    
    function groupObj:GetPlayerPosition(player)
        return markedPlayers[player]
    end
    
    function groupObj:StartESP()
        if isPremium and not IsPremium then return end
        startESP()
    end
    
    function groupObj:StopESP()
        stopESP()
    end
    
    function groupObj:IsESPActive()
        return isActive
    end
    
    function groupObj:ClearAll()
        for player, _ in pairs(markedPlayers) do
            unmarkPlayer(player)
        end
    end
    
    function groupObj:Refresh()
        refreshPlayerList()
    end
    
    function groupObj:GetSettings()
        return defaultSettings
    end
    
    function groupObj:UpdateSetting(settingName, value)
        if defaultSettings[settingName] ~= nil then
            defaultSettings[settingName] = value
            
            -- Refresh ESP if active
            if isActive then
                stopESP()
                startESP()
            end
        end
    end
    
    function groupObj:SetPremium(isPremiumFeature)
        if isPremiumFeature and not IsPremium then
            if not self.PremiumLock then
                self.PremiumLock = GuiLibrary:MarkAsPremium(groupFrame, "PREMIUM")
                stopESP()
            end
        elseif self.PremiumLock then
            self.PremiumLock.Unlock()
            self.PremiumLock = nil
        end
    end
    
    function groupObj:Destroy()
        stopESP()
        groupFrame:Destroy()
    end
    
    return groupObj
end
-- ==================== PLAYER MARKER SYSTEM ====================
function GuiLibrary:CreatePlayerMarkerSystem(tab, groupName, defaultSettings, isPremium)
    -- Create the collapsible group
    local MarkPlayerGroup = self:CreateCollapsibleGroup(tab, groupName, true, 350)
    
    -- Default settings
    local settings = defaultSettings or {
        maxDistance = 5000,
        markColor = Color3.fromRGB(50, 255, 50), -- Green
        showBox = true,
        showTracer = true,
        showDistance = true
    }
    
    -- Marker system variables
    local MarkedPlayers = {} -- Table to store marked players
    local MarkMaxDistance = settings.maxDistance
    local MarkColor = settings.markColor
    local RunService = game:GetService("RunService")
    local Players = game:GetService("Players")
    local Camera = workspace.CurrentCamera
    
    -- Mark as premium if required
    local premiumLock
    if isPremium and not IsPremium then
        premiumLock = self:MarkAsPremium(MarkPlayerGroup:GetInstance(), "PREMIUM")
    end
    
    -- Create special ESP visuals for marked player
    local function createMarkESP(player)
        if MarkedPlayers[player] then return end -- Avoid duplicates
        
        local markESP = {
            box = Drawing.new("Square"),
            tracer = Drawing.new("Line"),
            distanceLabel = Drawing.new("Text"),
            connection = nil
        }
        
        -- Create green box outline
        markESP.box.Visible = false
        markESP.box.Thickness = 2
        markESP.box.Filled = false
        markESP.box.Color = MarkColor
        markESP.box.ZIndex = 999
        
        -- Create green tracer line
        markESP.tracer.Visible = false
        markESP.tracer.Thickness = 1
        markESP.tracer.Color = MarkColor
        markESP.tracer.ZIndex = 998
        
        -- Create green distance label
        markESP.distanceLabel.Visible = false
        markESP.distanceLabel.Center = true
        markESP.distanceLabel.Outline = true
        markESP.distanceLabel.OutlineColor = Color3.new(0, 0, 0)
        markESP.distanceLabel.Size = 14
        markESP.distanceLabel.Color = MarkColor
        markESP.distanceLabel.ZIndex = 1000
        
        MarkedPlayers[player] = markESP
        
        -- Listen for player character loading
        markESP.connection = player.CharacterAdded:Connect(function()
            task.wait(0.5)
            -- Character loaded, ESP will update in the main loop
        end)
        
        print("[MARK] Marked player: " .. player.Name)
        return true
    end
    
    -- Remove marker ESP from player
    local function removeMarkESP(player)
        local markESP = MarkedPlayers[player]
        if not markESP then return end
        
        if markESP.box then 
            markESP.box:Remove() 
            markESP.box = nil
        end
        if markESP.tracer then 
            markESP.tracer:Remove() 
            markESP.tracer = nil
        end
        if markESP.distanceLabel then 
            markESP.distanceLabel:Remove() 
            markESP.distanceLabel = nil
        end
        if markESP.connection then 
            markESP.connection:Disconnect() 
            markESP.connection = nil
        end
        
        MarkedPlayers[player] = nil
        print("[MARK] Unmarked player: " .. player.Name)
        return true
    end
    
    -- Update marker visuals for player
    local function updateMarkESP(player)
        local markESP = MarkedPlayers[player]
        if not markESP then return end
        
        local character = player.Character
        if not character then
            if markESP.box then markESP.box.Visible = false end
            if markESP.tracer then markESP.tracer.Visible = false end
            if markESP.distanceLabel then markESP.distanceLabel.Visible = false end
            return
        end
        
        local hrp = character:FindFirstChild("HumanoidRootPart")
        if not hrp then
            if markESP.box then markESP.box.Visible = false end
            if markESP.tracer then markESP.tracer.Visible = false end
            if markESP.distanceLabel then markESP.distanceLabel.Visible = false end
            return
        end
        
        local position, onScreen = Camera:WorldToViewportPoint(hrp.Position)
        local distance = (hrp.Position - Camera.CFrame.Position).Magnitude
        
        -- Hide if beyond max distance
        if distance > MarkMaxDistance or not onScreen then
            if markESP.box then markESP.box.Visible = false end
            if markESP.tracer then markESP.tracer.Visible = false end
            if markESP.distanceLabel then markESP.distanceLabel.Visible = false end
            return
        end
        
        -- Update green box
        if markESP.box then
            local boxSize = 25 / (distance / 10)
            markESP.box.Size = Vector2.new(boxSize, boxSize * 2)
            markESP.box.Position = Vector2.new(position.X - boxSize / 2, position.Y - boxSize)
            markESP.box.Visible = settings.showBox
        end
        
        -- Update green tracer line - FIXED THIS PART
        if markESP.tracer then
            -- Get screen center
            local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
            local targetPosition = Vector2.new(position.X, position.Y)
            
            markESP.tracer.From = screenCenter
            markESP.tracer.To = targetPosition
            markESP.tracer.Visible = settings.showTracer
        end
        
        -- Update green distance label
        if markESP.distanceLabel then
            markESP.distanceLabel.Text = "[MARKED] " .. math.floor(distance) .. " studs"
            markESP.distanceLabel.Position = Vector2.new(position.X, position.Y - 50)
            markESP.distanceLabel.Visible = settings.showDistance
        end
    end
    
    -- Main function to mark/unmark player
    local function toggleMarkPlayer(player)
        if isPremium and not IsPremium then return false end
        
        if MarkedPlayers[player] then
            -- If already marked, unmark
            removeMarkESP(player)
            return false
        else
            -- If not marked, mark
            createMarkESP(player)
            
            -- Initial visual update
            if player.Character then
                updateMarkESP(player)
            end
            return true
        end
    end
    
    -- Get the collapsible group's content frame
    local groupContent = MarkPlayerGroup:GetInstance():FindFirstChild("Container")
    if groupContent then
        groupContent = groupContent:FindFirstChild("Content")
    end
    
    if not groupContent then
        -- Fallback: use the group's instance directly
        groupContent = MarkPlayerGroup:GetInstance()
    end
    
    -- Create scrolling frame for player list (keeping your design)
    local playerListFrame = Instance.new("Frame")
    playerListFrame.Name = "PlayerListFrame"
    playerListFrame.Size = UDim2.new(1, -20, 0, 200)
    playerListFrame.Position = UDim2.new(0, 10, 0, 10)
    playerListFrame.BackgroundTransparency = 1
    playerListFrame.Parent = groupContent
    
    local playerListScroll = Instance.new("ScrollingFrame")
    playerListScroll.Name = "PlayerListScroll"
    playerListScroll.Size = UDim2.new(1, 0, 1, 0)
    playerListScroll.BackgroundTransparency = 1
    playerListScroll.ScrollBarThickness = 4
    playerListScroll.ScrollBarImageColor3 = MarkColor
    playerListScroll.ScrollBarImageTransparency = 0.5
    playerListScroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
    playerListScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
    playerListScroll.Parent = playerListFrame
    
    local playerListLayout = Instance.new("UIListLayout")
    playerListLayout.Padding = UDim.new(0, 5)
    playerListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    playerListLayout.Parent = playerListScroll
    
    local playerListPadding = Instance.new("UIPadding")
    playerListPadding.PaddingLeft = UDim.new(0, 5)
    playerListPadding.PaddingRight = UDim.new(0, 5)
    playerListPadding.PaddingTop = UDim.new(0, 5)
    playerListPadding.PaddingBottom = UDim.new(0, 5)
    playerListPadding.Parent = playerListScroll
    
    -- Function to create list item for each player
    local function createPlayerListItem(player)
        if player == Players.LocalPlayer then return end
        
        local playerItem = Instance.new("Frame")
        playerItem.Name = player.Name
        playerItem.Size = UDim2.new(1, -10, 0, 32)
        playerItem.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
        playerItem.BackgroundTransparency = 0.2
        playerItem.BorderSizePixel = 0
        playerItem.LayoutOrder = player.UserId
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 4)
        corner.Parent = playerItem
        
        -- Player info label
        local infoLabel = Instance.new("TextLabel")
        infoLabel.Name = "InfoLabel"
        infoLabel.Size = UDim2.new(0.7, 0, 1, 0)
        infoLabel.Position = UDim2.new(0, 8, 0, 0)
        infoLabel.BackgroundTransparency = 1
        infoLabel.Text = ""
        infoLabel.TextColor3 = Color3.fromRGB(245, 245, 245)
        infoLabel.TextSize = 11
        infoLabel.TextXAlignment = Enum.TextXAlignment.Left
        infoLabel.Font = Enum.Font.Gotham
        infoLabel.Parent = playerItem
        
        -- Mark button
        local markButton = Instance.new("TextButton")
        markButton.Name = "MarkButton"
        markButton.Size = UDim2.new(0, 60, 0, 22)
        markButton.Position = UDim2.new(1, -65, 0.5, -11)
        markButton.BackgroundColor3 = MarkColor
        markButton.BackgroundTransparency = 0.2
        markButton.Text = "Mark"
        markButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        markButton.TextSize = 10
        markButton.Font = Enum.Font.GothamSemibold
        markButton.Parent = playerItem
        
        local btnCorner = Instance.new("UICorner")
        btnCorner.CornerRadius = UDim.new(0, 3)
        btnCorner.Parent = markButton
        
        -- Function to update player info
        local function updatePlayerInfo()
            if not player or not player.Parent then
                playerItem:Destroy()
                return
            end
            
            -- Calculate distance
            local distanceText = ""
            if Players.LocalPlayer.Character and player.Character then
                local myHrp = Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                local theirHrp = player.Character:FindFirstChild("HumanoidRootPart")
                if myHrp and theirHrp then
                    local distance = (theirHrp.Position - myHrp.Position).Magnitude
                    distanceText = " | " .. math.floor(distance) .. " studs"
                end
            end
            
            infoLabel.Text = player.Name .. distanceText
            
            -- Update button state
            if MarkedPlayers[player] then
                markButton.Text = "Unmark"
                markButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50) -- Red for marked
                infoLabel.TextColor3 = MarkColor -- Green text
            else
                markButton.Text = "Mark"
                markButton.BackgroundColor3 = MarkColor -- Green
                infoLabel.TextColor3 = Color3.fromRGB(245, 245, 245) -- White
            end
        end
        
        -- Button click event
        markButton.MouseButton1Click:Connect(function()
            if isPremium and not IsPremium then return end
            
            local marked = toggleMarkPlayer(player)
            updatePlayerInfo()
            
            if marked then
                self:ShowNotification("âœ… Marked player: " .. player.Name, 3)
            else
                self:ShowNotification("âŒ Unmarked player: " .. player.Name, 3)
            end
        end)
        
        -- Button hover effects
        local TweenService = game:GetService("TweenService")
        local isMobile = game:GetService("UserInputService").TouchEnabled
        
        markButton.MouseEnter:Connect(function()
            if not isMobile then
                TweenService:Create(markButton, TweenInfo.new(0.1), {BackgroundTransparency = 0.1}):Play()
            end
        end)
        
        markButton.MouseLeave:Connect(function()
            if not isMobile then
                TweenService:Create(markButton, TweenInfo.new(0.1), {BackgroundTransparency = 0.2}):Play()
            end
        end)
        
        -- Initial update
        updatePlayerInfo()
        
        -- Regular info updates
        local updateConnection
        updateConnection = RunService.Heartbeat:Connect(function()
            updatePlayerInfo()
        end)
        
        -- Cleanup when player leaves
        player.AncestryChanged:Connect(function()
            if not player.Parent then
                if updateConnection then
                    updateConnection:Disconnect()
                end
                removeMarkESP(player)
                playerItem:Destroy()
            end
        end)
        
        playerItem.Parent = playerListScroll
        return playerItem
    end
    
    -- Initial population of player list
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= Players.LocalPlayer then
            createPlayerListItem(player)
        end
    end
    
    -- Listen for new players
    Players.PlayerAdded:Connect(function(player)
        if player ~= Players.LocalPlayer then
            createPlayerListItem(player)
        end
    end)
    
    -- Cleanup when players leave
    Players.PlayerRemoving:Connect(function(player)
        removeMarkESP(player)
    end)
    
    -- ==================== MAIN ESP UPDATE LOOP ====================
    local markUpdateLoop
    markUpdateLoop = RunService.RenderStepped:Connect(function()
        for player, markESP in pairs(MarkedPlayers) do
            updateMarkESP(player)
        end
    end)
    
    -- Create controls container below player list
    local controlsContainer = Instance.new("Frame")
    controlsContainer.Name = "ControlsContainer"
    controlsContainer.Size = UDim2.new(1, -20, 0, 120)
    controlsContainer.Position = UDim2.new(0, 10, 0, 220)
    controlsContainer.BackgroundTransparency = 1
    controlsContainer.Parent = groupContent
    
    -- Max Distance Slider
    local sliderFrame = Instance.new("Frame")
    sliderFrame.Name = "MaxDistanceSlider"
    sliderFrame.Size = UDim2.new(1, 0, 0, 45)
    sliderFrame.BackgroundTransparency = 1
    sliderFrame.Parent = controlsContainer
    
    local sliderLabel = Instance.new("TextLabel")
    sliderLabel.Name = "Label"
    sliderLabel.Size = UDim2.new(1, 0, 0, 20)
    sliderLabel.BackgroundTransparency = 1
    sliderLabel.Text = "Max Distance: " .. MarkMaxDistance .. " studs"
    sliderLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    sliderLabel.TextSize = 11
    sliderLabel.TextXAlignment = Enum.TextXAlignment.Left
    sliderLabel.Font = Enum.Font.Gotham
    sliderLabel.Parent = sliderFrame
    
    local sliderTrack = Instance.new("Frame")
    sliderTrack.Name = "Track"
    sliderTrack.Size = UDim2.new(1, 0, 0, 6)
    sliderTrack.Position = UDim2.new(0, 0, 0, 25)
    sliderTrack.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    sliderTrack.BackgroundTransparency = 0.4
    sliderTrack.BorderSizePixel = 0
    sliderTrack.Parent = sliderFrame
    
    local trackCorner = Instance.new("UICorner")
    trackCorner.CornerRadius = UDim.new(0, 3)
    trackCorner.Parent = sliderTrack
    
    local sliderFill = Instance.new("Frame")
    sliderFill.Name = "Fill"
    sliderFill.Size = UDim2.new(1, 0, 1, 0)
    sliderFill.BackgroundColor3 = MarkColor
    sliderFill.BackgroundTransparency = 0.3
    sliderFill.BorderSizePixel = 0
    sliderFill.Parent = sliderTrack
    
    local fillCorner = Instance.new("UICorner")
    fillCorner.CornerRadius = UDim.new(0, 3)
    fillCorner.Parent = sliderFill
    
    local sliderThumb = Instance.new("TextButton")
    sliderThumb.Name = "Thumb"
    sliderThumb.Size = UDim2.new(0, 16, 0, 16)
    sliderThumb.Position = UDim2.new(1, -8, 0.5, -8)
    sliderThumb.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    sliderThumb.BorderSizePixel = 0
    sliderThumb.Text = ""
    sliderThumb.Parent = sliderTrack
    
    local thumbCorner = Instance.new("UICorner")
    thumbCorner.CornerRadius = UDim.new(1, 0)
    thumbCorner.Parent = sliderThumb
    
    -- Button container
    local buttonContainer = Instance.new("Frame")
    buttonContainer.Name = "ButtonContainer"
    buttonContainer.Size = UDim2.new(1, 0, 0, 35)
    buttonContainer.BackgroundTransparency = 1
    buttonContainer.Position = UDim2.new(0, 0, 0, 55)
    buttonContainer.Parent = controlsContainer
    
    -- Clear All button
    local clearButton = Instance.new("TextButton")
    clearButton.Name = "ClearButton"
    clearButton.Size = UDim2.new(0.48, -2, 1, 0)
    clearButton.Position = UDim2.new(0, 0, 0, 0)
    clearButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
    clearButton.BackgroundTransparency = 0.2
    clearButton.BorderSizePixel = 0
    clearButton.Text = "Clear All"
    clearButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    clearButton.TextSize = 11
    clearButton.Font = Enum.Font.GothamSemibold
    clearButton.Parent = buttonContainer
    
    local clearCorner = Instance.new("UICorner")
    clearCorner.CornerRadius = UDim.new(0, 4)
    clearCorner.Parent = clearButton
    
    -- Refresh button
    local refreshButton = Instance.new("TextButton")
    refreshButton.Name = "RefreshButton"
    refreshButton.Size = UDim2.new(0.48, -2, 1, 0)
    refreshButton.Position = UDim2.new(0.52, 2, 0, 0)
    refreshButton.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
    refreshButton.BackgroundTransparency = 0.2
    refreshButton.BorderSizePixel = 0
    refreshButton.Text = "Refresh List"
    refreshButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    refreshButton.TextSize = 11
    refreshButton.Font = Enum.Font.GothamSemibold
    refreshButton.Parent = buttonContainer
    
    local refreshCorner = Instance.new("UICorner")
    refreshCorner.CornerRadius = UDim.new(0, 4)
    refreshCorner.Parent = refreshButton
    
    -- Button effects
    local function setupButtonEffects(button)
        button.MouseEnter:Connect(function()
            if not isMobile then
                TweenService:Create(button, TweenInfo.new(0.1), {BackgroundTransparency = 0.1}):Play()
            end
        end)
        
        button.MouseLeave:Connect(function()
            if not isMobile then
                TweenService:Create(button, TweenInfo.new(0.1), {BackgroundTransparency = 0.2}):Play()
            end
        end)
    end
    
    setupButtonEffects(clearButton)
    setupButtonEffects(refreshButton)
    
    -- Clear All button click
    clearButton.MouseButton1Click:Connect(function()
        if isPremium and not IsPremium then return end
        
        for player, _ in pairs(MarkedPlayers) do
            removeMarkESP(player)
        end
        
        -- Update all player list items
        for _, child in ipairs(playerListScroll:GetChildren()) do
            if child:IsA("Frame") then
                local markButton = child:FindFirstChild("MarkButton")
                local infoLabel = child:FindFirstChild("InfoLabel")
                if markButton and infoLabel then
                    markButton.Text = "Mark"
                    markButton.BackgroundColor3 = MarkColor
                    infoLabel.TextColor3 = Color3.fromRGB(245, 245, 245)
                end
            end
        end
        
        self:ShowNotification("ðŸ§¹ Cleared all player marks", 3)
    end)
    
    -- Refresh button click
    refreshButton.MouseButton1Click:Connect(function()
        if isPremium and not IsPremium then return end
        
        -- Clear old list items
        for _, child in ipairs(playerListScroll:GetChildren()) do
            if child:IsA("Frame") then
                child:Destroy()
            end
        end
        
        -- Recreate list items
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= Players.LocalPlayer then
                createPlayerListItem(player)
            end
        end
        
        self:ShowNotification("ðŸ”„ Player list refreshed", 3)
    end)
    
    -- Slider functionality
    local function updateSlider(value)
        MarkMaxDistance = value
        sliderLabel.Text = "Max Distance: " .. value .. " studs"
        
        local percentage = (value - 100) / (5000 - 100)
        sliderFill.Size = UDim2.new(percentage, 0, 1, 0)
        sliderThumb.Position = UDim2.new(percentage, -8, 0.5, -8)
    end
    
    -- Initialize slider
    updateSlider(MarkMaxDistance)
    
    -- Slider interaction
    local isDragging = false
    local UserInputService = game:GetService("UserInputService")
    
    local function onSliderInput(input)
        if isDragging then
            local relativeX = (input.Position.X - sliderTrack.AbsolutePosition.X) / sliderTrack.AbsoluteSize.X
            local value = 100 + (relativeX * (5000 - 100))
            updateSlider(math.clamp(value, 100, 5000))
        end
    end
    
    sliderThumb.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            isDragging = true
        end
    end)
    
    sliderThumb.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            isDragging = false
        end
    end)
    
    sliderTrack.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            isDragging = true
            local relativeX = (input.Position.X - sliderTrack.AbsolutePosition.X) / sliderTrack.AbsoluteSize.X
            local value = 100 + (relativeX * (5000 - 100))
            updateSlider(math.clamp(value, 100, 5000))
        end
    end)
    
    sliderTrack.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            isDragging = false
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if isDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            onSliderInput(input)
        end
    end)
    
    -- Create marker system object with methods
    local markerSystem = {
        Group = MarkPlayerGroup,
        PremiumLock = premiumLock,
        Content = groupContent
    }
    
    function markerSystem:GetMarkedPlayers()
        local marked = {}
        for player, _ in pairs(MarkedPlayers) do
            table.insert(marked, player)
        end
        return marked
    end
    
    function markerSystem:MarkPlayer(player)
        if isPremium and not IsPremium then return false end
        if typeof(player) == "Instance" and player:IsA("Player") and player ~= Players.LocalPlayer then
            return toggleMarkPlayer(player)
        end
        return false
    end
    
    function markerSystem:UnmarkPlayer(player)
        if typeof(player) == "Instance" and player:IsA("Player") then
            return removeMarkESP(player)
        end
        return false
    end
    
    function markerSystem:IsPlayerMarked(player)
        return MarkedPlayers[player] ~= nil
    end
    
    function markerSystem:ClearAll()
        for player, _ in pairs(MarkedPlayers) do
            removeMarkESP(player)
        end
    end
    
    function markerSystem:SetMaxDistance(distance)
        MarkMaxDistance = distance or 5000
        updateSlider(MarkMaxDistance)
    end
    
    function markerSystem:SetMarkColor(color)
        MarkColor = color or Color3.fromRGB(50, 255, 50)
        
        -- Update slider color
        sliderFill.BackgroundColor3 = MarkColor
        
        -- Update existing ESP colors
        for player, markESP in pairs(MarkedPlayers) do
            if markESP.box then markESP.box.Color = MarkColor end
            if markESP.tracer then markESP.tracer.Color = MarkColor end
            if markESP.distanceLabel then markESP.distanceLabel.Color = MarkColor end
        end
        
        -- Update button colors
        for _, child in ipairs(playerListScroll:GetChildren()) do
            if child:IsA("Frame") then
                local markButton = child:FindFirstChild("MarkButton")
                if markButton and markButton.Text == "Mark" then
                    markButton.BackgroundColor3 = MarkColor
                end
            end
        end
    end
    
    function markerSystem:RefreshList()
        -- Clear old list items
        for _, child in ipairs(playerListScroll:GetChildren()) do
            if child:IsA("Frame") then
                child:Destroy()
            end
        end
        
        -- Recreate list items
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= Players.LocalPlayer then
                createPlayerListItem(player)
            end
        end
    end
    
    function markerSystem:SetPremium(isPremiumFeature)
        if isPremiumFeature and not IsPremium then
            if not self.PremiumLock then
                self.PremiumLock = GuiLibrary:MarkAsPremium(MarkPlayerGroup:GetInstance(), "PREMIUM")
                self:ClearAll()
                
                -- Disable buttons
                clearButton.Active = false
                refreshButton.Active = false
                clearButton.BackgroundTransparency = 0.5
                refreshButton.BackgroundTransparency = 0.5
            end
        elseif self.PremiumLock then
            self.PremiumLock.Unlock()
            self.PremiumLock = nil
            
            -- Re-enable buttons
            clearButton.Active = true
            refreshButton.Active = true
            clearButton.BackgroundTransparency = 0.2
            refreshButton.BackgroundTransparency = 0.2
        end
    end
    
    function markerSystem:Destroy()
        if markUpdateLoop then
            markUpdateLoop:Disconnect()
        end
        
        for player, _ in pairs(MarkedPlayers) do
            removeMarkESP(player)
        end
        
        MarkPlayerGroup:Destroy()
    end
    
    print("\n========================================")
    print("PLAYER MARKER SYSTEM LOADED!")
    print("â€¢ Green highlight for marked players")
    print("â€¢ Max mark distance: " .. MarkMaxDistance .. " studs")
    print("â€¢ Use the '" .. groupName .. "' section")
    print("========================================")
    
    return markerSystem
end


--#new
-- Add Keybind Function (Standalone Keybind Control)
function GuiLibrary:AddKeybind(tab, keybindName, defaultKeybind, callback, isPremium)
    local keybindFrame = Instance.new("Frame")
    keybindFrame.Name = "Keybind_" .. keybindName
    keybindFrame.Size = UDim2.new(1, 0, 0, 45)
    keybindFrame.BackgroundTransparency = 1
    keybindFrame.Parent = tab.Frame

    -- Main container
    local container = Instance.new("Frame")
    container.Name = "Container"
    container.Size = UDim2.new(1, 0, 1, 0)
    container.BackgroundColor3 = Color3.fromRGB(28, 28, 32)
    container.BackgroundTransparency = 0
    container.BorderSizePixel = 0
    container.Parent = keybindFrame

    local containerCorner = Instance.new("UICorner")
    containerCorner.CornerRadius = UDim.new(0, 6)
    containerCorner.Parent = container

    -- Border
    local border = Instance.new("Frame")
    border.Name = "Border"
    border.Size = UDim2.new(1, 0, 1, 0)
    border.BackgroundTransparency = 1
    border.BorderColor3 = Color3.fromRGB(45, 45, 50)
    border.BorderSizePixel = 1
    border.Parent = container

    local borderCorner = Instance.new("UICorner")
    borderCorner.CornerRadius = UDim.new(0, 6)
    borderCorner.Parent = border

    -- Label
    local label = Instance.new("TextLabel")
    label.Name = "Label"
    label.Size = UDim2.new(0.5, -10, 0, 22)
    label.Position = UDim2.new(0, 10, 0, 5)
    label.BackgroundTransparency = 1
    label.Text = keybindName
    label.TextColor3 = Color3.fromRGB(230, 230, 230)
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Font = Enum.Font.Gotham
    label.Parent = container

    -- Keybind display button
    local keybindButton = Instance.new("TextButton")
    keybindButton.Name = "KeybindButton"
    keybindButton.Size = UDim2.new(0.3, 0, 0, 25)
    keybindButton.Position = UDim2.new(0.5, 10, 0, 5)
    keybindButton.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    keybindButton.BackgroundTransparency = 0
    keybindButton.BorderSizePixel = 0
    keybindButton.TextColor3 = Color3.fromRGB(230, 230, 230)
    keybindButton.TextSize = 11
    keybindButton.Font = Enum.Font.GothamMedium
    keybindButton.Parent = container

    local keybindButtonCorner = Instance.new("UICorner")
    keybindButtonCorner.CornerRadius = UDim.new(0, 4)
    keybindButtonCorner.Parent = keybindButton

    -- Status label
    local statusLabel = Instance.new("TextLabel")
    statusLabel.Name = "StatusLabel"
    statusLabel.Size = UDim2.new(1, -20, 0, 15)
    statusLabel.Position = UDim2.new(0, 10, 1, -18)
    statusLabel.BackgroundTransparency = 1
    statusLabel.Text = "Click to change keybind"
    statusLabel.TextColor3 = Color3.fromRGB(120, 120, 120)
    statusLabel.TextSize = 9
    statusLabel.TextXAlignment = Enum.TextXAlignment.Left
    statusLabel.Font = Enum.Font.Gotham
    statusLabel.Parent = container

    -- State variables
    local currentKeybind = defaultKeybind or Enum.KeyCode.U
    local isListeningForInput = false
    local keybindConnection = nil
    local isEnabled = true
    local keybindId = keybindName:gsub("%s+", "_"):upper()

    -- Mark as premium if required
    local premiumLock
    if isPremium and not IsPremium then
        premiumLock = self:MarkAsPremium(keybindFrame, "PREMIUM")
        callback = function() end -- Disable callback for non-premium users
        isEnabled = false
    end

    -- Helper functions
    local function getKeyName(keyCode)
        local keyName = tostring(keyCode):gsub("Enum.KeyCode.", "")
        return keyName
    end

    local function stringToKeyCode(keyString)
        for _, key in pairs(Enum.KeyCode:GetEnumItems()) do
            if tostring(key) == "Enum.KeyCode." .. keyString then
                return key
            end
        end
        
        -- Special keys mapping
        local specialKeys = {
            ["INSERT"] = Enum.KeyCode.Insert,
            ["DELETE"] = Enum.KeyCode.Delete,
            ["HOME"] = Enum.KeyCode.Home,
            ["END"] = Enum.KeyCode.End,
            ["PAGEUP"] = Enum.KeyCode.PageUp,
            ["PAGEDOWN"] = Enum.KeyCode.PageDown,
            ["PRINT"] = Enum.KeyCode.Print,
            ["SCROLLLOCK"] = Enum.KeyCode.ScrollLock,
            ["PAUSE"] = Enum.KeyCode.Pause,
            ["CAPSLOCK"] = Enum.KeyCode.CapsLock,
            ["NUMLOCK"] = Enum.KeyCode.NumLock,
        }
        
        if specialKeys[keyString:upper()] then
            return specialKeys[keyString:upper()]
        end
        
        return Enum.KeyCode.U -- Fallback
    end

    local function updateKeybindDisplay()
        keybindButton.Text = getKeyName(currentKeybind)
    end

    -- Save keybind to file
    local function saveKeybindToFile()
        local success, message = pcall(function()
            -- Create config directory if it doesn't exist
            if not isfolder("KeybindConfig") then
                makefolder("KeybindConfig")
            end
            
            -- Read existing config or create new one
            local config = {}
            if isfile("KeybindConfig/keybinds.json") then
                local existingData = readfile("KeybindConfig/keybinds.json")
                config = game:GetService("HttpService"):JSONDecode(existingData)
            end
            
            -- Update or add this keybind
            config[keybindId] = {
                keybind = tostring(currentKeybind):gsub("Enum.KeyCode.", ""),
                name = keybindName,
                timestamp = os.time()
            }
            
            -- Save to file
            writefile("KeybindConfig/keybinds.json", game:GetService("HttpService"):JSONEncode(config))
            
            -- Show save confirmation
            statusLabel.Text = "Keybind saved!"
            statusLabel.TextColor3 = Color3.fromRGB(80, 180, 80)
            
            delay(2, function()
                if statusLabel then
                    statusLabel.Text = "Click to change keybind"
                    statusLabel.TextColor3 = Color3.fromRGB(120, 120, 120)
                end
            end)
        end)
        
        if not success then
            warn("Failed to save keybind: " .. tostring(message))
            statusLabel.Text = "Save failed!"
            statusLabel.TextColor3 = Color3.fromRGB(220, 80, 80)
        end
    end

    -- Load keybind from file
    local function loadKeybindFromFile()
        local success, message = pcall(function()
            if isfile("KeybindConfig/keybinds.json") then
                local configData = readfile("KeybindConfig/keybinds.json")
                local config = game:GetService("HttpService"):JSONDecode(configData)
                
                if config[keybindId] then
                    local savedKeybind = config[keybindId].keybind
                    currentKeybind = stringToKeyCode(savedKeybind)
                    updateKeybindDisplay()
                    
                    statusLabel.Text = "Keybind loaded!"
                    statusLabel.TextColor3 = Color3.fromRGB(80, 180, 80)
                    
                    delay(2, function()
                        if statusLabel then
                            statusLabel.Text = "Click to change keybind"
                            statusLabel.TextColor3 = Color3.fromRGB(120, 120, 120)
                        end
                    end)
                    
                    return true
                end
            end
            return false
        end)
        
        if not success then
            warn("Failed to load keybind: " .. tostring(message))
        end
        
        return false
    end

    -- Reset keybind to default
    local function resetKeybindToDefault()
        currentKeybind = defaultKeybind or Enum.KeyCode.U
        updateKeybindDisplay()
        saveKeybindToFile() -- Save the reset
        
        statusLabel.Text = "Reset to default"
        statusLabel.TextColor3 = Color3.fromRGB(255, 165, 0)
        
        delay(2, function()
            if statusLabel then
                statusLabel.Text = "Click to change keybind"
                statusLabel.TextColor3 = Color3.fromRGB(120, 120, 120)
            end
        end)
    end

    -- Start listening for keybind input
    local function startKeybindListening()
        if isPremium and not IsPremium then return end
        if isListeningForInput then return end
        if not isEnabled then return end

        isListeningForInput = true
        keybindButton.BackgroundColor3 = Color3.fromRGB(70, 130, 200)
        statusLabel.Text = "Press any key..."
        statusLabel.TextColor3 = Color3.fromRGB(70, 130, 200)

        -- Disconnect previous connection if exists
        if keybindConnection then
            keybindConnection:Disconnect()
        end

        -- Listen for key input
        keybindConnection = game:GetService("UserInputService").InputBegan:Connect(function(input, gameProcessed)
            if gameProcessed then return end

            if input.UserInputType == Enum.UserInputType.Keyboard then
                currentKeybind = input.KeyCode
                updateKeybindDisplay()
                
                -- Save automatically when keybind is changed
                saveKeybindToFile()
                
                -- Stop listening
                isListeningForInput = false
                keybindButton.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
                
                -- Disconnect the listener
                if keybindConnection then
                    keybindConnection:Disconnect()
                    keybindConnection = nil
                end
            elseif input.UserInputType == Enum.UserInputType.MouseButton1 then
                -- Ignore mouse clicks during keybind listening
                return
            end
        end)
    end

    -- Stop listening for keybind input
    local function stopKeybindListening()
        if keybindConnection then
            keybindConnection:Disconnect()
            keybindConnection = nil
        end
        isListeningForInput = false
        keybindButton.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
        statusLabel.Text = "Click to change keybind"
        statusLabel.TextColor3 = Color3.fromRGB(120, 120, 120)
    end

    -- Initialize keybind
    local function initializeKeybind()
        local loaded = loadKeybindFromFile()
        if not loaded then
            updateKeybindDisplay() -- Use default keybind
        end
    end

    -- Global keybind listener for callback functionality
    local globalKeybindConnection = game:GetService("UserInputService").InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        
        if isEnabled and input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == currentKeybind then
            -- Visual feedback
            TweenService:Create(keybindButton, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(90, 170, 90)}):Play()
            delay(0.1, function()
                if keybindButton then
                    TweenService:Create(keybindButton, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(50, 50, 55)}):Play()
                end
            end)
            
            if callback then
                callback()
            end
        end
    end)

    -- Button hover effects
    local function setupButtonEffects()
        keybindButton.MouseEnter:Connect(function()
            if not isMobile and isEnabled then
                TweenService:Create(keybindButton, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(60, 60, 70)}):Play()
            end
        end)

        keybindButton.MouseLeave:Connect(function()
            if not isMobile and isEnabled then
                TweenService:Create(keybindButton, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(50, 50, 55)}):Play()
            end
        end)
    end

    setupButtonEffects()

    -- Keybind button functionality
    keybindButton.MouseButton1Click:Connect(function()
        if isPremium and not IsPremium then return end
        if not isEnabled then return end

        if isListeningForInput then
            stopKeybindListening()
        else
            startKeybindListening()
        end
    end)

    -- Right-click to reset keybind
    keybindButton.MouseButton2Click:Connect(function()
        if isPremium and not IsPremium then return end
        if not isEnabled then return end
        resetKeybindToDefault()
    end)

    -- Initialize
    initializeKeybind()

    -- Create keybind object with methods
    local keybindObj = {
        Instance = keybindFrame,
        PremiumLock = premiumLock
    }

    function keybindObj:GetKeybind()
        return currentKeybind
    end

    function keybindObj:SetKeybind(keybind)
        if isPremium and not IsPremium then return end
        currentKeybind = keybind or currentKeybind
        updateKeybindDisplay()
        saveKeybindToFile() -- Auto-save
    end

    function keybindObj:SetEnabled(enabled)
        isEnabled = enabled
        if enabled then
            keybindButton.BackgroundTransparency = 0
            keybindButton.TextColor3 = Color3.fromRGB(230, 230, 230)
            statusLabel.Text = "Click to change keybind"
        else
            keybindButton.BackgroundTransparency = 0.5
            keybindButton.TextColor3 = Color3.fromRGB(120, 120, 120)
            statusLabel.Text = "Keybind disabled"
        end
    end

    function keybindObj:IsEnabled()
        return isEnabled
    end

    function keybindObj:SaveKeybind()
        saveKeybindToFile()
    end

    function keybindObj:LoadKeybind()
        return loadKeybindFromFile()
    end

    function keybindObj:ResetKeybind()
        resetKeybindToDefault()
    end

    function keybindObj:SetLabel(newLabel)
        label.Text = newLabel or keybindName
    end

    function keybindObj:SetCallback(newCallback)
        if isPremium and not IsPremium then return end
        callback = newCallback
    end

    function keybindObj:TriggerCallback()
        if isPremium and not IsPremium then return end
        if callback then
            callback()
        end
    end

    function keybindObj:SetColor(color)
        if keybindButton then
            keybindButton.BackgroundColor3 = color or Color3.fromRGB(50, 50, 55)
        end
    end

    function keybindObj:SetPremium(isPremiumFeature)
        if isPremiumFeature and not IsPremium then
            if not self.PremiumLock then
                self.PremiumLock = GuiLibrary:MarkAsPremium(keybindFrame, "PREMIUM")
                self:SetEnabled(false)
            end
        elseif self.PremiumLock then
            self.PremiumLock.Unlock()
            self.PremiumLock = nil
            self:SetEnabled(true)
        end
    end

    function keybindObj:Destroy()
        if globalKeybindConnection then
            globalKeybindConnection:Disconnect()
        end
        if keybindConnection then
            keybindConnection:Disconnect()
        end
        keybindFrame:Destroy()
    end

    return keybindObj
end


-- Look for the end of your library file (around line 3500-3510)
-- Add these functions RIGHT BEFORE the final return statement:

-- Register an element by name
function GuiLibrary:RegisterElement(name, elementObject)
    if name and elementObject then
        elementRegistry[name] = elementObject
        GuiElements[name] = elementObject -- Alternative access
        return true
    end
    return false
end

-- Get an element by name
function GuiLibrary:GetElement(name)
    return elementRegistry[name] or GuiElements[name]
end

-- Set element value by name
function GuiLibrary:SetElementValue(name, value)
    local element = self:GetElement(name)
    if element then
        if element.SetValue then
            element:SetValue(value)
            return true
        elseif element.SetState then
            element:SetState(value)
            return true
        elseif element.SetSelection then
            element:SetSelection(value)
            return true
        elseif element.SetText then
            element:SetText(value)
            return true
        end
    end
    warn("âŒ Element not found or doesn't support SetValue: " .. tostring(name))
    return false
end

-- Get element value by name
function GuiLibrary:GetElementValue(name)
    local element = self:GetElement(name)
    if element then
        if element.GetValue then
            return element:GetValue()
        elseif element.GetState then
            return element:GetState()
        elseif element.GetSelection then
            return element:GetSelection()
        elseif element.GetText then
            return element:GetText()
        end
    end
    warn("âŒ Element not found or doesn't support GetValue: " .. tostring(name))
    return nil
end

-- List all registered elements (for debugging)
function GuiLibrary:ListElements()
    print("ðŸ“‹ Registered GUI Elements:")
    for name, _ in pairs(elementRegistry) do
        print("  - " .. name)
    end
    if next(elementRegistry) == nil then
        print("  (No elements registered)")
    end
end

-- Remove an element from registry
function GuiLibrary:UnregisterElement(name)
    if elementRegistry[name] then
        elementRegistry[name] = nil
        GuiElements[name] = nil
        return true
    end
    return false
end

-- Clear all registered elements
function GuiLibrary:ClearRegistry()
    elementRegistry = {}
    GuiElements = {}
end

-- Alternative direct access (global variable)
GuiLibrary.Elements = GuiElements



-- Magic property access - allows GuiLibrary["Slider Name"] = value
local guiLibraryMetatable = {
    __index = function(self, key)
        -- Try to get element from registry
        local element = elementRegistry[key]
        if element then
            return element
        end
        
        -- Fall back to normal method access
        return GuiLibrary[key]
    end,
    
    __newindex = function(self, key, value)
        -- Check if trying to set a registered element's value
        local element = elementRegistry[key]
        if element then
            if element.SetValue then
                element:SetValue(value)
            elseif element.SetState then
                element:SetState(value)
            elseif element.SetSelection then
                element:SetSelection(value)
            elseif element.SetText then
                element:SetText(value)
            else
                -- If element doesn't have setter methods, try direct property
                element.Value = value
            end
        else
            -- Store as regular property
            rawset(self, key, value)
        end
    end
}

-- Set metatable on GuiLibrary
setmetatable(GuiLibrary, guiLibraryMetatable)

-- Also add direct access through global variable
_G.SFY = GuiLibrary


-- Shortcut function for setting values
function GuiLibrary:Set(name, value)
    local element = elementRegistry[name]
    if element then
        if element.SetValue then
            element:SetValue(value)
        elseif element.SetState then
            element:SetState(value)
        elseif element.SetSelection then
            element:SetSelection(value)
        end
        return true
    end
    return false
end

-- Shortcut function for getting values
function GuiLibrary:Get(name)
    local element = elementRegistry[name]
    if element then
        if element.GetValue then
            return element:GetValue()
        elseif element.GetState then
            return element:GetState()
        elseif element.GetSelection then
            return element:GetSelection()
        end
    end
    return nil
end

-- Direct element access
GuiLibrary.E = elementRegistry


-- Magic accessor for easy element access
setmetatable(GuiLibrary, {
    __index = function(self, key)
        -- First try to get element from registry
        local element = elementRegistry[key]
        if element then return element end
        
        -- Then try methods
        return rawget(GuiLibrary, key)
    end,
    
    __newindex = function(self, key, value)
        -- Check if it's an element in registry
        local element = elementRegistry[key]
        if element then
            -- Auto-detect and set value
            if element.SetValue then
                element:SetValue(value)
            elseif element.SetState then
                element:SetState(value)
            elseif element.SetSelection then
                element:SetSelection(value)
            elseif element.SetText then
                element:SetText(value)
            end
        else
            -- Store as regular property
            rawset(self, key, value)
        end
    end
})

-- Global shortcut
_G.GUI = GuiLibrary

-- Easy element access
function GuiLibrary:GetElement(name)
    return elementRegistry[name] or guiElements[name]
end

-- Set element value by name
function GuiLibrary:Set(name, value)
    local element = self:GetElement(name)
    if element then
        if element.SetValue then
            element:SetValue(value)
        elseif element.SetState then
            element:SetState(value)
        elseif element.SetSelection then
            element:SetSelection(value)
        end
        return true
    end
    warn("âŒ Element not found: " .. tostring(name))
    return false
end

-- Get element value by name
function GuiLibrary:Get(name)
    local element = self:GetElement(name)
    if element then
        if element.GetValue then
            return element:GetValue()
        elseif element.GetState then
            return element:GetState()
        elseif element.GetSelection then
            return element:GetSelection()
        end
    end
    warn("âŒ Element not found: " .. tostring(name))
    return nil
end

-- Magic property access
setmetatable(GuiLibrary, {
    __index = function(self, key)
        return elementRegistry[key] or rawget(GuiLibrary, key)
    end,
    
    __newindex = function(self, key, value)
        local element = elementRegistry[key]
        if element then
            if element.SetValue then
                element:SetValue(value)
            elseif element.SetState then
                element:SetState(value)
            elseif element.SetSelection then
                element:SetSelection(value)
            end
        else
            rawset(self, key, value)
        end
    end
})

-- Global shortcut
_G.Gui = GuiLibrary

_G._GUI_ELEMENTS = elementRegistry

-- Ultra-short global Set function
_G.Set = function(name, value)
    local element = elementRegistry[name]
    if not element then
        -- Try case-insensitive search
        for elementName, elementObj in pairs(elementRegistry) do
            if elementName:lower() == name:lower() then
                element = elementObj
                break
            end
        end
    end
    
    if element then
        -- Auto-detect element type and set value
        if element.SetValue then
            element:SetValue(value)
        elseif element.SetState then
            element:SetState(value)
        elseif element.SetSelection then
            element:SetSelection(value)
        elseif element.SetText then
            element:SetText(value)
        end
        return true
    end
    
    warn("âŒ GUI Element not found: " .. tostring(name))
    return false
end

-- Ultra-short global Get function
_G.Get = function(name)
    local element = elementRegistry[name]
    if not element then
        -- Try case-insensitive search
        for elementName, elementObj in pairs(elementRegistry) do
            if elementName:lower() == name:lower() then
                element = elementObj
                break
            end
        end
    end
    
    if element then
        -- Auto-detect element type and get value
        if element.GetValue then
            return element:GetValue()
        elseif element.GetState then
            return element:GetState()
        elseif element.GetSelection then
            return element:GetSelection()
        elseif element.GetText then
            return element:GetText()
        end
    end
    
    warn("âŒ GUI Element not found: " .. tostring(name))
    return nil
end

-- ============================================
-- SIMPLE ELEMENT ACCESS METHODS
-- ============================================

-- Add these methods to GuiLibrary
function GuiLibrary:GetElement(name)
    return elementRegistry[name]
end

function GuiLibrary:Set(name, value)
    local element = elementRegistry[name]
    if element then
        if element.SetValue then
            element:SetValue(value)
            return true
        elseif element.SetState then
            element:SetState(value)
            return true
        elseif element.SetSelection then
            element:SetSelection(value)
            return true
        end
    end
    return false
end

function GuiLibrary:Get(name)
    local element = elementRegistry[name]
    if element then
        if element.GetValue then
            return element:GetValue()
        elseif element.GetState then
            return element:GetState()
        elseif element.GetSelection then
            return element:GetSelection()
        end
    end
    return nil
end

-- Export the library

return GuiLibrary
